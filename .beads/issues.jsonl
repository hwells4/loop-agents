{"id":"agent-pipelines-34z","title":"Create test_engine_events.sh integration tests","description":"Create scripts/tests/test_engine_events.sh for integration tests:\n\nTEST FILE STRUCTURE:\n1. Source scripts/lib/test.sh for assertions\n2. Source scripts/lib/mock.sh for mock execution\n3. Don't source engine.sh directly - run it as subprocess\n\nINTEGRATION TEST CASES:\n- test_session_start_event: Pipeline start emits session_start event\n- test_iteration_events: Each iteration emits start/complete events\n- test_error_event: Failed iteration emits error event\n- test_resume_from_events: Resume reads events.jsonl to find cursor\n- test_legacy_compatibility: Session without events.jsonl uses state.json\n- test_recompile_on_change: Modified YAML triggers recompilation\n- test_event_cursor_accuracy: Cursor tracks node_path, iteration correctly\n\nMOCK EXECUTION:\n- Use MOCK_MODE=true to simulate Claude responses\n- Mock responses in scripts/stages/{stage}/fixtures/\n- Each test creates isolated temp session directory\n\nNOTE: These are INTEGRATION tests - they run the actual engine code path, not just unit functions.","acceptance_criteria":"- [ ] Integration test: full session lifecycle events\n- [ ] Integration test: resume from events\n- [ ] Integration test: legacy compatibility\n- [ ] Integration test: recompilation trigger\n- [ ] All tests pass via ./scripts/run.sh test engine_events","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T09:49:35.784580891+01:00","created_by":"ubuntu","updated_at":"2026-01-14T12:35:36.619066605+01:00","closed_at":"2026-01-14T12:35:36.619066605+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-34z","depends_on_id":"agent-pipelines-e7j","type":"blocks","created_at":"2026-01-14T09:49:41.894328799+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-34z","depends_on_id":"agent-pipelines-e1l","type":"blocks","created_at":"2026-01-14T10:06:59.975975913+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-34z","depends_on_id":"agent-pipelines-l0y","type":"blocks","created_at":"2026-01-14T10:07:00.134098843+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-34z","depends_on_id":"agent-pipelines-6vl","type":"blocks","created_at":"2026-01-14T10:07:00.326719539+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-3u2","title":"Create queue-empty.sh completion strategy","description":"Create scripts/lib/completions/queue-empty.sh that uses queue.sh abstraction.\n\nThis is the generic queue completion strategy that works with any backend.\nUses queue_count() to check if work remains.\n\n**Error handling:**\n- Check for agent error status first (stop on error, consistent with beads-empty.sh)\n- Handle non-numeric queue_count output gracefully (log warning, return 1 = not complete)\n\nKeep beads-empty.sh for backward compatibility - do not modify it.\n\nReference the existing beads-empty.sh for structure. The queue-empty.sh should mirror\nits interface exactly (check_completion with same args).","acceptance_criteria":"- [ ] queue-empty.sh exists in scripts/lib/completions/\n- [ ] Sources queue.sh to access queue_count()\n- [ ] Uses queue_count() from queue.sh (not bd directly)\n- [ ] Checks for error status first (decision=error stops loop)\n- [ ] Handles non-numeric queue_count output (warns, doesn't complete)\n- [ ] beads-empty.sh still works unchanged","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T09:35:32.540295782+01:00","created_by":"ubuntu","updated_at":"2026-01-13T09:59:47.459096762+01:00","closed_at":"2026-01-13T09:59:47.459096762+01:00","close_reason":"Closed","labels":["pipeline/provider-config"],"dependencies":[{"issue_id":"agent-pipelines-3u2","depends_on_id":"agent-pipelines-w1w","type":"blocks","created_at":"2026-01-13T09:36:30.640352926+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-3we","title":"Update ralph stage to use queue abstraction","description":"Update scripts/stages/ralph/stage.yaml to support queue configuration:\n\n```yaml\ntermination:\n  type: queue-empty  # Use new generic completion (not fixed)\n\nqueue:\n  provider: beads     # Currently the only backend\n  config: {}         # Backend-specific config (future use)\n```\n\nUpdate prompt.md to reference queue commands from context.json instead\nof hardcoded bd commands. Agent reads commands from ${CTX}:\n```bash\n# List items\neval $(jq -r '.queue.commands.list' ${CTX})\n\n# Claim item  \ncmd=$(jq -r '.queue.commands.claim' ${CTX})\neval \"${cmd//\\{\\{id\\}\\}/$ITEM_ID}\"\n```\n\n**Backward compatibility:** Existing sessions using type: fixed continue\nto work. Only new sessions with type: queue-empty use the abstraction.","acceptance_criteria":"- [ ] ralph/stage.yaml has queue config block option\n- [ ] prompt.md updated to use queue.commands from context.json\n- [ ] No hardcoded bd commands in prompt.md\n- [ ] Existing sessions with type: fixed still work\n- [ ] New sessions with queue-empty use abstraction","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T09:35:51.0058486+01:00","created_by":"ubuntu","updated_at":"2026-01-13T10:07:15.734078273+01:00","closed_at":"2026-01-13T10:07:15.734078273+01:00","close_reason":"Closed","labels":["pipeline/provider-config"],"dependencies":[{"issue_id":"agent-pipelines-3we","depends_on_id":"agent-pipelines-3u2","type":"blocks","created_at":"2026-01-13T09:36:30.970145256+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-3we","depends_on_id":"agent-pipelines-s0p","type":"blocks","created_at":"2026-01-13T09:36:31.008897543+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-4pc","title":"Add integration test for queue-based work session","description":"Create tests/integration/test_queue_work.sh\n\nRun a mock work session using queue-empty completion:\n1. Create test beads with pipeline/test label\n2. Run single iteration of work stage with mock Claude\n3. Verify queue_count decrements correctly\n4. Verify context.json contains queue.commands\n\nThis validates the full integration from stage.yaml through\nto completion check. Uses the beads provider.\n\n**Test cases:**\n- Stage with queue-empty termination loads queue provider\n- context.json has .queue.commands block with list/claim/complete\n- queue_count returns correct count of ready beads\n- Completion check passes when all beads complete\n- Backward compat: existing beads-empty stages still work","acceptance_criteria":"- [ ] tests/integration/test_queue_work.sh exists\n- [ ] Tests queue-empty completion strategy end-to-end\n- [ ] Tests context.json has .queue.commands injection\n- [ ] Tests queue_count returns correct counts\n- [ ] Tests completion when queue empty\n- [ ] Tests backward compat with beads-empty\n- [ ] All tests pass in CI","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T09:36:22.050189368+01:00","created_by":"ubuntu","updated_at":"2026-01-13T10:20:13.215842023+01:00","closed_at":"2026-01-13T10:20:13.215842023+01:00","close_reason":"Closed","labels":["pipeline/provider-config"],"dependencies":[{"issue_id":"agent-pipelines-4pc","depends_on_id":"agent-pipelines-3we","type":"blocks","created_at":"2026-01-13T09:36:31.386336151+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-4pc","depends_on_id":"agent-pipelines-a8d","type":"blocks","created_at":"2026-01-13T09:42:48.012170291+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-6bw","title":"Refactor lock.sh to add flock-based locking","description":"Refactor existing scripts/lib/lock.sh to add flock-based locking support:\n\nCURRENT STATE: lock.sh exists with noclobber-based locking using JSON lock files.\n\nCHANGES NEEDED:\n- Keep existing functions (acquire_lock, release_lock, is_locked, cleanup_stale_locks)\n- Add flock-based locking as alternative for file descriptor locking\n- Add detect_flock() function for cross-platform flock/shlock detection\n- Update acquire_lock to use flock when available (faster, kernel-enforced)\n- Keep JSON metadata file for human-readable lock info\n- Lock location stays at .claude/locks/{session}.lock\n\nFunctions to add:\n- detect_flock() - Returns 'flock' | 'shlock' | 'noclobber'\n- acquire_flock() - flock-based lock acquisition\n\nNOTE: This is a REFACTOR of existing lock.sh, not a new locks.sh file.","acceptance_criteria":"- [ ] detect_flock() returns 'flock' (Linux), 'shlock' (macOS w/o brew flock), or 'noclobber' (fallback)\n- [ ] Existing acquire_lock/release_lock functions still work (backward compatible)\n- [ ] New flock-based path used when flock available (verify with strace or dtruss)\n- [ ] Lock file still contains JSON metadata (session, pid, started_at)\n- [ ] Stale lock detection still works (dead PID check)\n- [ ] Unit tests pass: ./scripts/run.sh test locks","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T09:48:03.782195308+01:00","created_by":"ubuntu","updated_at":"2026-01-14T10:25:09.980787223+01:00","closed_at":"2026-01-14T10:25:09.980787223+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"]}
{"id":"agent-pipelines-6vl","title":"Engine: use flock locking and add compatibility mode","description":"Add flock-based locking and legacy compatibility to engine.sh.\n\nCHANGES (concerns 3 \u0026 5 from original e7j):\n\n1. USE FLOCK LOCKING:\n   - Call lock.sh functions for session locking (detect_flock, acquire_lock, release_lock)\n   - Ensure lock released on exit via trap handler\n   - Replace any direct lock file manipulation with lock.sh calls\n\n2. COMPATIBILITY MODE:\n   - If events.jsonl exists: use event-sourced execution (new path)\n   - If only state.json exists: use legacy execution (existing path)\n   - AGENT_PIPELINES_LEGACY=1 env var forces legacy mode\n   - IMPORTANT: Don't break existing sessions mid-flight\n\nAcceptance Criteria:\n- [ ] Locking uses lock.sh functions (detect_flock, acquire_lock, release_lock)\n- [ ] Lock released on exit (trap handler)\n- [ ] Legacy compatibility: sessions without events.jsonl use existing state.json path\n- [ ] AGENT_PIPELINES_LEGACY=1 forces legacy mode\n- [ ] Existing tests pass after changes","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T10:06:22.865268586+01:00","created_by":"ubuntu","updated_at":"2026-01-14T11:55:10.737114448+01:00","closed_at":"2026-01-14T11:55:10.737114448+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-6vl","depends_on_id":"agent-pipelines-6bw","type":"blocks","created_at":"2026-01-14T10:06:22.914329404+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-7e9","title":"Create test_deps.sh unit tests","description":"Create scripts/tests/test_deps.sh following TDD pattern:\n\nTEST FILE STRUCTURE:\n1. Source scripts/lib/test.sh for assertions\n2. Source scripts/lib/deps.sh (the module under test)\n\nTEST CASES:\n- test_check_jq_version_valid: Mock 'jq-1.6' output, expect pass\n- test_check_jq_version_old: Mock 'jq-1.5' output, expect fail\n- test_check_yq_v4_detected: Mock yq v4 output, expect pass\n- test_check_yq_v3_rejected: Mock yq (Python) output, expect fail\n- test_check_deps_missing_tool: Mock missing jq, expect helpful error message\n- test_install_instructions_linux: Verify apt-get instructions shown\n- test_install_instructions_macos: Verify brew instructions shown\n\nMOCKING STRATEGY:\n- Create temp bin directory with mock scripts\n- Prepend to PATH during tests\n- Mock scripts echo version strings","acceptance_criteria":"- [ ] Tests for jq version detection\n- [ ] Tests for yq v4 detection (vs Python v3)\n- [ ] Tests for missing dependency errors\n- [ ] Tests for OS-specific install instructions (apt vs brew)\n- [ ] All tests pass via ./scripts/run.sh test deps","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T09:48:54.860251971+01:00","created_by":"ubuntu","updated_at":"2026-01-14T12:01:07.024981639+01:00","closed_at":"2026-01-14T12:01:07.024981639+01:00","close_reason":"Closed","labels":["pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-7e9","depends_on_id":"agent-pipelines-7va","type":"blocks","created_at":"2026-01-14T09:49:27.965994661+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-7va","title":"Create deps.sh for dependency validation","description":"Create scripts/lib/deps.sh to validate required dependencies:\n\nRequired tools:\n- jq (1.6+) - JSON processing\n- yq (v4+, Go-based Mike Farah version, NOT Python yq)\n- tmux (if --tmux mode used)\n- bd (beads CLI, if queue termination used)\n\nVersion detection:\n- jq: Parse 'jq --version' output (jq-1.6, jq-1.7)\n- yq: Detect v3 (Python) vs v4 (Go) - different CLI syntax\n- tmux: Just check existence\n- bd: Just check existence\n\nFunctions:\n- check_deps() - Main validation entry point, called by engine.sh\n- check_jq_version() - Validate jq \u003e= 1.6\n- check_yq_version() - Validate yq v4 (Go-based)\n- print_install_instructions(tool) - OS-specific install help\n\nExit codes:\n- 0: All required deps present\n- 1: Missing required dep (error message explains which)\n\nNOTE: Do NOT include flock detection here - that belongs in lock.sh","acceptance_criteria":"- [ ] check_deps() validates jq, yq exist and meet version requirements\n- [ ] check_jq_version() correctly parses 'jq --version' and requires \u003e= 1.6\n- [ ] check_yq_version() detects yq v4 (Go) vs v3 (Python) - rejects Python version\n- [ ] Helpful error messages with OS-specific install instructions (apt, brew, etc.)\n- [ ] engine.sh sources this file and calls check_deps() early in startup\n- [ ] Unit tests pass: ./scripts/run.sh test deps","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T09:47:53.910822294+01:00","created_by":"ubuntu","updated_at":"2026-01-14T10:35:59.618700849+01:00","closed_at":"2026-01-14T10:35:59.618700849+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"]}
{"id":"agent-pipelines-8wh","title":"Create test_compile.sh unit tests","description":"Create scripts/tests/test_compile.sh following TDD pattern:\n\nTEST FILE STRUCTURE:\n1. Source scripts/lib/test.sh for assertions\n2. Source scripts/lib/compile.sh (the module under test)\n\nTEST CASES:\n- test_compile_single_stage: Single node pipeline produces valid plan.json\n- test_compile_multi_stage: Multi-stage pipeline has correct node ordering\n- test_stage_resolution: Finds stage.yaml in scripts/stages/{name}/\n- test_missing_stage_error: Clear error message for unknown stage\n- test_termination_normalized: All termination types have consistent shape\n- test_idempotent: Same input produces byte-identical output\n- test_source_sha256: plan.json includes source file hash\n- test_version_field: plan.json has version: 1\n- test_parallel_block_nodes: Parallel blocks expand to correct node structure\n\nUSE EXISTING FIXTURES:\n- Use scripts/stages/improve-plan/ as real stage\n- Use scripts/pipelines/quick-refine.yaml as real pipeline\n- Create minimal test fixtures for edge cases","acceptance_criteria":"- [ ] Tests for single-stage compilation\n- [ ] Tests for multi-stage compilation\n- [ ] Tests for stage resolution\n- [ ] Tests for termination types\n- [ ] Tests for error cases\n- [ ] Idempotency verification\n- [ ] All tests pass via ./scripts/run.sh test compile","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T09:49:11.370924317+01:00","created_by":"ubuntu","updated_at":"2026-01-14T12:13:03.338402694+01:00","closed_at":"2026-01-14T12:13:03.338402694+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-8wh","depends_on_id":"agent-pipelines-k9n","type":"blocks","created_at":"2026-01-14T09:49:28.164764248+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-8xz","title":"REFINE: Split e7j (engine.sh) into smaller beads","description":"agent-pipelines-e7j is TOO LARGE. It has 5 concerns and 8 acceptance criteria:\n\n1. Read plan.json (plan management)\n2. Emit events (observability)\n3. Use flock locking (operational)\n4. Recompilation logic (plan management)\n5. Compatibility mode (operational)\n\nACTION REQUIRED: Split e7j into 2-3 focused beads:\n- Bead A: Plan reading + recompilation (concerns 1 \u0026 4)\n- Bead B: Event emission (concern 2)  \n- Bead C: Flock locking + compatibility mode (concerns 3 \u0026 5)\n\nUpdate dependencies so the new beads depend on e7j's current dependencies, then have e7j reduced to 'integrate components' or deleted entirely.\n\nThis split reduces risk of the work loop getting stuck on one mega-bead.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T10:01:32.130556567+01:00","created_by":"ubuntu","updated_at":"2026-01-14T10:06:35.202671094+01:00","closed_at":"2026-01-14T10:06:35.202671094+01:00","close_reason":"Split e7j into e1l, l0y, and 6vl as requested","labels":["pipeline/v3-event-spine"]}
{"id":"agent-pipelines-a8d","title":"Create beads queue provider","description":"Create scripts/lib/queue-providers/beads/ with provider implementation.\n\nExtract current beads behavior from beads-empty.sh into provider commands.\n\n**Files to create:**\n- provider.yaml - Metadata and config schema\n- list - List ready beads as JSON array\n- count - Count ready beads (bd ready | grep -c)\n- claim - Mark bead in_progress (bd update --status=in_progress)\n- complete - Close bead (bd close)\n- show - Show bead details (bd show)\n- release (optional) - Release claim (bd update --status=open)\n\n**provider.yaml:**\n```yaml\nname: beads\ndescription: Beads CLI task queue\nrequires:\n  - bd\n  - jq\nconfig_schema:\n  label_prefix:\n    type: string\n    default: \"pipeline/\"\n    description: Prefix for session labels\n```\n\n**Environment variables received:**\n- QUEUE_SESSION - Session name\n- QUEUE_LABEL - Label for filtering (pipeline/$SESSION)\n- QUEUE_ITEM_ID - Item ID (for claim/show/complete)\n- QUEUE_CONFIG - Provider config as JSON\n\nAll commands must be executable shell scripts.","acceptance_criteria":"- [ ] queue-providers/beads/ directory exists\n- [ ] provider.yaml with metadata and config schema\n- [ ] list command outputs JSON array of ready beads\n- [ ] count command outputs number of ready beads\n- [ ] claim command sets bead status to in_progress\n- [ ] complete command closes bead\n- [ ] show command outputs bead details\n- [ ] release command (optional) restores bead to open status\n- [ ] All commands are executable\n- [ ] Commands use QUEUE_SESSION, QUEUE_LABEL, QUEUE_ITEM_ID env vars","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T09:39:35.206043039+01:00","created_by":"ubuntu","updated_at":"2026-01-13T09:56:40.131379649+01:00","closed_at":"2026-01-13T09:56:40.131379649+01:00","close_reason":"Closed","labels":["pipeline/provider-config"],"dependencies":[{"issue_id":"agent-pipelines-a8d","depends_on_id":"agent-pipelines-w1w","type":"blocks","created_at":"2026-01-13T09:39:46.123392144+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-bt9","title":"Create test_events.sh unit tests","description":"Create scripts/tests/test_events.sh following TDD pattern:\n\nTEST FILE STRUCTURE:\n1. Source scripts/lib/test.sh for assertions\n2. Source scripts/lib/events.sh (the module under test)\n\nTEST CASES:\n- test_append_event_creates_file: First event creates events.jsonl\n- test_append_event_valid_json: Event line is valid JSON (jq parse)\n- test_append_event_atomic: Verify temp+mv pattern (no partial writes)\n- test_read_events_empty: Empty file returns []\n- test_read_events_multiple: Returns all events as array\n- test_last_event_no_filter: Returns most recent event\n- test_last_event_with_type: Returns most recent of given type\n- test_tail_events_offset: Reads from line N onwards\n- test_count_events: Returns accurate line count\n- test_truncated_line_skipped: Incomplete final line handled gracefully\n- test_cursor_format: Cursor contains node_path, node_run, iteration\n\nMOCKING STRATEGY:\n- Use temp directories for events.jsonl\n- Pre-populate with known event sequences\n- Simulate truncation by truncating file mid-write","acceptance_criteria":"- [ ] Tests for append_event atomicity\n- [ ] Tests for read_events parsing\n- [ ] Tests for last_event filtering\n- [ ] Tests for tail_events offset\n- [ ] Edge case: empty file\n- [ ] Edge case: truncated line\n- [ ] All tests pass via ./scripts/run.sh test events","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T09:49:03.37435114+01:00","created_by":"ubuntu","updated_at":"2026-01-14T12:05:29.336414701+01:00","closed_at":"2026-01-14T12:05:29.336414701+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-bt9","depends_on_id":"agent-pipelines-dzi","type":"blocks","created_at":"2026-01-14T09:49:28.034464312+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-dhu","title":"Add file backend to queue.sh","description":"Extend queue.sh to support file-based todos as a second backend.\n\nCreate scripts/lib/queue-providers/file/ with all required commands.\n\n**File format:** Markdown files with YAML frontmatter:\n```markdown\n---\nstatus: pending\n---\n# Task title\n\nTask description here\n```\n\n**Config schema:**\n```yaml\nqueue:\n  provider: file\n  config:\n    directory: todos\n    pattern: \"*.md\"\n    status_field: status\n    ready_status: pending\n    in_progress_status: in_progress\n    completed_status: completed\n```\n\n**Implementation details:**\n- Use yq for YAML parsing if available\n- Fall back to grep regex if yq not installed (document limitations)\n- Use flock for basic concurrency protection during claim\n- ID = filename without extension\n\n**Commands to implement:**\n- list: Find files where frontmatter status = ready_status\n- count: Count ready files\n- claim: Update frontmatter status to in_progress_status\n- complete: Update frontmatter status to completed_status\n- show: Output file contents","acceptance_criteria":"- [ ] queue-providers/file/ directory exists\n- [ ] provider.yaml with config schema\n- [ ] list command finds ready files by frontmatter status\n- [ ] count command returns count of ready files\n- [ ] claim updates frontmatter status to in_progress\n- [ ] complete updates frontmatter status to completed  \n- [ ] show outputs file contents\n- [ ] Uses flock for claim concurrency protection\n- [ ] Works with yq if available\n- [ ] Falls back to grep regex without yq\n- [ ] Unit tests cover file backend operations","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-13T09:35:59.499823068+01:00","created_by":"ubuntu","updated_at":"2026-01-13T10:29:13.174495197+01:00","closed_at":"2026-01-13T10:29:13.174495197+01:00","close_reason":"Closed","labels":["pipeline/provider-config"],"dependencies":[{"issue_id":"agent-pipelines-dhu","depends_on_id":"agent-pipelines-w1w","type":"blocks","created_at":"2026-01-13T09:36:31.111540844+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-dzi","title":"Create events.sh for append-only event logging","description":"Create scripts/lib/events.sh for the append-only event spine:\n\nFILE LOCATION: .claude/pipeline-runs/{session}/events.jsonl\n\nEVENT FORMAT (JSON Lines):\n{\n  \"ts\": \"2026-01-14T10:00:00Z\",\n  \"type\": \"iteration_start\",\n  \"session\": \"auth\",\n  \"cursor\": {\"node_path\": 0, \"node_run\": 1, \"iteration\": 1},\n  \"data\": {...}\n}\n\nCURSOR FIELDS:\n- node_path: Index of the current node in plan.json nodes array (0-indexed)\n- node_run: Which run of this node (1-indexed, nodes can run multiple times via runs: N)\n- iteration: Current iteration within this run (1-indexed)\n\nEVENT TYPES:\n- session_start: Pipeline begins\n- iteration_start: Before Claude invocation\n- worker_complete: Claude exited (with exit code in data)\n- iteration_complete: After status.json processed\n- session_complete: All nodes done\n- error: Failure occurred\n\nFUNCTIONS:\n- append_event(type, session, cursor, data) - Atomic write to events.jsonl\n- read_events(session) - Read all events as JSON array\n- last_event(session, type?) - Get last event, optionally filtered by type\n- tail_events(session, offset) - Read events starting from line offset\n- count_events(session) - Return line count for offset comparison\n\nATOMICITY:\n- Write to temp file, then 'mv' to events.jsonl\n- Handles concurrent appends safely (each event is one atomic line)\n\nEDGE CASES:\n- Handle truncated final line (skip and warn)\n- Handle empty file (return empty array)\n- Create parent dirs if missing","acceptance_criteria":"- [ ] append_event() writes atomic JSON line (temp file + mv pattern)\n- [ ] read_events() returns all events as jq-parseable JSON array\n- [ ] last_event() finds most recent event, filtered by type if provided\n- [ ] tail_events(offset) returns events from line N onwards\n- [ ] count_events() returns accurate line count\n- [ ] Handles truncated final line gracefully (skip, warn to stderr)\n- [ ] Handles empty/missing events.jsonl (returns empty array, creates dirs)\n- [ ] Event file can grow to 100MB without issues (rotation is optional v2)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T09:48:17.097802001+01:00","created_by":"ubuntu","updated_at":"2026-01-14T10:43:41.289373689+01:00","closed_at":"2026-01-14T10:43:41.289373689+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-dzi","depends_on_id":"agent-pipelines-7va","type":"blocks","created_at":"2026-01-14T09:49:27.51079535+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-e1l","title":"Engine: read plan.json and handle recompilation","description":"Update engine.sh to read compiled plans instead of parsing YAML each iteration.\n\nCURRENT STATE: engine.sh parses YAML and state.json each iteration.\n\nCHANGES (concerns 1 \u0026 4 from original e7j):\n\n1. READ PLAN.JSON:\n   - On startup, read plan.json instead of re-parsing YAML\n   - plan.json contains pre-resolved nodes with termination config\n   - Source plan from compile.sh output\n\n2. RECOMPILATION:\n   - Add --recompile flag to force plan regeneration\n   - Auto-recompile when source YAML mtime \u003e plan.json mtime\n   - Call compile.sh when recompilation needed\n\nAcceptance Criteria:\n- [ ] Engine reads plan.json for node execution order and config\n- [ ] --recompile flag triggers plan regeneration via compile.sh\n- [ ] Auto-recompile when YAML newer than plan.json (mtime comparison)\n- [ ] Existing tests pass after changes","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T10:05:51.718906213+01:00","created_by":"ubuntu","updated_at":"2026-01-14T11:31:42.277840689+01:00","closed_at":"2026-01-14T11:31:42.277840689+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-e1l","depends_on_id":"agent-pipelines-k9n","type":"blocks","created_at":"2026-01-14T10:05:51.752821914+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-e7j","title":"Update engine.sh for compiled plan execution","description":"Update scripts/engine.sh to use compiled plans and emit events:\n\nCURRENT STATE: engine.sh (600+ lines) parses YAML and state.json each iteration.\n\nCHANGES NEEDED:\n\n1. READ PLAN.JSON:\n   - On startup, read plan.json instead of re-parsing YAML\n   - plan.json contains pre-resolved nodes with termination config\n\n2. EMIT EVENTS:\n   - session_start: When pipeline begins\n   - iteration_start: Before each Claude invocation\n   - worker_complete: When Claude exits (with exit code)\n   - iteration_complete: After status.json processed\n   - session_complete: When all nodes done\n   - error: On any failure\n\n3. USE FLOCK LOCKING:\n   - Call lock.sh functions for session locking\n   - Ensure lock released on exit (trap handler)\n\n4. RECOMPILATION:\n   - --recompile flag forces plan regeneration\n   - Auto-recompile when source YAML mtime \u003e plan.json mtime\n\n5. COMPATIBILITY MODE:\n   - If events.jsonl exists: event-sourced execution (new path)\n   - If only state.json exists: legacy execution (existing path)\n   - AGENT_PIPELINES_LEGACY=1 env var forces legacy\n\nIMPORTANT: Don't break existing sessions mid-flight.","acceptance_criteria":"- [ ] Engine reads plan.json for node execution order and config\n- [ ] Events emitted at: session_start, iteration_start, worker_complete, iteration_complete, session_complete, error\n- [ ] Locking uses lock.sh functions (detect_flock, acquire_lock, release_lock)\n- [ ] --recompile flag triggers plan regeneration\n- [ ] Auto-recompile when YAML newer than plan.json (mtime comparison)\n- [ ] Legacy compatibility: sessions without events.jsonl use existing state.json path\n- [ ] AGENT_PIPELINES_LEGACY=1 forces legacy mode\n- [ ] All existing tests pass: ./scripts/run.sh test","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T09:48:46.848335348+01:00","created_by":"ubuntu","updated_at":"2026-01-14T10:06:39.768430294+01:00","closed_at":"2026-01-14T10:06:39.768430294+01:00","close_reason":"Split into smaller beads: e1l (plan management), l0y (events), 6vl (locking/compat)","labels":["pipeline/v3-event-spine"],"dependencies":[{"issue_id":"agent-pipelines-e7j","depends_on_id":"agent-pipelines-k9n","type":"blocks","created_at":"2026-01-14T09:49:27.774569333+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-e7j","depends_on_id":"agent-pipelines-dzi","type":"blocks","created_at":"2026-01-14T09:49:27.838443235+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-e7j","depends_on_id":"agent-pipelines-6bw","type":"blocks","created_at":"2026-01-14T09:49:27.872357548+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-e7j","depends_on_id":"agent-pipelines-zms","type":"blocks","created_at":"2026-01-14T09:49:27.916827781+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-k9n","title":"Create compile.sh for YAML to plan.json compilation","description":"Create scripts/lib/compile.sh to compile pipeline YAML into plan.json:\n\nPURPOSE: Convert human-readable YAML into machine-optimized JSON for fast execution.\n\nINPUT:\n- Pipeline YAML file path (e.g., scripts/pipelines/refine.yaml)\n- Session name\n- Run directory\n\nOUTPUT: plan.json in session directory\n\nPLAN.JSON STRUCTURE:\n{\n  \"version\": 1,\n  \"compiled_at\": \"2026-01-14T10:00:00Z\",\n  \"source\": {\"path\": \"...\", \"sha256\": \"...\"},\n  \"session\": {\"name\": \"auth\", \"created_at\": \"...\"},\n  \"dependencies\": {\"jq\": true, \"yq\": true, \"tmux\": false, \"bd\": false},\n  \"nodes\": [\n    {\n      \"path\": 0,\n      \"id\": \"plan\",\n      \"kind\": \"stage\",\n      \"ref\": \"improve-plan\",\n      \"termination\": {\"type\": \"judgment\", \"consensus\": 2, \"min_iterations\": 2, \"max\": 5},\n      \"provider\": {\"type\": \"claude_code\", \"model\": \"opus\"},\n      \"inputs\": {}\n    }\n  ]\n}\n\nSTAGE RESOLUTION:\n- Read stage.yaml from scripts/stages/{ref}/\n- Merge termination config (pipeline overrides \u003e stage defaults)\n- Resolve provider settings (default: claude, opus)\n\nDEPENDENCY INFERENCE:\n- tmux: true if any stage has tmux mode\n- bd: true if any stage has queue termination\n\nFUNCTIONS:\n- compile_plan(yaml_path, session, run_dir) - Main entry point\n- resolve_stage(stage_name) - Find and parse stage.yaml\n- normalize_termination(config) - Ensure consistent termination shape\n- infer_dependencies(nodes) - Scan nodes for tmux/bd requirements\n\nIDEMPOTENCY: Same inputs produce identical output (deterministic, excluding compiled_at timestamp for comparison purposes).","acceptance_criteria":"- [ ] compile_plan() produces valid plan.json\n- [ ] Resolves stage references to scripts/stages/{name}/stage.yaml\n- [ ] Normalizes termination config (fixed/queue/judgment all have consistent shape)\n- [ ] Computes source sha256 for change detection\n- [ ] Idempotent: same inputs produce identical JSON output (byte-for-byte)\n- [ ] Clear error messages for missing stages\n- [ ] Validates plan.json schema before writing\n- [ ] Single-stage 'loop' compilation also works (pipeline with 1 node)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T09:48:27.593493709+01:00","created_by":"ubuntu","updated_at":"2026-01-14T11:02:20.761124325+01:00","closed_at":"2026-01-14T11:02:20.761124325+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-k9n","depends_on_id":"agent-pipelines-7va","type":"blocks","created_at":"2026-01-14T09:49:27.673978058+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-l0y","title":"Engine: emit events to events.jsonl","description":"Add event emission to engine.sh for observability and crash recovery.\n\nCHANGES (concern 2 from original e7j):\n\nEMIT EVENTS via events.sh:\n- session_start: When pipeline begins\n- iteration_start: Before each Claude/Codex invocation\n- worker_complete: When agent process exits (with exit code)\n- iteration_complete: After status.json processed\n- session_complete: When all nodes done\n- error: On any failure\n\nCall append_event() from events.sh at each point.\n\nAcceptance Criteria:\n- [ ] Events emitted at: session_start, iteration_start, worker_complete, iteration_complete, session_complete, error\n- [ ] Events written to events.jsonl via events.sh functions\n- [ ] Events include cursor (node_path, node_run, iteration) and relevant data\n- [ ] Existing tests pass after changes","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T10:06:15.585334892+01:00","created_by":"ubuntu","updated_at":"2026-01-14T11:45:50.565952987+01:00","closed_at":"2026-01-14T11:45:50.565952987+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-l0y","depends_on_id":"agent-pipelines-dzi","type":"blocks","created_at":"2026-01-14T10:06:15.662413608+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-par","title":"Write unit tests for queue.sh","description":"Create tests/test_queue.sh with unit tests for queue.sh:\n\n**Test cases:**\n1. load_queue_provider() with valid beads provider\n2. load_queue_provider() fails for nonexistent provider  \n3. load_queue_provider() fails if required commands missing\n4. queue_count() returns count from provider\n5. queue_list() returns JSON from provider\n6. queue_claim() passes QUEUE_ITEM_ID correctly\n7. queue_complete() passes QUEUE_ITEM_ID correctly\n8. Timeout kills hung provider commands\n9. Timeout returns exit code 2\n\n**Mocking approach:**\nCreate mock provider in test temp dir with simple shell scripts.\nDo NOT test actual bd CLI - that's for integration tests.\n\nUse existing test patterns from tests/ directory.","acceptance_criteria":"- [ ] test_queue.sh exists in tests/\n- [ ] Tests load_queue_provider() success and failure cases\n- [ ] Tests all queue_* functions with mock provider\n- [ ] Tests timeout behavior\n- [ ] Tests pass in CI\n- [ ] Follows existing test patterns (setup/teardown, assertions)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T09:36:14.311134358+01:00","created_by":"ubuntu","updated_at":"2026-01-13T10:09:39.660147988+01:00","closed_at":"2026-01-13T10:09:39.660147988+01:00","close_reason":"Closed","labels":["pipeline/provider-config"],"dependencies":[{"issue_id":"agent-pipelines-par","depends_on_id":"agent-pipelines-w1w","type":"blocks","created_at":"2026-01-13T09:36:31.285021273+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-rb1","title":"Add orphaned bead cleanup for crashed sessions","description":"When a pipeline session dies mid-task (crash, kill, timeout), beads claimed by that session stay in_progress indefinitely. This blocks future agents from picking them up.\n\nPROBLEM:\n- Agent claims bead with bd update \u003cid\u003e --status=in_progress\n- Session crashes/killed before agent completes\n- Bead stays in_progress forever\n- Future sessions see it as 'claimed' and skip it\n\nSOLUTION OPTIONS:\n1. **Startup cleanup**: On session start, check for in_progress beads with stale timestamps (\u003e30min?) and reset to open\n2. **Lock file association**: Store claimed bead ID in session lock file, auto-release on lock cleanup\n3. **Heartbeat mechanism**: Agent periodically touches bead, timeout resets stale claims\n4. **bd ready --include-stale**: Flag to include in_progress beads older than threshold\n\nRECOMMENDED: Option 1 or 2 - simplest, no ongoing overhead.\n\nAcceptance Criteria:\n- [ ] Crashed sessions don't leave beads permanently stuck in in_progress\n- [ ] Mechanism documented in CLAUDE.md\n- [ ] Works with both Claude and Codex providers","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-14T10:26:45.242421301+01:00","created_by":"ubuntu","updated_at":"2026-01-14T12:54:18.069420358+01:00","closed_at":"2026-01-14T12:54:18.069420358+01:00","close_reason":"Closed","labels":["pipeline/v3-event-spine","pipeline/v3-spine"]}
{"id":"agent-pipelines-s0p","title":"Add queue commands to context.json","description":"Update scripts/lib/context.sh and scripts/engine.sh for queue provider integration.\n\n**context.sh changes:**\nAdd a 'queue' block with commands the agent can use:\n{\n  \"queue\": {\n    \"provider\": \"beads\",\n    \"commands\": {\n      \"list\": \"bd ready --label=pipeline/$SESSION\",\n      \"claim\": \"bd update {{id}} --status=in_progress\",\n      \"complete\": \"bd close {{id}}\"\n    }\n  }\n}\n\n**engine.sh changes (in load_stage()):**\n```bash\nlocal queue_provider=$(json_get \"$STAGE_CONFIG\" \".queue.provider\" \"beads\")\nlocal queue_config=$(json_get \"$STAGE_CONFIG\" \".queue.config\" \"{}\")\n\nif [ \"$STAGE_COMPLETION\" = \"queue-empty\" ] || [ \"$STAGE_COMPLETION\" = \"beads-empty\" ]; then\n  load_queue_provider \"$queue_provider\" \"$queue_config\" || return 1\nfi\n```\n\n**Important:**\n- Use `{{id}}` placeholder for item ID (per plan standard)\n- `.queue.commands` is SEPARATE from `.commands` (test/build/lint)\n- Only inject when queue completion strategy is used\n\nAgent substitutes {{id}} via: ${cmd//\\{\\{id\\}\\}/$ITEM_ID}","acceptance_criteria":"- [ ] context.json includes queue.provider when queue completion used\n- [ ] context.json includes queue.commands with list/claim/complete\n- [ ] Commands use {{id}} placeholder (not $ID) for item ID\n- [ ] .queue namespace separate from .commands namespace\n- [ ] Prompts can access via jq '.queue.commands.list'\n- [ ] engine.sh calls load_queue_provider() for queue-empty/beads-empty stages\n- [ ] Only added when stage uses queue-based termination\n- [ ] Backward compatible - no changes to existing context structure","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T09:35:41.863664505+01:00","created_by":"ubuntu","updated_at":"2026-01-13T10:04:36.032290601+01:00","closed_at":"2026-01-13T10:04:36.032290601+01:00","close_reason":"Closed","labels":["pipeline/provider-config"],"dependencies":[{"issue_id":"agent-pipelines-s0p","depends_on_id":"agent-pipelines-w1w","type":"blocks","created_at":"2026-01-13T09:36:30.927392591+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-scq","title":"Update existing tests for v3 event spine compatibility","description":"Several existing tests assume old state.json format without events.jsonl. These need updating for v3 compatibility.\n\nHIGH PRIORITY TESTS TO UPDATE:\n- test_plateau_double_counting.sh - assumes history format without event reconciliation\n- test_plateau_stage_isolation.sh - plateau filtering may change with events\n- test_completions.sh - mocks state.json without events.jsonl\n- test_engine_config.sh - tests YAML reading, but engine now reads plan.json\n- test_mock.sh - mock system needs event emission support\n- integration/harness.sh - harness needs events.jsonl creation\n- integration/test_single_stage.sh - state update timing may differ\n- integration/test_completion_strategies.sh - fixtures need event support\n- test_engine_integration.sh - needs event file verification\n- integration/test_resume.sh - history preservation depends on events\n- test_regression.sh - add checks for new v3 components\n\nCHANGES NEEDED:\n1. Update mock system (mock.sh) to emit events.jsonl alongside status.json\n2. Update integration harness to support events.jsonl\n3. Fix tests that assume state.json is source of truth (events.jsonl is now primary)\n4. Add verification that events.jsonl exists after engine runs\n5. Update fixtures to include event data where needed\n\nNOTE: Run AFTER all v3 implementation beads complete. This is cleanup/compatibility work.\n\nAcceptance Criteria:\n- [ ] All existing tests pass with v3 implementation\n- [ ] Mock system emits events.jsonl when running in v3 mode\n- [ ] Integration harness creates events.jsonl directory structure\n- [ ] No tests assume old state.json-only format","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T10:20:00.908263784+01:00","created_by":"ubuntu","updated_at":"2026-01-14T12:45:27.485299621+01:00","closed_at":"2026-01-14T12:45:27.485299621+01:00","close_reason":"Closed","labels":["pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-scq","depends_on_id":"agent-pipelines-e1l","type":"blocks","created_at":"2026-01-14T10:20:01.091939278+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-scq","depends_on_id":"agent-pipelines-l0y","type":"blocks","created_at":"2026-01-14T10:20:01.102948031+01:00","created_by":"ubuntu"},{"issue_id":"agent-pipelines-scq","depends_on_id":"agent-pipelines-6vl","type":"blocks","created_at":"2026-01-14T10:20:01.111126292+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-w1w","title":"Create queue.sh abstraction layer","description":"Create scripts/lib/queue.sh with core functions:\n\n**Required functions:**\n- queue_count(session) - Count ready items\n- queue_list(session) - List ready items as JSON  \n- queue_claim(session, id) - Mark item in progress\n- queue_complete(session, id) - Mark item complete\n- queue_show(session, id) - Show item details (optional command forwarding)\n- queue_release(session, id) - Release claim (optional command forwarding)\n\n**Implementation details:**\n- load_queue_provider(provider, config) validates and sets exports:\n  - QUEUE_PROVIDER, QUEUE_PROVIDER_DIR, QUEUE_CONFIG\n- All commands get QUEUE_SESSION and QUEUE_LABEL env vars\n- Add timeout wrapper (30s default, configurable via QUEUE_TIMEOUT)\n- Timeout exit = code 2 (unexpected error)\n- Use function parameters, not env vars for API\n\nFollow scripts/lib/provider.sh style. Provider dirs in scripts/lib/queue-providers/.\nInitially only create the abstraction - beads provider is separate task.","acceptance_criteria":"- [ ] queue.sh exists in scripts/lib/\n- [ ] load_queue_provider() validates provider directory exists\n- [ ] load_queue_provider() checks required commands: list, count, claim, complete\n- [ ] load_queue_provider() exports QUEUE_PROVIDER, QUEUE_PROVIDER_DIR, QUEUE_CONFIG\n- [ ] All queue_* functions pass QUEUE_SESSION and QUEUE_LABEL to commands\n- [ ] Timeout wrapper kills commands after QUEUE_TIMEOUT seconds (default 30)\n- [ ] Returns exit code 2 for timeout/unexpected errors\n- [ ] Follows existing lib/*.sh coding patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T09:35:23.700042374+01:00","created_by":"ubuntu","updated_at":"2026-01-13T09:51:40.902798098+01:00","closed_at":"2026-01-13T09:51:40.902798098+01:00","close_reason":"Closed","labels":["pipeline/provider-config"]}
{"id":"agent-pipelines-wb2","title":"Create test_locks.sh unit tests","description":"Create scripts/tests/test_locks.sh following TDD pattern:\n\nTEST FILE STRUCTURE:\n1. Source scripts/lib/test.sh for assertions\n2. Source scripts/lib/lock.sh (the module under test)\n\nTEST CASES:\n- test_acquire_lock_creates_file: New lock creates .lock file\n- test_acquire_lock_writes_json: Lock file contains session, pid, started_at\n- test_acquire_lock_conflict: Second acquire fails with error message\n- test_release_lock_removes_file: Release deletes lock file\n- test_release_lock_only_owner: Process can only release its own lock\n- test_stale_lock_detected: Dead PID allows new lock acquisition\n- test_is_locked_true: Returns 0 when locked by live process\n- test_is_locked_false: Returns 1 when no lock exists\n- test_detect_flock_linux: Returns 'flock' on Linux\n- test_detect_flock_fallback: Returns 'noclobber' when flock missing\n\nMOCKING STRATEGY:\n- Use temp directories for lock files\n- Fork subprocesses to simulate PID conflicts\n- Test dead PIDs by starting and killing a subprocess","acceptance_criteria":"- [ ] Tests for lock acquisition\n- [ ] Tests for lock conflict detection\n- [ ] Tests for lock release\n- [ ] Tests for stale lock cleanup\n- [ ] All tests pass via ./scripts/run.sh test locks","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T09:49:19.138141633+01:00","created_by":"ubuntu","updated_at":"2026-01-14T12:23:54.840776511+01:00","closed_at":"2026-01-14T12:23:54.840776511+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-wb2","depends_on_id":"agent-pipelines-6bw","type":"blocks","created_at":"2026-01-14T09:49:28.237995808+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-yww","title":"Add queue backend validation to linter","description":"Update scripts/lib/validate.sh to validate queue configuration in stages.\n\n**Validation checks when stage uses queue-empty termination:**\n1. Check queue.provider value is recognized (beads, file)\n2. Validate provider directory exists in scripts/lib/queue-providers/\n3. Check required commands exist and are executable\n4. Validate backend-specific config fields against provider.yaml schema\n5. Warn if provider: file but config.directory doesn't exist\n\n**Example lint output:**\n```\n✓ queue.provider: beads (valid)\n✓ Provider commands: list, count, claim, complete (executable)\n✓ queue commands will be injected into context.json\n```","acceptance_criteria":"- [ ] Linter validates queue.provider value exists\n- [ ] Warns for unknown providers\n- [ ] Checks provider commands are executable\n- [ ] Validates backend-specific config if provider.yaml has schema\n- [ ] Warns if file provider directory doesn't exist\n- [ ] Helpful error messages for misconfig\n- [ ] Integration with existing lint command","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-13T09:36:07.437782555+01:00","created_by":"ubuntu","updated_at":"2026-01-13T10:34:03.478135669+01:00","closed_at":"2026-01-13T10:34:03.478135669+01:00","close_reason":"Closed","labels":["pipeline/provider-config"],"dependencies":[{"issue_id":"agent-pipelines-yww","depends_on_id":"agent-pipelines-w1w","type":"blocks","created_at":"2026-01-13T09:36:31.239627711+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-zms","title":"Update state.sh for event reconciliation","description":"Update scripts/lib/state.sh to support event-sourced state reconciliation:\n\nCURRENT STATE: state.sh has 570+ lines with iteration tracking, parallel block support, crash recovery. State is the source of truth.\n\nCHANGES NEEDED (additive, don't break existing):\n1. Add event_offset field to state.json - tracks last processed event\n2. Add write_snapshot() - Write state.json with event_offset\n3. Add load_snapshot() - Load cached state, check if stale\n4. Add reconcile_with_events() - Rebuild cursor by replaying events.jsonl from offset\n\nNEW WORKFLOW:\n1. On startup: load_snapshot() gets cached state\n2. Compare event_offset vs events.jsonl length\n3. If mismatch: reconcile_with_events() replays missed events\n4. state.json becomes a cache, events.jsonl is source of truth\n\nIMPORTANT: \n- Keep ALL existing functions working (backward compat)\n- New functions should check if events.jsonl exists\n- If no events.jsonl, fall back to current behavior","acceptance_criteria":"- [ ] state.json includes event_offset field (default 0 for legacy files)\n- [ ] write_snapshot() writes state.json with current event_offset\n- [ ] load_snapshot() returns state + stale indicator (offset \u003c events count)\n- [ ] reconcile_with_events() rebuilds cursor by replaying events from offset\n- [ ] Handles missing state.json (full rebuild from events.jsonl)\n- [ ] Handles stale state.json (tail reconciliation from offset)\n- [ ] Backward compatible: existing state files without event_offset still work\n- [ ] All existing tests still pass: ./scripts/run.sh test","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T09:48:36.49574866+01:00","created_by":"ubuntu","updated_at":"2026-01-14T11:13:38.915630391+01:00","closed_at":"2026-01-14T11:13:38.915630391+01:00","close_reason":"Closed","labels":["7e9","pipeline/v3-event-spine","pipeline/v3-spine"],"dependencies":[{"issue_id":"agent-pipelines-zms","depends_on_id":"agent-pipelines-dzi","type":"blocks","created_at":"2026-01-14T09:49:27.721242995+01:00","created_by":"ubuntu"}]}
{"id":"agent-pipelines-zy2","title":"Test bead for queue provider testing","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-13T09:55:40.499511561+01:00","updated_at":"2026-01-13T09:56:16.818730913+01:00","close_reason":"Closed","labels":["test-temp"],"deleted_at":"2026-01-13T09:56:16.818730913+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"loop-agents-03j","title":"Bug 1: Unreachable v3 code path in resolve.sh","description":"v3 file-based code path is dead code. Fix: Remove or refactor.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-12T22:48:09.36232-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:28:37.566993-06:00","closed_at":"2026-01-12T23:28:37.566993-06:00","close_reason":"Added clarifying comment in resolve.sh - code retained for potential future/testing use","labels":["bugs/engine-stability"]}
{"id":"loop-agents-0g5","title":"Phase 4: Parallel block execution","description":"Implement run_parallel_block() and run_parallel_provider() in engine.sh per plans/parallel-blocks-implementation.md Section 4.1. Spawn subshell per provider, collect statuses with wait, build manifest on success. Write Phase 4 tests first (TDD).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T14:38:58.25712-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T15:25:11.365369-06:00","closed_at":"2026-01-13T15:25:11.365369-06:00","close_reason":"Closed","labels":["pipeline/parallel-blocks"],"dependencies":[{"issue_id":"loop-agents-0g5","depends_on_id":"loop-agents-1cg","type":"blocks","created_at":"2026-01-13T14:39:21.407753-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-0kn","title":"Add deduplication for inherited learnings across ancestor sessions","description":"Prevent duplicate learnings when inheriting from sessions with shared ancestry.\n\n**Implementation:**\n- Create deduplicate_json_array() helper using jq 'unique'\n- Apply to learnings, patterns, warnings, decisions before output\n- Same learning from A appearing in both B and C should only appear once in D\n\n**Acceptance criteria:**\n- [ ] Duplicate learnings removed\n- [ ] Order preserved (first occurrence kept)\n- [ ] Works with empty arrays","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:49:22.848667-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:49:22.848667-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-0kn","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T01:54:24.243404-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-137","title":"Create logic.md review prompt","description":"Logic Analyzer prompt:\n- Edge cases (null, empty, boundary)\n- Error handling issues\n- State management bugs, business logic errors\n- Output format with FINDINGS_COUNT","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:52:13.515212-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:40.059229-06:00","closed_at":"2026-01-09T14:13:40.059229-06:00","close_reason":"Completed via loop-engine refactor","labels":["loop/review"],"dependencies":[{"issue_id":"loop-agents-137","depends_on_id":"loop-agents-f1v","type":"blocks","created_at":"2026-01-09T13:52:32.358667-06:00","created_by":"daemon"}]}
{"id":"loop-agents-1cg","title":"Phase 3: Parallel block context generation","description":"Implement from_parallel in context.json per plans/parallel-blocks-implementation.md Section 3. Update generate_context() with parallel scope, implement build_from_parallel_inputs(). Write Phase 3 tests first (TDD).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T14:38:44.371997-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T14:53:05.449384-06:00","closed_at":"2026-01-13T14:53:05.449384-06:00","close_reason":"Closed","labels":["pipeline/parallel-blocks"],"dependencies":[{"issue_id":"loop-agents-1cg","depends_on_id":"loop-agents-obf","type":"blocks","created_at":"2026-01-13T14:39:16.261401-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-1gv","title":"Bug 20: pipeline-assembler.md uses legacy loop: keyword","description":"Agent examples use loop: instead of stage:. Fix: Update documentation.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:47:17.388307-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:25:40.587249-06:00","closed_at":"2026-01-12T23:25:40.587249-06:00","close_reason":"Fixed in bug fixing session","labels":["bugs/engine-stability"]}
{"id":"loop-agents-1o1","title":"Test and verify resume functionality","description":"Resume functionality is untested. Need to verify it works with crashed parallel-providers session. Test: ./scripts/run.sh pipeline \u003cfile\u003e \u003csession\u003e --resume","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T22:08:50.831989-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:17:32.848379-06:00","closed_at":"2026-01-12T22:17:32.848379-06:00","close_reason":"State transition bug fixed (loop-agents-t13). Resume functionality now works correctly.","labels":["bugs/engine"]}
{"id":"loop-agents-1t3","title":"Resume crashed parallel-providers session at stage 3","description":"The parallel-providers pipeline crashed at stage 3 (refine-beads). Need to test resume functionality to continue from where it left off.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T22:09:08.575635-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:17:32.851812-06:00","closed_at":"2026-01-12T22:17:32.851812-06:00","close_reason":"State transition bug fixed (loop-agents-t13). Resume functionality now works correctly.","labels":["bugs/engine"]}
{"id":"loop-agents-1u4","title":"Bug 5: Zero-iterations edge case creates empty stage dir","description":"Stage dir created even if zero iterations run. Fix: Only create on first iteration.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-12T22:48:14.532703-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:28:43.482497-06:00","closed_at":"2026-01-12T23:28:43.482497-06:00","close_reason":"Edge case - runs:0 is not a practical configuration. Zero iterations prevented by engine loop structure.","labels":["bugs/engine-stability"]}
{"id":"loop-agents-1zt","title":"Create unit tests for inheritance in test_inherit.sh","description":"Comprehensive unit tests for the inheritance library.\n\n**File location:** scripts/tests/test_inherit.sh\n\n**Setup fixture:**\n```bash\nsetup_mock_session() {\n  local name=$1 status=$2\n  local dir=\"$TEST_RUNS_DIR/$name\"\n  mkdir -p \"$dir/stage-00-test/iterations/001\"\n  echo '{\"status\": \"'$status'\", \"started_at\": \"2026-01-01T00:00:00Z\"}' \u003e \"$dir/state.json\"\n  echo '{\"decision\": \"stop\", \"learnings\": [\"test learning 1\"]}' \u003e \"$dir/stage-00-test/iterations/001/status.json\"\n  echo \"# Progress\" \u003e \"$dir/progress-$name.md\"\n}\n```\n\n**Tests to implement (14 total):**\n1. test_inherit_from_complete_session - happy path\n2. test_inherit_from_missing_session - exit code 1\n3. test_inherit_from_running_session - warns, returns valid JSON\n4. test_inherit_secret_filtering - API_KEY=sk-123 stripped\n5. test_inherit_empty_learnings - no learnings array\n6. test_inherit_large_session - \u003e100 learnings truncated\n7. test_inherit_circular_detection - A→B→A returns {}\n8. test_inherit_invalid_json - malformed status.json skipped\n9. test_inherit_depth_limit - stops at 3 levels\n10. test_inherit_deduplication - same learning appears once\n11. test_inherit_lineage_tracking - ancestors in lineage array\n12. test_filter_secrets_preserves_normal - non-secrets preserved\n13. test_filter_secrets_edge_cases - empty, single line, unicode\n14. test_session_name_validation - rejects commas\n\n**Test environment:**\n- Override PROJECT_ROOT to test temp dir\n- Clean up test dirs in teardown\n- Source inherit.sh and test framework\n\n**Acceptance criteria:**\n- [ ] All 14 tests implemented\n- [ ] setup_mock_session() fixture helper created\n- [ ] Tests run in isolated temp directory\n- [ ] PROJECT_ROOT override documented\n- [ ] Tests pass with: ./scripts/tests/test_inherit.sh","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:53:11.662435-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T02:02:42.378937-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-1zt","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T01:55:55.70902-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-20t","title":"Create scripts/lib/judge.sh for judgment termination","description":"Create the judge module for judgment-based termination:\n\nThe judge is a separate Claude invocation that evaluates whether work is complete.\n\nJudge receives read-only context:\n- latest result.json\n- node output so far\n- progress.md\n- termination criteria\n\nJudge returns:\n{\"stop\": true, \"reason\": \"plateau\", \"confidence\": 0.82}\n\nJudgment policy (v1):\n- Stop when judge returns stop=true for TWO consecutive iterations\n- max iteration cap still applies\n- min_iterations must complete before judgment begins (default: 2)\n- worker signals.plateau_suspected is advisory input\n\nJudge prompt location: scripts/prompts/judge.md (built-in) or ~/.config override\n\nFailure handling:\n- Invalid JSON → treat as stop: false, log warning\n- Invocation fails → retry once, then stop: false\n- Confidence \u003c 0.5 → treat as stop: false\n- Three consecutive failures → fall back to fixed max","acceptance_criteria":"- [ ] judge.sh created with render_judge_prompt(), invoke_judge()\n- [ ] Judge prompt template created\n- [ ] Two consecutive stops required for termination\n- [ ] min_iterations respected\n- [ ] Failure handling implemented\n- [ ] Judge invocations logged to events.jsonl\n- [ ] test_judge.sh passes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:45:39.400438-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T09:37:07.782928809+01:00","closed_at":"2026-01-15T09:37:07.782928809+01:00","close_reason":"Closed","labels":["phase/3-termination","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-20t","depends_on_id":"loop-agents-o82","type":"blocks","created_at":"2026-01-14T02:50:42.723496-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-21u","title":"Bug 18: variables.md documents non-working patterns","description":"Docs claim ${INPUTS.stage-name} works but it doesn't. Fix: Update docs or implement.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:47:27.687055-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:53:18.735997-06:00","closed_at":"2026-01-12T22:53:18.735997-06:00","close_reason":"Fixed as part of template update to v3 patterns","labels":["bugs/engine-stability"]}
{"id":"loop-agents-27c","title":"Implement gate action type for hooks","description":"Implement the gate action type that replaces callback servers:\n\nGate modes:\n- file: wait until file exists and optionally matches content\n- command: wait until command returns exit 0\n- queue: wait until queue condition met via command\n\nExample:\n- id: approval\n  type: gate\n  mode: file\n  path: '.claude/approvals/${SESSION}.approved'\n  timeout: 86400\n  on_timeout: abort\n\nTimeout behavior:\n- abort: fail pipeline, emit error event, cleanup\n- continue: log warning, proceed, set gate_status: timeout\n- skip: skip remaining hooks at this point, continue pipeline\n\nCleanup on abort:\n1. Emit gate_timeout event\n2. Emit session_complete with reason: gate_timeout\n3. Release session lock\n4. Exit with code 124 (timeout)","acceptance_criteria":"- [ ] Gate action type implemented\n- [ ] file mode works\n- [ ] command mode works\n- [ ] queue mode works\n- [ ] Timeout handling implemented\n- [ ] on_timeout: abort|continue|skip work correctly\n- [ ] Events emitted for gate start/complete/timeout","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-14T02:46:51.696782-06:00","created_by":"harrisonwells","updated_at":"2026-01-14T02:46:51.696782-06:00","labels":["phase/4-hooks","phase/7-hooks","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-27c","depends_on_id":"loop-agents-p4i","type":"blocks","created_at":"2026-01-14T02:51:16.060253-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-2c4","title":"Create scripts/lib/runtime.sh with unified node executor","description":"Create the runtime module with one recursive executor for all node types:\n\nFunctions:\n- run_session(plan) - entry point\n- run_node(node) - runs any node (stage or nested pipeline)\n- run_stage(node) - runs a stage node\n- run_pipeline(node) - runs a nested pipeline node\n\nNode semantics:\n- 'runs' defaults to 1\n- For stage: executes stage loop with termination settings\n- For pipeline: executes referenced subplan once\n- If runs \u003e 1, repeat with separate run directories\n\nThis replaces separate 'cycles' machinery with unified recursion.","acceptance_criteria":"- [ ] runtime.sh created with run_session(), run_node()\n- [ ] Stage nodes execute correctly\n- [ ] Nested pipeline nodes execute correctly\n- [ ] runs \u003e 1 creates separate run directories\n- [ ] Events emitted for node_start, node_run_start, node_complete\n- [ ] test_runtime.sh passes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:44:37.865871-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T06:17:22.465301559+01:00","closed_at":"2026-01-15T06:17:22.465301559+01:00","close_reason":"Closed","labels":["phase/2-node-executor","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-2c4","depends_on_id":"loop-agents-cim","type":"blocks","created_at":"2026-01-14T02:50:22.023525-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-2lq","title":"Unify run_stage and run_pipeline into single executor","description":"Per 'everything is a pipeline' philosophy, make run_stage a thin wrapper that synthesizes a single-stage pipeline and calls run_pipeline. This eliminates ~100 lines of duplicate iteration lifecycle code.\n\nLocation: scripts/engine.sh\n\nrun_stage() should become:\n1. Synthesize single-stage pipeline JSON (inline, not written to disk)\n2. Call run_pipeline with the synthesized config\n3. Return exit code from run_pipeline\n\nThe wrapper function stays in engine.sh alongside run_pipeline. No new files needed.","acceptance_criteria":"- [ ] run_stage becomes a thin wrapper calling run_pipeline\n- [ ] Single-stage pipelines work identically to before\n- [ ] Multi-stage pipelines work identically to before\n- [ ] All existing tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-14T02:42:48.743088-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.611195806+01:00","labels":["phase/0-foundation","phase/1-foundation","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-2lq","depends_on_id":"loop-agents-8od","type":"blocks","created_at":"2026-01-14T21:37:36.608669-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-2mf","title":"Stage A/B Testing Framework","description":"Add A/B testing support for comparing pipeline configurations.\n\n## Overview\nEnable scientific comparison of stage configurations by running both configurations N times with identical inputs, recording metrics, and generating statistical comparison reports.\n\n## Usage\n```bash\n./scripts/run.sh ab-test \\\n  --config-a \"elegance-3consensus.yaml\" \\\n  --config-b \"elegance-2consensus.yaml\" \\\n  --trials 5 \\\n  --session-prefix \"elegance-ab\"\n```\n\n## Key Features\n1. **Parallel Trial Execution** - Runs both configurations N times with identical inputs\n2. **Metrics Collection** - Records iterations-to-complete, token usage, execution time\n3. **LLM Output Evaluation** - Uses Claude to score output quality on configurable criteria\n4. **Statistical Analysis** - Generates comparison with confidence intervals and significance tests\n5. **Result Storage** - Persists results in `.claude/ab-tests/` for future reference\n\n## Why\nThe pipeline-builder empowers users to create custom stages with arbitrary configurations. Without measurement, they cannot optimize. A/B testing turns pipeline design from art into science.\n\n## Architecture\n- New command: `run.sh ab-test`\n- New library: `scripts/lib/ab-test.sh`\n- Storage: `.claude/ab-tests/{test-id}/`\n- Report format: JSON + Markdown summary","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-12T03:20:03.601258-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:03.601258-06:00","labels":["loop/ab-testing"]}
{"id":"loop-agents-2mf.1","title":"Add ab-test command to run.sh entry point","description":"Extend run.sh to handle the ab-test command.\n\n## Implementation\n1. Add `ab-test)` case in run.sh switch statement\n2. Parse flags: --config-a, --config-b, --trials, --session-prefix, --eval-criteria\n3. Validate both config files exist (in scripts/loops/ or scripts/pipelines/)\n4. Generate unique test-id from session-prefix and timestamp\n5. Delegate to engine.sh ab-test mode or new ab-runner.sh script\n\n## Acceptance Criteria\n- `./scripts/run.sh ab-test --help` shows usage\n- Validates config files before starting\n- Provides clear error messages for missing configs\n- Works with both loop configs (loop.yaml) and pipeline configs (*.yaml)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:16.806375-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:16.806375-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.1","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:20:16.808663-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.1","depends_on_id":"loop-agents-2mf.2","type":"blocks","created_at":"2026-01-12T03:23:03.415621-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2mf.10","title":"Add tests for A/B testing framework","description":"Create test suite for the A/B testing functionality.\n\n## Test File\nscripts/tests/test_ab_test.sh\n\n## Test Cases\n\n### Unit Tests\n1. test_init_ab_test - Creates correct directory structure\n2. test_collect_trial_metrics - Extracts metrics from mock trial\n3. test_calc_statistics - Mean, stddev, t-test calculations\n4. test_generate_report - Report generation from mock data\n\n### Integration Tests\n1. test_ab_test_dry_run - Full flow with mocked Claude\n2. test_ab_test_invalid_configs - Error handling for missing configs\n3. test_ab_test_partial_failure - Handles trial failures gracefully\n\n## Mock Strategy\nUse MOCK_CLAUDE=1 environment variable to return predetermined outputs.\nCreate fixture data in scripts/tests/fixtures/ab-test/.\n\n## Acceptance Criteria\n- All unit tests pass\n- Integration tests cover happy path\n- Error cases tested\n- Can run with ./scripts/run.sh test ab_test","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:22:48.389657-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:22:48.389657-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.10","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:22:48.392645-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.10","depends_on_id":"loop-agents-2mf.7","type":"blocks","created_at":"2026-01-12T03:23:17.008008-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2mf.2","title":"Create ab-test.sh library for test orchestration","description":"Create scripts/lib/ab-test.sh with core A/B testing functions.\n\n## Functions to Implement\n\n### init_ab_test\n```bash\n# Initialize A/B test directory and state\n# Usage: init_ab_test \"$test_id\" \"$config_a\" \"$config_b\" \"$trials\"\n# Returns: test_dir path\ninit_ab_test() {\n  local test_id=$1\n  # Creates .claude/ab-tests/{test-id}/\n  # Writes config.json with test parameters\n  # Returns test directory path\n}\n```\n\n### run_trial\n```bash\n# Run a single trial for one config\n# Usage: run_trial \"$test_dir\" \"$config\" \"$trial_num\" \"$variant\" \"$inputs\"\n# Creates: {test_dir}/trials/{variant}-{trial_num}/\nrun_trial() {\n  # Spawns tmux session or runs inline\n  # Captures metrics during execution\n  # Stores output and state\n}\n```\n\n### get_trial_metrics\n```bash\n# Extract metrics from a completed trial\n# Usage: get_trial_metrics \"$trial_dir\"\n# Returns: JSON with iterations, time, token_usage, status\nget_trial_metrics() {\n  # Reads state.json for iteration count\n  # Calculates execution time from timestamps\n  # Parses Claude output for token info if available\n}\n```\n\n## Acceptance Criteria\n- Library sources without errors\n- init_ab_test creates correct directory structure\n- State file tracks all trials with their status\n- Works with existing engine.sh infrastructure","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:28.690274-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:28.690274-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.2","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:20:28.693169-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2mf.3","title":"Implement trial execution with session isolation","description":"Implement the trial runner that executes both configs N times.\n\n## Design\nEach trial runs in isolation with its own:\n- Session name: `{prefix}-{variant}-{trial_num}` (e.g., `elegance-ab-a-1`)\n- Run directory: `.claude/ab-tests/{test-id}/trials/{variant}-{trial_num}/`\n- Progress file and state file\n\n## Implementation Details\n\n### Sequential vs Parallel\n- Default: Run trials sequentially (simpler, avoids resource contention)\n- Future: Add --parallel flag for concurrent execution\n\n### Trial Flow\n```bash\nfor variant in a b; do\n  for trial in $(seq 1 $trials); do\n    session=\"${prefix}-${variant}-${trial}\"\n    run_dir=\"${test_dir}/trials/${variant}-${trial}\"\n    \n    # Use existing engine.sh with custom run_dir\n    # Capture start_time, end_time, iterations, exit_code\n    \n    record_trial_result \"$test_dir\" \"$variant\" \"$trial\" \"$metrics\"\n  done\ndone\n```\n\n### Input Consistency\n- If inputs are file-based, copy to test_dir once, reference from all trials\n- If inputs are dynamic (like beads), snapshot initial state\n\n## Acceptance Criteria\n- All trials complete without interference\n- Metrics captured for each trial\n- Failed trials dont crash entire test (record failure, continue)\n- Progress visible during execution","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:39.524011-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:39.524011-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.3","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:20:39.527982-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.3","depends_on_id":"loop-agents-2mf.2","type":"blocks","created_at":"2026-01-12T03:23:04.352412-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2mf.4","title":"Implement metrics collection for trials","description":"Collect comprehensive metrics from each trial execution.\n\n## Metrics to Capture\n\n### Core Metrics (from state.json)\n- iterations_total: Number of iterations run\n- iterations_to_complete: Iterations before completion (if terminated early)\n- completion_reason: consensus, max_iterations, queue_empty, etc.\n\n### Timing Metrics\n- started_at: Trial start timestamp\n- completed_at: Trial end timestamp  \n- duration_seconds: Total elapsed time\n- avg_iteration_time: Average time per iteration\n\n### Token Usage (if available)\n- input_tokens: Total input tokens across all iterations\n- output_tokens: Total output tokens across all iterations\n- total_tokens: Sum of input + output\n\n### Quality Indicators\n- errors_count: Number of errors in status.json files\n- files_touched: Aggregate of files modified across iterations\n- work_items_completed: For queue-based stages\n\n## Implementation\nCreate collect_trial_metrics function that:\n1. Reads state.json for iteration counts and timestamps\n2. Calculates duration from timestamps\n3. Aggregates errors from iteration status files\n4. Outputs structured JSON\n\n## Acceptance Criteria\n- All core metrics captured reliably\n- Graceful handling of missing data\n- Token metrics captured when available\n- Output as structured JSON","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:21:04.633523-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:21:04.633523-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.4","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:21:04.63565-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.4","depends_on_id":"loop-agents-2mf.3","type":"blocks","created_at":"2026-01-12T03:23:04.97658-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2mf.5","title":"Implement LLM-based output quality evaluation","description":"Use Claude to evaluate and score output quality from each trial.\n\n## Design\nAfter trials complete, run an LLM evaluation pass to score outputs on configurable criteria.\n\n### Default Evaluation Criteria\n1. Completeness - Did the output address all requirements?\n2. Correctness - Are the changes/conclusions accurate?\n3. Code Quality - For code changes: readability, patterns, test coverage\n4. Efficiency - Conciseness without losing important details\n\n### Evaluation Prompt Template\n```\nYou are evaluating the output of an automated agent session.\n\nSession type: ${stage_type}\nSession goal: ${session_goal}\nEvaluation criteria: ${criteria}\n\n## Agent Output\n${output_content}\n\n## Progress File Summary\n${progress_summary}\n\nScore each criterion on a scale of 1-10 and provide brief justification.\n\nOutput JSON:\n{\n  \"scores\": {\n    \"completeness\": {\"score\": N, \"reason\": \"...\"},\n    \"correctness\": {\"score\": N, \"reason\": \"...\"},\n    ...\n  },\n  \"overall_score\": N,\n  \"summary\": \"Brief overall assessment\"\n}\n```\n\n### Implementation\n```bash\nevaluate_trial_output() {\n  local trial_dir=$1\n  local criteria=${2:-\"completeness,correctness,efficiency\"}\n  \n  # Read output from trial\n  local output_file=$(find \"$trial_dir\" -name \"output.md\" | tail -1)\n  local progress_file=$(find \"$trial_dir\" -name \"progress-*.md\" | head -1)\n  \n  # Build evaluation prompt\n  local prompt=$(build_eval_prompt \"$output_file\" \"$progress_file\" \"$criteria\")\n  \n  # Run evaluation (using haiku for cost efficiency)\n  local result=$(echo \"$prompt\" | claude --model haiku --json)\n  \n  # Save to trial_dir/evaluation.json\n  echo \"$result\" \u003e \"$trial_dir/evaluation.json\"\n}\n```\n\n## Acceptance Criteria\n- Evaluation runs on all completed trials\n- Scores stored in evaluation.json per trial\n- Custom criteria can be passed via --eval-criteria flag\n- Uses cost-efficient model (haiku) by default","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:21:17.174344-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:21:17.174344-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.5","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:21:17.176509-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.5","depends_on_id":"loop-agents-2mf.3","type":"blocks","created_at":"2026-01-12T03:23:05.632993-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2mf.6","title":"Implement statistical comparison analysis","description":"Analyze metrics from both variants and determine statistical significance.\n\n## Statistical Methods\n\n### For Continuous Metrics (iterations, duration, tokens)\n1. Calculate mean and standard deviation for each variant\n2. Run two-sample t-test for significance\n3. Calculate confidence intervals (95%)\n4. Compute effect size (Cohens d)\n\n### For Categorical Metrics (completion_reason)\n1. Chi-squared test for distribution differences\n2. Count frequencies per category\n\n### For Score Metrics (LLM evaluation scores)\n1. Mann-Whitney U test (non-parametric, better for ordinal data)\n2. Median and IQR comparison\n\n## Implementation\n\n### stats.sh Library\n```bash\n# Calculate basic statistics\ncalc_mean() { local arr=(\"$@\"); ... }\ncalc_stddev() { local arr=(\"$@\"); ... }\n\n# T-test for two samples (using bc for precision)\ntwo_sample_ttest() {\n  local -n a_arr=$1\n  local -n b_arr=$2\n  \n  local mean_a=$(calc_mean \"${a_arr[@]}\")\n  local mean_b=$(calc_mean \"${b_arr[@]}\")\n  local std_a=$(calc_stddev \"${a_arr[@]}\")\n  local std_b=$(calc_stddev \"${b_arr[@]}\")\n  local n_a=${#a_arr[@]}\n  local n_b=${#b_arr[@]}\n  \n  # Calculate t-statistic\n  # t = (mean_a - mean_b) / sqrt(var_a/n_a + var_b/n_b)\n  \n  # Look up p-value from t-distribution (approximate or use table)\n  # Output: t_stat, p_value, significant (p \u003c 0.05)\n}\n\n# Effect size\ncohens_d() {\n  # d = (mean_a - mean_b) / pooled_std\n  # Interpretation: small (0.2), medium (0.5), large (0.8)\n}\n```\n\n### Compare Function\n```bash\ncompare_variants() {\n  local test_dir=$1\n  \n  # Load all trial metrics\n  local metrics_a=$(load_variant_metrics \"$test_dir\" \"a\")\n  local metrics_b=$(load_variant_metrics \"$test_dir\" \"b\")\n  \n  # Run statistical tests for each metric\n  for metric in iterations duration total_tokens overall_score; do\n    local result=$(run_statistical_test \"$metrics_a\" \"$metrics_b\" \"$metric\")\n    # Store in comparison.json\n  done\n}\n```\n\n## Acceptance Criteria\n- Mean and stddev calculated correctly\n- P-values computed for key metrics\n- Effect sizes reported for significant differences\n- Clear winner determination with confidence level","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:21:35.414756-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:21:35.414756-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.6","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:21:35.417224-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.6","depends_on_id":"loop-agents-2mf.4","type":"blocks","created_at":"2026-01-12T03:23:06.279247-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2mf.7","title":"Generate comparison report with visualization","description":"Generate human-readable comparison report from A/B test results.\n\n## Report Format\n\n### JSON Report (comparison.json)\n```json\n{\n  \"test_id\": \"elegance-ab-20250112\",\n  \"config_a\": \"elegance-3consensus.yaml\",\n  \"config_b\": \"elegance-2consensus.yaml\",\n  \"trials_per_variant\": 5,\n  \"summary\": {\n    \"winner\": \"a\",\n    \"confidence\": \"high\",\n    \"key_findings\": [\"Config A completed in 23% fewer iterations\"]\n  },\n  \"metrics\": {\n    \"iterations\": {\n      \"a\": {\"mean\": 4.2, \"stddev\": 0.84, \"values\": [4, 5, 4, 3, 5]},\n      \"b\": {\"mean\": 5.4, \"stddev\": 1.14, \"values\": [5, 6, 4, 7, 5]},\n      \"difference\": -1.2,\n      \"percent_change\": -22.2,\n      \"p_value\": 0.043,\n      \"significant\": true,\n      \"effect_size\": 1.2,\n      \"effect_interpretation\": \"large\"\n    },\n    \"duration_seconds\": { ... },\n    \"overall_quality_score\": { ... }\n  }\n}\n```\n\n### Markdown Report (report.md)\n```markdown\n# A/B Test Report: elegance-ab-20250112\n\n## Summary\n**Winner: Config A** (high confidence)\n\nConfig A (3 consensus) outperformed Config B (2 consensus) with\nstatistically significant improvements in iterations-to-complete.\n\n## Key Findings\n- Config A completed in 23% fewer iterations (p=0.043)\n- Quality scores were comparable (no significant difference)\n- Config B had higher variance in completion times\n\n## Detailed Results\n\n### Iterations to Complete\n| Variant | Mean | Std Dev | Min | Max |\n|---------|------|---------|-----|-----|\n| Config A | 4.2 | 0.84 | 3 | 5 |\n| Config B | 5.4 | 1.14 | 4 | 7 |\n\n**Statistical Analysis:** t(8)=-2.32, p=0.043, d=1.2 (large effect)\n\n### Quality Scores (LLM Evaluation)\n...\n\n## Trial Details\n...\n```\n\n## Implementation\n```bash\ngenerate_report() {\n  local test_dir=$1\n  \n  # Load comparison data\n  local comparison=$(cat \"$test_dir/comparison.json\")\n  \n  # Generate JSON report (already done)\n  \n  # Generate Markdown using template\n  local report=$(apply_template \"ab-report.md.tmpl\" \"$comparison\")\n  echo \"$report\" \u003e \"$test_dir/report.md\"\n  \n  # Print summary to console\n  print_summary \"$comparison\"\n}\n```\n\n## Acceptance Criteria\n- JSON report contains all metrics and statistics\n- Markdown report is human-readable\n- Clear winner declaration with confidence\n- Report printed to console after test completes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:21:50.06704-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:21:50.06704-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.7","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:21:50.071694-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.7","depends_on_id":"loop-agents-2mf.6","type":"blocks","created_at":"2026-01-12T03:23:14.046814-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.7","depends_on_id":"loop-agents-2mf.5","type":"blocks","created_at":"2026-01-12T03:23:14.748691-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.7","depends_on_id":"loop-agents-2mf.8","type":"blocks","created_at":"2026-01-12T03:23:15.383008-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2mf.8","title":"Create ab-report.md.tmpl template file","description":"Create a Markdown template for generating A/B test reports.\n\n## Template Location\nscripts/templates/ab-report.md.tmpl\n\n## Template Variables\n- test_id, config_a, config_b, trials_per_variant\n- summary.winner, summary.confidence, summary.key_findings\n- metrics.{name}.a.mean, metrics.{name}.b.mean\n- metrics.{name}.p_value, metrics.{name}.significant\n\n## Template Content\nStandard Markdown with variable substitution placeholders.\nInclude sections for: Summary, Key Findings, Detailed Results, Trial Details.\n\n## Acceptance Criteria\n- Template renders correctly with sample data\n- All sections populated from comparison.json data\n- Tables formatted properly for iterations, duration, scores","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:22:29.353396-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:22:29.353396-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.8","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:22:29.357695-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2mf.9","title":"Add documentation for A/B testing in CLAUDE.md","description":"Update CLAUDE.md with A/B testing documentation.\n\n## Sections to Add\n\n### Commands Section\nAdd ab-test to the commands table with usage examples.\n\n### New Section: A/B Testing\n```markdown\n## A/B Testing\n\nCompare stage configurations scientifically:\n\n\\`\\`\\`bash\n./scripts/run.sh ab-test \\\\\n  --config-a \"elegance-3consensus.yaml\" \\\\\n  --config-b \"elegance-2consensus.yaml\" \\\\\n  --trials 5 \\\\\n  --session-prefix \"elegance-ab\"\n\\`\\`\\`\n\n### Options\n- --config-a, --config-b: Loop or pipeline configs to compare\n- --trials: Number of trials per variant (default: 5)\n- --session-prefix: Prefix for session names\n- --eval-criteria: Comma-separated LLM evaluation criteria\n\n### Results\nResults stored in \\`.claude/ab-tests/{test-id}/\\`:\n- comparison.json: Statistical comparison data\n- report.md: Human-readable summary\n- trials/: Individual trial data\n\n### Viewing Past Tests\n\\`\\`\\`bash\n./scripts/run.sh ab-test list           # List all tests\n./scripts/run.sh ab-test show \u003ctest-id\u003e # View specific test\n\\`\\`\\`\n```\n\n## Acceptance Criteria\n- Documentation complete and accurate\n- Examples work as documented\n- Integrated with existing sections","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:22:39.342773-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:22:39.342773-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-2mf.9","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:22:39.345901-06:00","created_by":"daemon"},{"issue_id":"loop-agents-2mf.9","depends_on_id":"loop-agents-2mf.7","type":"blocks","created_at":"2026-01-12T03:23:18.208104-06:00","created_by":"daemon"}]}
{"id":"loop-agents-2q1","title":"Modify context.sh to include inherited block in context.json","description":"Extend generate_context() in scripts/lib/context.sh to include inherited context.\n\n**Implementation:**\n- Check for INHERIT_FROM environment variable\n- Call load_inherited_context() if set\n- Add inherited block to context.json output\n- Handle failures gracefully (continue with empty {})\n\n**Acceptance criteria:**\n- [ ] context.json includes 'inherited' block when INHERIT_FROM set\n- [ ] Block contains version, from_session, learnings, patterns, etc.\n- [ ] Graceful fallback to {} on load failure","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:50:28.951455-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:50:28.951455-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-2q1","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T01:54:29.364832-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-354","title":"Rename env vars: CLAUDE_LOOP_* → CLAUDE_PIPELINE_*","description":"Update engine.sh, prompts, CLAUDE.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T03:46:05.243923-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:01:55.035808-06:00","closed_at":"2026-01-12T22:01:55.035808-06:00","close_reason":"Verified complete - rename is done in codebase","labels":["rename"]}
{"id":"loop-agents-35o","title":"Add backward compatibility for sessions without learnings","description":"Ensure sessions created before learnings support still work correctly. When inheriting from an old session, gracefully handle missing learnings[] arrays.\n\n**Acceptance criteria:**\n- [ ] load_inherited_context returns empty arrays when learnings/patterns don't exist\n- [ ] No errors when inheriting from pre-learnings sessions\n- [ ] Progress summary still extracted as fallback","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:47:02.047152-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:47:02.047152-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-35o","depends_on_id":"loop-agents-x64","type":"blocks","created_at":"2026-01-13T01:54:03.720879-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-35o","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T02:01:34.046387-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-386","title":"Bug 15: Pipeline templates use legacy completion keywords","description":"Templates use completion: instead of termination:. Fix: Update to v3 schema.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:46:50.278612-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:53:18.731245-06:00","closed_at":"2026-01-12T22:53:18.731245-06:00","close_reason":"Fixed as part of template update to v3 patterns","labels":["bugs/engine-stability"]}
{"id":"loop-agents-3fj","title":"Create security.md review prompt","description":"Security Sentinel prompt:\n- OWASP Top 10 checks\n- Injection flaws (SQL, XSS, command)\n- Auth/authz issues, secrets exposure\n- Output format with FINDINGS_COUNT and CRITICAL_COUNT","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:52:13.481861-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:40.057058-06:00","closed_at":"2026-01-09T14:13:40.057058-06:00","close_reason":"Completed via loop-engine refactor","labels":["loop/review"],"dependencies":[{"issue_id":"loop-agents-3fj","depends_on_id":"loop-agents-f1v","type":"blocks","created_at":"2026-01-09T13:52:32.338303-06:00","created_by":"daemon"}]}
{"id":"loop-agents-3nm","title":"Bug 16: Pipeline templates use legacy status format","description":"Templates reference PLATEAU: instead of decision:. Fix: Update to v3 format.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:46:55.457622-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:53:18.733729-06:00","closed_at":"2026-01-12T22:53:18.733729-06:00","close_reason":"Fixed as part of template update to v3 patterns","labels":["bugs/engine-stability"]}
{"id":"loop-agents-3os","title":"Enrich stage data with loop.yaml metadata","description":"For each stage, read the corresponding loop.yaml from scripts/loops/{loop}/ to extract: termination type (queue/judgment/fixed), min_iterations, consensus count, delay, and description. Merge this with stage data from pipeline YAML.\n\nThis provides the full picture needed for visualization: stage name + iteration config + termination strategy.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:13.85278-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.800815-06:00","closed_at":"2026-01-12T03:41:03.800815-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-3os","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:16.63737-06:00","created_by":"daemon"},{"issue_id":"loop-agents-3os","depends_on_id":"loop-agents-egi","type":"blocks","created_at":"2026-01-12T03:21:33.563379-06:00","created_by":"daemon"}]}
{"id":"loop-agents-3yj","title":"Bug 21: tdd-create-beads hardcodes project content","description":"Steps 4-6 hardcoded to parallel-providers project. Fix: Make template generic.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:47:22.534562-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:25:40.589566-06:00","closed_at":"2026-01-12T23:25:40.589566-06:00","close_reason":"Fixed in bug fixing session","labels":["bugs/engine-stability"]}
{"id":"loop-agents-464","title":"TDD: Phase 6 - Tracks (Independent Loops) Execution","description":"Complete TDD cycle for tracks execution - independent iteration loops per provider.\n\n## Step 1: Write Failing Tests\nFile: scripts/tests/integration/test_tracks.sh (NEW FILE)\n\n### Create Test Infrastructure First\n- Create scripts/tests/fixtures/integration/tracks-dual/ fixture directory\n- Add pipeline.yaml with tracks: [claude loop, codex loop]\n- Add per-provider mock responses that plateau at different iterations\n\n### Unit Tests to Write\n\n6.1 Tracks Execution:\n- test_tracks_spawns_independent_loops\n  Config: tracks with claude and codex\n  Expected: Two independent iteration loops started\n\n- test_tracks_each_has_own_termination\n  Config: claude max 3, codex max 5\n  Expected: Claude stops at 3, codex continues to 5\n\n- test_tracks_stage_completes_when_all_done\n  Expected: Stage status = complete only after both tracks finish\n\n- test_tracks_collects_final_outputs\n  Expected: outputs.json with paths to each track's final output\n\n6.2 Track Failure Handling:\n- test_tracks_fails_if_any_track_fails\n  Configure one track to fail (exit code 1 in mock)\n  Expected: Overall stage fails with exit code != 0\n\n- test_tracks_waits_for_all_on_failure\n  Configure track-1 to fail at iteration 2, track-2 continues to iteration 4\n  Expected: Engine waits for track-2 to complete before reporting failure\n\n- test_tracks_reports_which_tracks_failed\n  Configure two tracks, one fails, one succeeds\n  Expected: Error message includes 'Track claude failed'\n\n6.3 outputs.json Tests:\n- test_tracks_outputs_json_format\n  Expected: outputs.json exists with output, status, iterations_completed, termination_reason\n\n- test_tracks_outputs_json_termination_reasons\n  Configure: claude plateaus at 3, codex hits max at 5\n  Expected: claude.termination_reason = 'plateau'\n  Expected: codex.termination_reason = 'max_iterations'\n\n- test_tracks_outputs_json_used_by_next_stage\n  Pipeline with tracks stage followed by single stage\n  Expected: Next stage context.json has inputs.tracks populated\n\n6.4 Edge Cases:\n- test_tracks_independent_iteration_counts\n  Track claude runs 3 iterations (plateau), track codex runs 5 iterations\n  Expected: outputs.json shows different iteration counts\n\n## Step 2: Verify Tests Fail\nRun: ./scripts/tests/integration/test_tracks.sh\nAll tests MUST fail initially.\n\n## Step 3: Implement Feature\nFile: scripts/engine.sh\n\n- Add run_tracks() function\n- Spawn background process per track\n- Each track runs its own iteration loop (run_iteration_loop)\n- Wait for ALL tracks to complete\n- Collect final outputs to outputs.json\n- Handle track failures (wait for all, then report)\n\n## Step 4: Verify Tests Pass\nRun: ./scripts/tests/run_tests.sh\n\n## Step 5: Commit\ngit commit -m 'feat: tracks execution mode\n\n- Add run_tracks() in engine.sh\n- Each track runs independent iteration loop\n- Wait for all tracks to complete\n- Collect final outputs to outputs.json\n- Handle track failures gracefully'\n\n## Acceptance Criteria\n- [ ] New test file: integration/test_tracks.sh created\n- [ ] New fixtures: tracks-dual/ with per-provider responses\n- [ ] 11 integration tests written\n- [ ] Tests fail initially\n- [ ] run_tracks() implemented\n- [ ] outputs.json collection implemented\n- [ ] All existing tests still pass\n- [ ] Changes committed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T21:29:46.771486-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.650893667+01:00","closed_at":"2026-01-14T17:06:31.912936-06:00","labels":["pipeline/parallel-providers"],"dependencies":[{"issue_id":"loop-agents-464","depends_on_id":"loop-agents-ky3","type":"blocks","created_at":"2026-01-12T21:31:15.264828-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-4aa","title":"Add token estimation from historical pipeline runs","description":"Scan .claude/pipeline-runs/ for completed runs of each loop type. Parse state.json history to extract iteration data. Calculate average tokens per iteration (if available) or use heuristics based on prompt size.\n\nDisplay format: ~50k tokens (range: 30k-80k) when historical data exists, or 'no history' when not.\n\nNote: Token data may not be directly in state.json - may need to add it or estimate from output.md file sizes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:35.501715-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:24:26.111093-06:00","closed_at":"2026-01-12T03:24:26.111093-06:00","close_reason":"Replaced with human-focused info - tokens are noise for humans","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-4aa","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:18.671858-06:00","created_by":"daemon"},{"issue_id":"loop-agents-4aa","depends_on_id":"loop-agents-fvk","type":"blocks","created_at":"2026-01-12T03:21:35.650738-06:00","created_by":"daemon"}]}
{"id":"loop-agents-4ie","title":"Create remaining review prompts (quality, concurrency, api)","description":"Create additional reviewer prompts:\n1. quality.md - Code Quality Reviewer\n2. concurrency.md - Concurrency Auditor\n3. api.md - API Contract Reviewer","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T13:52:24.801084-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T13:52:24.801084-06:00","labels":["loop/review"]}
{"id":"loop-agents-4kk","title":"Store A/B test results for historical reference","description":"Persist A/B test results for future reference and trend analysis.\n\n## Storage Structure\n```\n.claude/ab-tests/\n  index.json                    # List of all tests with summary\n  elegance-ab-20250112/\n    config.json                 # Test configuration\n    trials/\n      a-1/                      # Trial directories (same as pipeline-runs)\n      a-2/\n      ...\n      b-1/\n      b-2/\n    metrics.json                # Aggregated metrics per variant\n    comparison.json             # Statistical comparison\n    report.md                   # Human-readable report\n```\n\n## Index File Format\n```json\n{\n  \"tests\": [\n    {\n      \"test_id\": \"elegance-ab-20250112\",\n      \"config_a\": \"elegance-3consensus.yaml\",\n      \"config_b\": \"elegance-2consensus.yaml\",\n      \"trials\": 5,\n      \"completed_at\": \"2025-01-12T14:30:00Z\",\n      \"winner\": \"a\",\n      \"confidence\": \"high\",\n      \"path\": \".claude/ab-tests/elegance-ab-20250112/\"\n    }\n  ]\n}\n```\n\n## List Command\n```bash\n./scripts/run.sh ab-test list\n# Output:\n# ID                     | Winner | Confidence | Date\n# elegance-ab-20250112   | A      | high       | 2025-01-12\n# refine-ab-20250111     | B      | medium     | 2025-01-11\n```\n\n## Implementation\n```bash\nregister_ab_test() {\n  local test_id=$1\n  local test_dir=$2\n  local index_file=\".claude/ab-tests/index.json\"\n  \n  # Extract summary from comparison.json\n  local summary=$(jq -c {","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:22:07.308372-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:22:07.308372-06:00","labels":["loop/ab-testing"],"dependencies":[{"issue_id":"loop-agents-4kk","depends_on_id":"loop-agents-2mf","type":"parent-child","created_at":"2026-01-12T03:22:17.452754-06:00","created_by":"daemon"},{"issue_id":"loop-agents-4kk","depends_on_id":"loop-agents-2mf.7","type":"blocks","created_at":"2026-01-12T03:23:16.343603-06:00","created_by":"daemon"}]}
{"id":"loop-agents-4vx","title":"Create bead-refiner prompt file","description":"Create scripts/refine/prompts/bead-refiner.md with:\n1. Full bead-refiner prompt (iterative bead improvement)\n2. Session variable substitution\n3. Required output format: CHANGES: N and SUMMARY: line\nMust be parseable by loop script for plateau detection.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:51:50.83758-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:40.053907-06:00","closed_at":"2026-01-09T14:13:40.053907-06:00","close_reason":"Completed via loop-engine refactor","labels":["loop/refine"],"dependencies":[{"issue_id":"loop-agents-4vx","depends_on_id":"loop-agents-od6","type":"blocks","created_at":"2026-01-09T13:52:32.15958-06:00","created_by":"daemon"}]}
{"id":"loop-agents-4yy","title":"Update ralph and improve-plan stage prompts to write learnings","description":"Modify existing stage prompts to include learnings[] in their status.json output. Start with the most commonly used stages: ralph (work) and improve-plan (refinement).\n\n**Acceptance criteria:**\n- [ ] scripts/stages/ralph/prompt.md instructs agents to capture learnings\n- [ ] scripts/stages/improve-plan/prompt.md instructs agents to capture learnings\n- [ ] Learnings are specific, actionable insights (not generic summaries)\n- [ ] Example: 'JWT refresh tokens need atomic rotation' not 'worked on auth'","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:46:51.072142-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:46:51.072142-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-4yy","depends_on_id":"loop-agents-x64","type":"blocks","created_at":"2026-01-13T01:53:53.005804-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-5mi","title":"TDD: Phase 2 - Provider List Parsing","description":"Complete TDD cycle for provider list parsing and abstraction.\n\n## Step 1: Write Failing Tests\nFile: scripts/tests/test_providers.sh (add to existing file)\n\n### Unit Tests to Write\n\n2.1 Provider List Parsing:\n- test_get_providers_list_single: Input {provider: claude} -\u003e [claude]\n- test_get_providers_list_array: Input {providers: [claude, codex]} -\u003e [claude, codex]\n- test_get_providers_list_empty: Input {} -\u003e [claude] (default)\n- test_get_providers_list_normalizes_aliases: [anthropic, openai] -\u003e [claude, codex]\n- test_get_providers_list_deduplicates: [claude, anthropic, claude-code] -\u003e [claude]\n- test_get_providers_list_preserves_order: [codex, claude] -\u003e [codex, claude]\n\n2.2 Validate All Providers:\n- test_validate_providers_all_installed: Mock both available -\u003e Success\n- test_validate_providers_missing_one: Mock one missing -\u003e Error\n- test_validate_providers_empty_list: [] -\u003e Error\n\n## Step 2: Verify Tests Fail\nRun: ./scripts/tests/test_providers.sh\nAll new tests MUST fail initially.\n\n## Step 3: Implement Feature\nFile: scripts/lib/provider.sh\n\n- Add get_providers_list() function to parse providers from config\n- Handle single provider vs providers array\n- Normalize aliases and deduplicate\n- Add validate_providers() function to preflight check all CLIs\n\n## Step 4: Verify Tests Pass\nRun: ./scripts/tests/run_tests.sh\n\n## Step 5: Commit\ngit commit -m 'feat: add provider list parsing\n\n- Add get_providers_list() for parsing provider config\n- Handle aliases and deduplication\n- Add validate_providers() for preflight checks'\n\n## Acceptance Criteria\n- [ ] 9 new unit tests in test_providers.sh\n- [ ] Tests fail initially\n- [ ] get_providers_list() implemented\n- [ ] validate_providers() implemented\n- [ ] All existing tests still pass\n- [ ] Changes committed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T21:27:16.983483-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.663817127+01:00","closed_at":"2026-01-14T17:06:31.888464-06:00","labels":["pipeline/parallel-providers"],"dependencies":[{"issue_id":"loop-agents-5mi","depends_on_id":"loop-agents-ugc","type":"blocks","created_at":"2026-01-12T21:30:44.289742-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-60z","title":"Add crash recovery with auto-resume for failed sessions","description":"## Problem\nIf Claude crashes mid-iteration (API timeout, network blip, SIGKILL), the session is left in a broken state. The user has to manually figure out where it stopped and restart.\n\n## Solution\nAdd crash recovery to engine.sh with deterministic failure detection:\n\n### State Tracking\n- Store `iteration_started` timestamp in state before each iteration\n- Store `iteration_completed` timestamp after successful iteration\n- Add `status` field: \"running\", \"completed\", \"failed\"\n\n### Failure Detection (CRITICAL)\nMust distinguish between:\n1. **Active session** - Currently running (PID alive, recent heartbeat)\n2. **Failed session** - Started but not completed, PID dead\n3. **Completed session** - Finished successfully\n\nUse lockfiles (from session lockfiles task) + heartbeat:\n- Update heartbeat timestamp every 30s during iteration\n- If lock exists but PID dead AND no recent heartbeat → failed\n- If lock exists and PID alive → active (don't resume!)\n\n### Resume Flow\n- `--resume` flag to explicitly continue a previous session\n- On startup, check for incomplete iterations\n- Show user what state the session was in\n- Offer to resume from last successful iteration\n- Return clear error message explaining what happened\n\n### User Experience\nWhen a session fails, user should see:\n```\nSession 'auth' failed at iteration 5/25\nLast successful iteration: 4\nError: Claude process terminated unexpectedly (exit code 137)\nRun with --resume to continue from iteration 5\n```\n\n## Dependencies\n- Requires session lockfiles to be implemented first","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-10T18:22:51.858726-06:00","created_by":"harrisonwells","updated_at":"2026-01-10T18:46:31.194542-06:00","closed_at":"2026-01-10T18:46:31.194542-06:00","close_reason":"Closed","dependencies":[{"issue_id":"loop-agents-60z","depends_on_id":"loop-agents-k93","type":"blocks","created_at":"2026-01-10T18:23:33.543567-06:00","created_by":"daemon"}]}
{"id":"loop-agents-630","title":"Create scripts/lib/library.sh for template library","description":"Create the template library module (marketplace deferred):\n\nDirectory layout:\nscripts/\n├── stages/                 # built-in\n├── pipelines/              # built-in\n└── library/                # shipped templates (community pack)\n    ├── stages/\n    └── pipelines/\n\n~/.config/agent-pipelines/\n├── stages/                 # user overrides\n└── pipelines/\n\nResolution order: user \u003e library \u003e built-in\n\nFunctions:\n- list_templates() - list all available templates\n- get_template_info(name) - get template metadata\n- fork_template(source, target) - copy to user config","acceptance_criteria":"- [ ] library.sh created\n- [ ] list_templates() returns all sources\n- [ ] Resolution order correct (user \u003e library \u003e built-in)\n- [ ] get_template_info() returns metadata\n- [ ] fork_template() copies correctly\n- [ ] test_library.sh passes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-14T02:47:27.555599-06:00","created_by":"harrisonwells","updated_at":"2026-01-14T02:47:27.555599-06:00","labels":["phase/5-library","phase/8-library","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-630","depends_on_id":"loop-agents-cim","type":"blocks","created_at":"2026-01-14T02:51:38.7764-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-6c6","title":"Implement review-once.sh single reviewer runner","description":"Create review-once.sh:\n1. Takes REVIEWER and SCOPE args\n2. Selects appropriate prompt file\n3. Substitutes ${SCOPE} variable\n4. Pipes to claude --model opus\n5. Outputs to stdout for parsing","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:52:24.633393-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:45.487484-06:00","closed_at":"2026-01-09T14:13:45.487484-06:00","close_reason":"Not needed - loop-engine handles iteration","labels":["loop/review"],"dependencies":[{"issue_id":"loop-agents-6c6","depends_on_id":"loop-agents-f1v","type":"blocks","created_at":"2026-01-09T13:52:32.407376-06:00","created_by":"daemon"}]}
{"id":"loop-agents-6dy","title":"Display termination strategy and stage purpose in viz boxes","description":"Instead of token counts, show humans what they care about:\n- Termination type badge: [judgment], [queue], [fixed]\n- One-line stage description from loop.yaml\n- Checkpoint indicator (🔍) if human review required\n- Consensus requirement for judgment stages (e.g., '2-agree')\n\nExample box:\n┌─────────────────────┐\n│   improve-plan      │\n│ [judgment] 2-agree  │\n│ Refine plan quality │\n│ 5 iters max         │\n└─────────────────────┘","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:24:27.435839-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.777833-06:00","closed_at":"2026-01-12T03:41:03.777833-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-6dy","depends_on_id":"loop-agents-lum","type":"blocks","created_at":"2026-01-12T03:24:33.921527-06:00","created_by":"daemon"}]}
{"id":"loop-agents-6i5","title":"Bug 14: Pipeline templates use unimplemented parallel: true","description":"Field exists in templates but not implemented. Fix: Remove or implement.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-12T22:48:35.105331-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:29:07.417588-06:00","closed_at":"2026-01-12T23:29:07.417588-06:00","close_reason":"By design - SCHEMA.md documents parallel: true as a hint for future parallel execution","labels":["bugs/engine-stability"]}
{"id":"loop-agents-6ie","title":"Create remaining refine prompt files","description":"Create prompt files for:\n1. context-loader.md - Fresh session context loading\n2. post-context.md - Review after context load\n3. synthesizer.md - Merge competing LLM plans\n4. robot-mode.md - Agent-optimized CLI design","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T13:52:02.676945-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T13:52:02.676945-06:00","labels":["loop/refine"]}
{"id":"loop-agents-6q3","title":"Phase 5: Parallel block resume and integration","description":"Implement crash recovery for parallel blocks per plans/parallel-blocks-implementation.md Section 4.1 resume logic. Skip completed providers on resume, restart others at recorded stage/iteration. Write Phase 5 tests first (TDD). Update CLAUDE.md with parallel block docs when complete.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T14:39:03.990635-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T15:32:34.905258-06:00","closed_at":"2026-01-13T15:32:34.905258-06:00","close_reason":"Closed","labels":["pipeline/parallel-blocks"],"dependencies":[{"issue_id":"loop-agents-6q3","depends_on_id":"loop-agents-0g5","type":"blocks","created_at":"2026-01-13T14:39:26.564149-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-6sw","title":"Create integration tests for session inheritance","description":"Integration tests that exercise the full inheritance flow.\n\n**Tests:**\n1. Start session with --inherit, verify context.json has inherited block\n2. Run 2-iteration pipeline, verify learnings written to status.json\n3. Chain A→B inheritance, verify B has A's learnings\n4. Chain A→B→C (3 levels), verify merged learnings\n5. Comprehension validation - validation.json created when missing\n6. Discovery command - sessions list --completed shows learnings count\n7. Concurrent access - two sessions inherit from same source safely\n\n**Acceptance criteria:**\n- [ ] All 7 integration tests implemented\n- [ ] Tests use real engine (not mocked)\n- [ ] Clean up test sessions after each test","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:53:24.317314-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:53:24.317314-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-6sw","depends_on_id":"loop-agents-2q1","type":"blocks","created_at":"2026-01-13T01:56:00.839737-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-6sw","depends_on_id":"loop-agents-wbm","type":"blocks","created_at":"2026-01-13T01:56:05.973851-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-6vi","title":"Bug 13: research-plan stage hardcodes plan file path","description":"Prompt references docs/plans/plan.md. Fix: Use context.json paths.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:46:45.124119-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:25:40.58499-06:00","closed_at":"2026-01-12T23:25:40.58499-06:00","close_reason":"Fixed in bug fixing session","labels":["bugs/engine-stability"]}
{"id":"loop-agents-6w0","title":"Bug 23: Multiple prompts use invalid --add-label flag","description":"bd CLI doesn't have --add-label. Fix: Use correct bd syntax.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:47:32.863565-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:25:40.591995-06:00","closed_at":"2026-01-12T23:25:40.591995-06:00","close_reason":"Fixed in bug fixing session","labels":["bugs/engine-stability"]}
{"id":"loop-agents-7iv","title":"Bug 17: ${INPUTS.stage-name} variable not implemented","description":"resolve.sh doesn't implement this variable but templates use it. Templates are broken.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-12T22:46:01.663196-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:53:07.983741-06:00","closed_at":"2026-01-12T22:53:07.983741-06:00","close_reason":"Templates updated to v3 pattern. The feature works via context.json, templates were just using outdated syntax.","labels":["bugs/engine-stability"]}
{"id":"loop-agents-7jw","title":"Fix deployment blockers for loop-agents","description":"Make the system installable on a fresh machine","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-12T03:43:26.758531-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:43:26.758531-06:00","labels":["loop/deploy"]}
{"id":"loop-agents-7ww","title":"Implement review-loop.sh multi-reviewer runner","description":"Create review-loop.sh:\n1. Takes MODE (full/quick/single) and SCOPE args\n2. Loops through selected reviewers\n3. Saves each output to findings/{session}/\n4. Parses FINDINGS_COUNT from output\n5. Calls aggregate-findings.sh at end","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:52:24.663571-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:45.492181-06:00","closed_at":"2026-01-09T14:13:45.492181-06:00","close_reason":"Not needed - loop-engine handles iteration","labels":["loop/review"],"dependencies":[{"issue_id":"loop-agents-7ww","depends_on_id":"loop-agents-6c6","type":"blocks","created_at":"2026-01-09T13:52:32.429893-06:00","created_by":"daemon"},{"issue_id":"loop-agents-7ww","depends_on_id":"loop-agents-3fj","type":"blocks","created_at":"2026-01-09T13:52:32.449509-06:00","created_by":"daemon"},{"issue_id":"loop-agents-7ww","depends_on_id":"loop-agents-137","type":"blocks","created_at":"2026-01-09T13:52:32.469579-06:00","created_by":"daemon"},{"issue_id":"loop-agents-7ww","depends_on_id":"loop-agents-t4y","type":"blocks","created_at":"2026-01-09T13:52:32.489212-06:00","created_by":"daemon"}]}
{"id":"loop-agents-82a","title":"Update scripts/lib/state.sh for event-derived snapshots","description":"Modify state.sh to treat state.json as a cache derived from events.jsonl:\n\nNew functions:\n- write_snapshot() - write state.json cache from events\n- load_snapshot() - load cached state\n- reconcile_with_events() - rebuild state from events if stale\n\nState.json becomes a cache containing:\n- last cursor\n- last plan sha\n- last processed event offset\n- last error pointer\n\nResume algorithm:\n1. Acquire flock\n2. Read plan.json\n3. Read state.json if present\n4. If state.json.event_offset \u003c events.jsonl length, reconcile\n5. Find resume point from last iteration_complete/node_complete\n6. Check hook idempotency via events","acceptance_criteria":"- [ ] state.sh updated with snapshot functions\n- [ ] State derived from events, not authoritative\n- [ ] Reconciliation works when state.json is stale\n- [ ] Resume algorithm implemented correctly\n- [ ] State can be rebuilt from events alone\n- [ ] test_state.sh passes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:43:48.849243-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.679384732+01:00","closed_at":"2026-01-14T17:06:55.473199-06:00","labels":["phase/1-event-spine","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-82a","depends_on_id":"loop-agents-z17","type":"blocks","created_at":"2026-01-14T02:49:49.737507-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-82i","title":"Add first-run directory bootstrap","description":"Create .claude/pipeline-runs/, .claude/locks/ on first run if missing","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:44:30.826608-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:44:30.826608-06:00","labels":["loop/deploy"]}
{"id":"loop-agents-875","title":"Update plugin.json and marketplace.json with new name","description":"Change package name from loop-agents to agent-pipelines","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T03:46:05.183146-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:02:06.193551-06:00","closed_at":"2026-01-12T22:02:06.193551-06:00","close_reason":"N/A - plugin.json and marketplace.json do not exist in this project","labels":["rename"]}
{"id":"loop-agents-88s","title":"Add resolve_initial_inputs() function to engine.sh","description":"Add function to resolve file paths, globs, and directories to absolute paths. Store result in run_dir/initial-inputs.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T01:30:59.730554-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:32:46.51405-06:00","closed_at":"2026-01-13T01:32:46.51405-06:00","close_reason":"Added resolve_initial_inputs() function to engine.sh","labels":["feature/initial-inputs"]}
{"id":"loop-agents-8cv","title":"Investigate loop/ folder origin - bad test path handling","description":"A loop/ folder was created with a test state file written to wrong location. Folder was deleted before investigation. Need to: check git log for creation, search tests for hardcoded 'loop/' paths, check recent test runs.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:08:56.569425-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:08:56.569425-06:00","labels":["bugs/engine"]}
{"id":"loop-agents-8eg","title":"Add tests for viz command","description":"Create scripts/tests/test_viz.sh with tests:\n1. viz full-refine produces correct stage count\n2. viz work shows single-stage output\n3. viz nonexistent produces error\n4. viz --json produces valid JSON\n5. Verify dependency arrows match inputs.from config\n\nUse existing test.sh library patterns.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:59.397813-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.783921-06:00","closed_at":"2026-01-12T03:41:03.783921-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-8eg","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:22.260178-06:00","created_by":"daemon"},{"issue_id":"loop-agents-8eg","depends_on_id":"loop-agents-fvk","type":"blocks","created_at":"2026-01-12T03:21:38.271425-06:00","created_by":"daemon"}]}
{"id":"loop-agents-8f9","title":"Bug 25: refine-beads uses legacy loop/ label prefix","description":"Should use pipeline/ prefix. Fix: Update label.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:47:43.177983-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:25:40.596369-06:00","closed_at":"2026-01-12T23:25:40.596369-06:00","close_reason":"Fixed in bug fixing session","labels":["bugs/engine-stability"]}
{"id":"loop-agents-8gw","title":"Create comprehensive test suite for event-sourced engine","description":"Create the core test infrastructure for the event-sourced engine:\n\n**Phase 1 - Core test infrastructure (this bead):**\n1. Mock provider that returns immediately with configurable exit codes\n2. Test fixtures for stages and pipelines\n3. events_test.sh - Event emit/replay (critical path)\n4. state_test.sh - State derivation from events\n5. compile_test.sh - Plan compilation\n\nThe secondary tests (deciders_test.sh, hooks_test.sh, integration tests) are covered by their respective implementation beads.\n\nTest fixtures:\nscripts/tests/fixtures/\n├── stages/test-stage/\n├── pipelines/test-pipeline.yaml\n└── expected/\n\nMock provider should be usable by all subsequent tests.","acceptance_criteria":"- [ ] Mock provider created (configurable exit codes, fast execution)\n- [ ] events_test.sh tests emit/replay cycle\n- [ ] state_test.sh tests state derivation\n- [ ] compile_test.sh tests plan compilation\n- [ ] Test fixtures created for stages and pipelines\n- [ ] Mock provider documented for reuse\n- [ ] ./scripts/run.sh test passes","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-14T02:48:44.634008-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.694184949+01:00","labels":["phase/6-testing","phase/8-testing","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-8gw","depends_on_id":"loop-agents-cim","type":"blocks","created_at":"2026-01-14T02:52:09.799701-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-8od","title":"Create scripts/lib/util.sh with common helpers","description":"Extract duplicated utility functions into a shared util.sh file:\n- now_iso8601() - timestamp helper (currently duplicated in state.sh, status.sh, lock.sh, notify.sh)\n- read_json_field() - generic JSON field reader (replaces 6 get_status_* functions)\n- update_json() - atomic JSON update helper (replaces 25+ patterns)\n\nThis is the foundation cleanup before the event-sourced architecture.","acceptance_criteria":"- [ ] util.sh created with now_iso8601(), read_json_field(), update_json()\n- [ ] state.sh updated to use util.sh\n- [ ] status.sh updated to use util.sh\n- [ ] lock.sh updated to use util.sh\n- [ ] notify.sh updated to use util.sh\n- [ ] All existing tests pass","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-14T02:42:35.361288-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.710527869+01:00","labels":["phase/0-foundation","phase/1-foundation","pipeline/v3","pipeline/v3-event-spine"]}
{"id":"loop-agents-8y4","title":"Bug 8: dry_run_loop() outputs wrong file paths","description":"Dry-run shows incorrect paths. Fix: Match actual engine paths.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:46:39.963419-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:25:40.582545-06:00","closed_at":"2026-01-12T23:25:40.582545-06:00","close_reason":"Fixed in bug fixing session","labels":["bugs/engine-stability"]}
{"id":"loop-agents-8z7","title":"Update resolve.sh to include library root","description":"Update resolve.sh to search the template library:\n\nStage resolution precedence:\n1. User: ~/.config/agent-pipelines/stages/{name}/\n2. Library: scripts/library/stages/{name}/\n3. Built-in: scripts/stages/{name}/\n\nPipeline resolution uses same precedence.\n\nThis enables the 'library' feature while maintaining backward compatibility.","acceptance_criteria":"- [ ] resolve.sh searches user directory first\n- [ ] resolve.sh searches library directory second\n- [ ] resolve.sh searches built-in last\n- [ ] Same precedence for pipelines\n- [ ] Existing resolutions not broken","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-14T02:47:54.81467-06:00","created_by":"harrisonwells","updated_at":"2026-01-14T02:47:54.81467-06:00","labels":["phase/5-library","phase/8-library","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-8z7","depends_on_id":"loop-agents-630","type":"blocks","created_at":"2026-01-14T02:51:49.125393-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-969","title":"Create scripts/lib/locks.sh for flock-based session locking","description":"Create a cross-platform locking module using flock:\n\nFeatures:\n- Session lock acquisition\n- Stale lock detection via PID check\n- Cross-platform support (Linux flock, macOS Homebrew flock or shlock)\n- --no-lock flag for CI/CD\n\nLock file location: .claude/pipeline-runs/{session}/locks/session.lock\n\nLocking in parallel blocks:\n- Main session holds master lock\n- Child processes do NOT acquire separate locks\n- Event appends use atomic write, no locking needed","acceptance_criteria":"- [ ] locks.sh created with acquire_lock(), release_lock()\n- [ ] Session lock works on Linux\n- [ ] Session lock works on macOS\n- [ ] Stale lock detection via PID check\n- [ ] --no-lock flag supported\n- [ ] Parallel blocks handled correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:44:02.866152-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.728205856+01:00","closed_at":"2026-01-14T16:18:58.477779-06:00","labels":["phase/1-event-spine","pipeline/v3-event-spine"]}
{"id":"loop-agents-99n","title":"TDD: Phase 7 - End-to-End Integration Tests","description":"Complete TDD cycle for end-to-end integration and regression tests.\n\n## Step 1: Write Failing Tests\nFiles: Add to integration test files\n\n### Integration Tests to Write\n\n7.1 Pipeline With Parallel Stage:\n- test_pipeline_parallel_to_single\n  pipeline.yaml:\n    - name: brainstorm\n      providers: [claude, codex]\n      termination: {type: fixed, iterations: 1}\n    - name: synthesize\n      provider: claude\n      inputs: {from: brainstorm}\n  Expected: synthesize stage sees both provider outputs in inputs\n\n7.2 Pipeline With Tracks:\n- test_pipeline_tracks_to_single\n  pipeline.yaml:\n    - name: planning\n      tracks: [...]\n    - name: synthesize\n      provider: claude\n      inputs: {from: planning}\n  Expected: synthesize stage sees both track final outputs\n\n7.3 End-to-End Synthesize Test:\n- test_pipeline_tracks_synthesize_uses_all_outputs\n  Full pipeline: tracks stage -\u003e synthesize stage\n  Expected: synth context.json has inputs.tracks with both providers\n  Expected: Both output files exist and are readable\n  Expected: Iteration counts are passed through\n\n### Regression Tests (should already pass):\n\n7.4 Single Provider Unchanged:\n- test_single_provider_unchanged_directory_structure\n  Config: provider: 'claude' (not providers array)\n  Expected: iterations/001/output.md (NOT iterations/001/claude/output.md)\n\n- test_single_provider_context_unchanged\n  Config: provider: 'claude'\n  Expected: context.json has NO inputs.providers field\n  Expected: context.json structure matches pre-parallel format\n\n- test_all_existing_tests_still_pass\n  Meta-test: run full existing test suite\n  Expected: 0 failures - confirms no regressions\n\n## Step 2: Verify Tests Fail\nNew integration tests MUST fail initially.\nRegression tests should pass (they test existing behavior).\n\n## Step 3: Implement Feature\nFix any integration issues found during testing.\nNo major new implementation expected - this phase validates everything works together.\n\n## Step 4: Verify Tests Pass\nRun: ./scripts/tests/run_tests.sh\nFULL test suite must pass - all 6 prior phases plus integration.\n\n## Step 5: Commit\ngit commit -m 'feat: parallel provider integration tests\n\n- Add pipeline parallel-\u003esingle integration test\n- Add pipeline tracks-\u003esingle integration test\n- Add regression tests for single-provider unchanged behavior\n- All existing tests pass (no regressions)'\n\n## Acceptance Criteria\n- [ ] 6 new integration tests written\n- [ ] New tests fail initially (except regression tests)\n- [ ] Any integration fixes implemented\n- [ ] FULL test suite passes: ./scripts/tests/run_tests.sh\n- [ ] Single provider behavior unchanged (regression tests)\n- [ ] Changes committed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T21:30:14.452615-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.75033906+01:00","closed_at":"2026-01-14T17:06:31.91825-06:00","labels":["pipeline/parallel-providers"],"dependencies":[{"issue_id":"loop-agents-99n","depends_on_id":"loop-agents-464","type":"blocks","created_at":"2026-01-12T21:31:20.426109-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-9cg","title":"Prompt Composability via Template Includes","description":"Add template includes for common patterns in stage prompts. Enable ${include:path} syntax that gets resolved during prompt resolution. This allows consistent boilerplate across stages without requiring memorization.\n\n## Motivation\nThe Stage Creator Agent generates many prompts. Includes ensure consistency without requiring the agent to memorize boilerplate. Humans benefit equally when hand-crafting stages.\n\n## Syntax\n```markdown\n# My Custom Stage\n\n${include:preamble/autonomy-grant.md}\n\n## Your Mission\n[Custom content here]\n\n${include:patterns/read-context.md}\n${include:patterns/write-status.md}\n```\n\n## Deliverables\n- Include library at scripts/lib/templates/\n- Resolution in scripts/lib/resolve.sh\n- Template files for common patterns\n- Updated documentation","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-12T03:19:45.998317-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:19:45.998317-06:00","labels":["loop/template-includes"]}
{"id":"loop-agents-9cg.1","title":"Create templates directory structure","description":"Create the include library directory structure at scripts/lib/templates/.\n\n## Structure\n```\nscripts/lib/templates/\n├── preamble/           # Opening context-setting paragraphs\n├── patterns/           # Reusable workflow patterns (read, write, etc.)\n└── fragments/          # Small reusable snippets\n```\n\n## Acceptance Criteria\n- [ ] Directory structure exists\n- [ ] README.md explaining the template system\n- [ ] Example template in each category","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:19:53.291886-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:19:53.291886-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.1","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:19:53.29409-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.10","title":"Update CLAUDE.md with include documentation","description":"Add documentation for the template include system to CLAUDE.md.\n\n## Sections to Add/Update\n\n### Template Variables Section\nAdd new ${include:...} syntax to the existing variables documentation.\n\n### Creating a New Stage Section\nUpdate to mention include availability and recommend using them for standard patterns.\n\n### New Section: Template Library\nDocument available templates:\n- preamble/autonomy-grant.md\n- patterns/read-context.md\n- patterns/write-status.md\n- patterns/subagent-guidance.md\n- fragments/context-header.md\n\n## Acceptance Criteria\n- [ ] CLAUDE.md updated with include syntax\n- [ ] Template library documented\n- [ ] Stage creation guidance updated","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:57.905167-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:57.905167-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.10","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:20:57.90584-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.10","depends_on_id":"loop-agents-9cg.7","type":"blocks","created_at":"2026-01-12T03:21:28.205775-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.10","depends_on_id":"loop-agents-9cg.9","type":"blocks","created_at":"2026-01-12T03:21:28.228445-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.11","title":"Migrate remaining prompts to use includes","description":"Migrate all remaining stage prompts to use the include system where beneficial.\n\n## Prompts to Migrate\n1. scripts/loops/work/prompt.md\n2. scripts/loops/improve-plan/prompt.md\n3. scripts/loops/idea-wizard/prompt.md\n4. scripts/loops/research-plan/prompt.md\n\n## Guidelines\n- Only use includes where they add value (don't force it)\n- Keep stage-specific content inline\n- Context header and write-status are most common candidates\n- Autonomy grant may not fit all stages\n\n## Acceptance Criteria\n- [ ] All prompts reviewed for include opportunities\n- [ ] Appropriate includes added\n- [ ] All prompts still function correctly","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:21:04.903916-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:21:04.903916-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.11","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:21:04.904592-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.11","depends_on_id":"loop-agents-9cg.9","type":"blocks","created_at":"2026-01-12T03:21:28.24894-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.11","depends_on_id":"loop-agents-9cg.6","type":"blocks","created_at":"2026-01-12T03:21:28.269374-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.2","title":"Extract autonomy-grant.md template","description":"Extract the autonomy grant paragraph found in elegance prompt into a reusable template.\n\n## Source Pattern (from elegance/prompt.md)\n```markdown\nThis is not a checklist task. You have full latitude to explore, investigate, and use your intelligence as you see fit. Trust your instincts. Follow threads that interest you. Go deep where depth is warranted.\n```\n\n## Target\nscripts/lib/templates/preamble/autonomy-grant.md\n\n## Acceptance Criteria\n- [ ] Template file created\n- [ ] Content matches the elegance prompt pattern\n- [ ] Works as standalone include","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:19:59.73915-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:19:59.73915-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.2","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:19:59.742962-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.2","depends_on_id":"loop-agents-9cg.1","type":"blocks","created_at":"2026-01-12T03:21:15.047282-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.3","title":"Extract read-context.md template","description":"Extract the context reading pattern found across all prompts into a reusable template.\n\n## Source Pattern (common across all prompts)\n```markdown\n## Context\n\nRead the progress file to see what previous iterations discovered:\n\\`\\`\\`bash\ncat ${PROGRESS}\n\\`\\`\\`\n```\n\n## Variations to Consider\n- Basic: Just cat progress file\n- Extended: Also show iteration number and context.json path\n- Full: Include jq commands to parse context.json\n\n## Target\nscripts/lib/templates/patterns/read-context.md\n\n## Acceptance Criteria\n- [ ] Template file created with most common pattern\n- [ ] Uses ${PROGRESS} variable (resolved before include)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:06.495793-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:06.495793-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.3","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:20:06.496511-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.3","depends_on_id":"loop-agents-9cg.1","type":"blocks","created_at":"2026-01-12T03:21:15.072687-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.4","title":"Extract write-status.md template","description":"Extract the status writing pattern found in all prompts into a reusable template.\n\n## Source Pattern (common JSON schema)\n```markdown\n### Write Status\n\nAfter completing your work, write your status to \\`${STATUS}\\`:\n\n\\`\\`\\`json\n{\n  \"decision\": \"continue\",\n  \"reason\": \"Brief explanation\",\n  \"summary\": \"What happened this iteration\",\n  \"work\": {\n    \"items_completed\": [],\n    \"files_touched\": []\n  },\n  \"errors\": []\n}\n\\`\\`\\`\n```\n\n## Target\nscripts/lib/templates/patterns/write-status.md\n\n## Include Decision Guide\nThe decision guide (continue/stop/error explanations) should be part of this template with placeholders for stage-specific guidance.\n\n## Acceptance Criteria\n- [ ] Template includes JSON schema\n- [ ] Template includes generic decision guide\n- [ ] Uses ${STATUS} variable","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:12.592003-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:12.592003-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.4","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:20:12.594568-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.4","depends_on_id":"loop-agents-9cg.1","type":"blocks","created_at":"2026-01-12T03:21:15.09551-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.5","title":"Extract subagent-guidance.md template","description":"Extract the subagent spawning guidance from elegance prompt into a reusable template.\n\n## Source Pattern (from elegance/prompt.md)\n```markdown\nSpin up subagents freely. When you encounter something that warrants deeper investigation — a suspicious abstraction, a complex subsystem, a pattern you don't fully understand — launch a targeted subagent to explore it thoroughly and report back. Manage your context wisely, and use subagents for depth. Preserve your own context for synthesis and judgment.\n```\n\n## Target\nscripts/lib/templates/patterns/subagent-guidance.md\n\n## Acceptance Criteria\n- [ ] Template file created\n- [ ] Guidance is general enough for any stage\n- [ ] Explains when and why to use subagents","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:19.345916-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:19.345916-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.5","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:20:19.348196-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.5","depends_on_id":"loop-agents-9cg.1","type":"blocks","created_at":"2026-01-12T03:21:15.116177-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.6","title":"Extract context-header.md template","description":"Extract the standard context header block found at the top of all prompts.\n\n## Source Pattern (common across all prompts)\n```markdown\nRead context from: ${CTX}\nProgress file: ${PROGRESS}\nIteration: ${ITERATION}\n```\n\n## Variations\nSome prompts include additional lines like:\n- Status output: ${STATUS}\n- Output file: ${OUTPUT_PATH}\n\n## Target\nscripts/lib/templates/fragments/context-header.md\n\n## Acceptance Criteria\n- [ ] Template file created with common header\n- [ ] Variables are passed through (resolved after include expansion)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:24.999178-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:24.999178-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.6","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:20:25.001268-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.6","depends_on_id":"loop-agents-9cg.1","type":"blocks","created_at":"2026-01-12T03:21:15.138775-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.7","title":"Implement include resolution in resolve.sh","description":"Add template include resolution to scripts/lib/resolve.sh.\n\n## Syntax\n```\n${include:path/to/template.md}\n```\n\n## Resolution Logic\n1. Parse template for ${include:...} patterns\n2. Resolve relative to scripts/lib/templates/ directory\n3. Read include file content\n4. Replace include directive with content\n5. Process recursively (includes can include other includes)\n6. THEN resolve variables (${CTX}, ${PROGRESS}, etc.)\n\n## Order of Operations\n1. First: Expand all includes (recursively)\n2. Second: Resolve variables in the fully-expanded template\n\nThis ensures variables inside includes are resolved correctly.\n\n## Edge Cases\n- Missing include file: Error with clear message\n- Circular includes: Detect and error\n- Include depth limit: Max 10 levels to prevent runaway recursion\n\n## Acceptance Criteria\n- [ ] resolve_includes() function added\n- [ ] Called before resolve_prompt() variable substitution\n- [ ] Handles nested includes\n- [ ] Clear error messages for missing files\n- [ ] Circular include detection","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:34.316837-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:34.316837-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.7","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:20:34.31952-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.7","depends_on_id":"loop-agents-9cg.1","type":"blocks","created_at":"2026-01-12T03:21:21.354872-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.8","title":"Add include resolution tests","description":"Add tests for the include resolution mechanism.\n\n## Test Cases\n1. Basic include resolution\n2. Nested includes (include within include)\n3. Missing file error handling\n4. Circular include detection\n5. Variable resolution after include expansion\n6. Include at various positions (start, middle, end)\n7. Multiple includes in same file\n\n## Test Location\nAdd to scripts/lib/test.sh or create scripts/lib/test-resolve.sh\n\n## Acceptance Criteria\n- [ ] All test cases covered\n- [ ] Tests are runnable via standard test command\n- [ ] Clear pass/fail output","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:45.051309-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:45.051309-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.8","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:20:45.053575-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.8","depends_on_id":"loop-agents-9cg.7","type":"blocks","created_at":"2026-01-12T03:21:21.375074-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9cg.9","title":"Migrate elegance prompt to use includes","description":"Refactor elegance/prompt.md to use the new include system as a proof of concept.\n\n## Current Content to Replace\n1. Autonomy grant paragraph -\u003e ${include:preamble/autonomy-grant.md}\n2. Context reading section -\u003e ${include:patterns/read-context.md}\n3. Write status section -\u003e ${include:patterns/write-status.md}\n4. Subagent guidance -\u003e ${include:patterns/subagent-guidance.md}\n\n## Before/After Comparison\nDocument the before/after line counts and ensure behavior is identical.\n\n## Acceptance Criteria\n- [ ] elegance/prompt.md uses includes\n- [ ] Resolved prompt is identical to original\n- [ ] Prompt still works in actual pipeline run","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:51.541178-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:51.541178-06:00","labels":["loop/template-includes"],"dependencies":[{"issue_id":"loop-agents-9cg.9","depends_on_id":"loop-agents-9cg","type":"parent-child","created_at":"2026-01-12T03:20:51.543484-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.9","depends_on_id":"loop-agents-9cg.7","type":"blocks","created_at":"2026-01-12T03:21:21.39699-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.9","depends_on_id":"loop-agents-9cg.2","type":"blocks","created_at":"2026-01-12T03:21:21.417492-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.9","depends_on_id":"loop-agents-9cg.3","type":"blocks","created_at":"2026-01-12T03:21:21.439041-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.9","depends_on_id":"loop-agents-9cg.4","type":"blocks","created_at":"2026-01-12T03:21:21.498228-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9cg.9","depends_on_id":"loop-agents-9cg.5","type":"blocks","created_at":"2026-01-12T03:21:21.519693-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9eu","title":"Add dependency checks for tmux and bd","description":"Engine only checks jq and claude. Add checks for tmux and bd (beads CLI).","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T03:44:30.738728-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:44:30.738728-06:00","labels":["loop/deploy"]}
{"id":"loop-agents-9r1","title":"Update pipeline-designer SKILL.md with confidence documentation","description":"Update the main SKILL.md to document confidence scoring as part of the architecture output.\n\n## Changes to skills/pipeline-designer/SKILL.md\n\n### Update Output Format section\nAdd confidence fields to the spec format:\n\n```yaml\nname: pipeline-name\nconfirmed_at: 2026-01-12T10:00:00Z\n\n# NEW: Confidence metadata\nconfidence:\n  overall: 0.85\n  breakdown:\n    termination_strategy: 0.95\n    stage_count: 0.70\n    model_selection: 0.90\n  uncertainties:\n    - 'Stage ordering between refine and elegance'\n\nstages:\n  - name: stage-name\n    # ... existing fields ...\n\nrationale: |\n  Why this architecture fits the use case.\n  Note: Low confidence in stage_count because...\n```\n\n### Update Success Criteria\nAdd:\n- [ ] Confidence score included in architecture recommendation\n- [ ] Low-confidence areas (\u003c70%) discussed with user before confirmation\n- [ ] Uncertainties documented in rationale\n\n### Update References Index\nAdd row:\n| confidence-calibration.md | How to generate calibrated confidence scores |\n\n## Files\n- skills/pipeline-designer/SKILL.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:21:02.711269-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:21:02.711269-06:00","labels":["loop/confidence-scoring"],"dependencies":[{"issue_id":"loop-agents-9r1","depends_on_id":"loop-agents-efr","type":"blocks","created_at":"2026-01-12T03:21:07.67094-06:00","created_by":"daemon"},{"issue_id":"loop-agents-9r1","depends_on_id":"loop-agents-xm5","type":"blocks","created_at":"2026-01-12T03:21:07.692109-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9r8","title":"Update build.md workflow to parse confidence from architect output","description":"Modify skills/pipeline-designer/workflows/build.md to handle confidence scoring in the architecture agent response.\n\n## Changes to Step 3: Validate and Confirm\n\n### Parse Agent Output\nAfter receiving YAML from pipeline-architect subagent:\n1. Extract overall confidence score\n2. Extract confidence_breakdown components\n3. Extract areas_of_uncertainty list\n4. Identify LOW confidence dimensions (\u003c0.70)\n\n### Enhanced Presentation Template\nUpdate the markdown template to include confidence:\n\n```markdown\n## Proposed Pipeline Architecture\n\n**Name:** {name}\n**Type:** {single-stage | multi-stage}\n**Confidence:** {confidence}% {confidence_indicator}\n\n### Confidence Breakdown\n| Dimension | Score | Notes |\n|-----------|-------|-------|\n| Termination strategy | {score}% | {high/medium/low} |\n| Stage count | {score}% | {high/medium/low} |\n| ...\n\n### Areas of Uncertainty\n{if any areas_of_uncertainty}\n- {uncertainty 1}\n- {uncertainty 2}\n{endif}\n\n### Stages\n...existing table...\n```\n\n## Confidence Indicators\n- 90%+: (check) High confidence\n- 70-89%: (warning) Moderate - review recommended  \n- \u003c70%: (alert) Low - discuss before proceeding\n\n## Files\n- skills/pipeline-designer/workflows/build.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:15.007448-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:15.007448-06:00","labels":["loop/confidence-scoring"],"dependencies":[{"issue_id":"loop-agents-9r8","depends_on_id":"loop-agents-rur","type":"blocks","created_at":"2026-01-12T03:20:20.488752-06:00","created_by":"daemon"}]}
{"id":"loop-agents-9wm","title":"Define result.json schema and update worker prompts","description":"Define the worker output schema (result.json) that replaces status.json:\n\nresult.json schema:\n{\n  \"summary\": \"what changed\",\n  \"work\": {\n    \"items_completed\": [],\n    \"files_touched\": []\n  },\n  \"artifacts\": {\n    \"outputs\": [],\n    \"paths\": []\n  },\n  \"signals\": {\n    \"plateau_suspected\": false,\n    \"risk\": \"low\",\n    \"notes\": \"\"\n  }\n}\n\nKey change: No 'decision' field. Workers produce results, engine decides.\n\nUpdate all stage prompts to write result.json instead of status.json.","acceptance_criteria":"- [ ] result.json schema defined\n- [ ] Engine validates result.json format\n- [ ] All stage prompts updated to write result.json\n- [ ] signals.plateau_suspected passed to judge\n- [ ] Backward compatibility for status.json during migration","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-14T02:45:53.487218-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T10:00:57.712131123+01:00","labels":["phase/3-termination","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-9wm","depends_on_id":"loop-agents-o82","type":"blocks","created_at":"2026-01-14T02:50:47.891921-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-a8h","title":"Rename scripts/loops/ to scripts/stages/","description":"Move directory, update all references in engine.sh, run.sh, lib/*.sh, prompts, CLAUDE.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T03:46:05.154093-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:01:55.031988-06:00","closed_at":"2026-01-12T22:01:55.031988-06:00","close_reason":"Verified complete - rename is done in codebase","labels":["rename"]}
{"id":"loop-agents-a9f","title":"Implement recursive inheritance following lineage chain","description":"Support transitive inheritance: when B inherited from A, C inheriting from B also gets A's learnings.\n\n**Implementation:**\n- In load_inherited_context, check source session's parent_session\n- Recursively load and merge learnings up to depth limit (3)\n- Deduplicate merged learnings\n\n**Acceptance criteria:**\n- [ ] C inheriting from B gets learnings from A through B\n- [ ] Merging respects depth limit\n- [ ] Deduplication removes repeated learnings","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:52:55.63186-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:52:55.63186-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-a9f","depends_on_id":"loop-agents-jcl","type":"blocks","created_at":"2026-01-13T01:55:35.606795-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-a9f","depends_on_id":"loop-agents-0kn","type":"blocks","created_at":"2026-01-13T01:55:40.748313-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-abt","title":"Rename bead labels: loop/ → pipeline/","description":"Update prompts, CLAUDE.md, and note migration for existing beads","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T03:46:05.305403-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:46:05.305403-06:00","labels":["rename"]}
{"id":"loop-agents-ak2","title":"Pipeline Display Skill - Unified Visualization System","description":"A unified visualization system for loop-agents that serves three contexts:\n\n**1. PREVIEW MODE** - Show pipeline structure before running\n- Stage boxes with termination strategy, description, iteration limits\n- Flow arrows showing data dependencies\n- Used by pipeline-builder to present recommendations\n\n**2. EDIT MODE** - Show current pipeline with edit affordances\n- Which stages are configured, their settings\n- Highlight what can be changed\n- Used when tweaking a pipeline before/during execution\n\n**3. DEBUG MODE** - Show runtime state of running/completed pipeline\n- Timeline of iterations with decisions (continue/stop)\n- Jump to specific iteration output\n- Diff between iterations\n- See why a stage stopped (plateau, queue empty, error)\n- Inspect context.json, status.json at any point\n\n**Key principle:** READ-ONLY visualization. No runtime overhead. Reads existing files and presents them beautifully.\n\n**ASCII, terminal-friendly display format.**","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-12T03:36:57.727553-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:36:57.727553-06:00","labels":["loop/pipeline-display","skill"]}
{"id":"loop-agents-ak2.1","title":"Create scripts/lib/display.sh with core ASCII rendering primitives","description":"Create the foundational display library with terminal-friendly ASCII primitives.\n\n**Functions to implement:**\n\n1. `draw_box` - Render a box with title and content lines\n   - Input: title, lines array, width (optional, auto-size)\n   - Output: ASCII box with borders (┌─┐│└─┘)\n\n2. `draw_arrow` - Horizontal arrow connecting elements\n   - Input: length, label (optional)\n   - Output: ────▶ or ──label──▶\n\n3. `draw_pipeline_row` - Render a row of connected stage boxes\n   - Input: array of stage objects {name, type, description, details}\n   - Output: [Box]────▶[Box]────▶[Box]\n\n4. `draw_timeline` - Horizontal iteration timeline\n   - Input: iterations array [{number, decision, summary}], current\n   - Output: 1 ───▶ 2 ───▶ 3 ✓ with decisions below\n\n5. `truncate_text` - Smart truncation with ellipsis\n6. `wrap_text` - Word wrap within column width\n7. `color_decision` - ANSI colors for continue/stop/error\n\n**Terminal detection:**\n- Check $TERM for color support\n- Respect NO_COLOR environment variable\n- Fallback to plain ASCII if needed\n\n**Test cases:**\n- Box sizing with varying content\n- Multi-box row alignment\n- Unicode vs ASCII fallback","status":"open","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2026-01-12T03:37:10.050796-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:37:10.050796-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.1","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:37:10.054275-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.10","title":"Implement edit mode: session configuration viewer","description":"Show current session configuration with edit affordances.\n\n**Command:** `/pipeline edit {session}`\n\n**Input:** Running or paused session\n\n**Output format:**\n```\n═══════════════════════════════════════════════════════════════════════════\nSession: auth-refactor (running)\nPipeline: full-refine\nStarted: 2026-01-12T10:00:00Z\n═══════════════════════════════════════════════════════════════════════════\n\nCurrent Stage: improve-plan (iteration 3/5)\n\n┌─────────────────────┐     ┌─────────────────────┐\n│   improve-plan      │     │   refine-beads      │\n│ [judgment] 2-agree  │     │ [judgment] 2-agree  │\n│ █████░░░░░ 3/5     │────▶│ ░░░░░░░░░░ 0/5     │\n│ ✏️ editable         │     │ locked              │\n└─────────────────────┘     └─────────────────────┘\n\nEditable Settings (current stage):\n  • max_iterations: 5    [change: runs=N]\n  • consensus: 2         [change: consensus=N]\n  • delay: 2s            [change: delay=N]\n\nSession Settings:\n  • Progress file: progress-auth-refactor.md  [view]\n  • Labels: loop/auth-refactor                [change]\n\n[p]ause  [r]esume  [s]kip stage  [k]ill\n```\n\n**Implementation:**\n1. Load state.json for current progress\n2. Load pipeline config for stage definitions\n3. Show progress bars in stage boxes\n4. Mark current stage as editable, future stages as locked\n5. Show available edit operations\n\nNOTE: Actual editing is out of scope - this just SHOWS what can be edited.","status":"open","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2026-01-12T03:38:52.91152-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:38:52.91152-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.10","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:38:52.920589-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.10","depends_on_id":"loop-agents-ak2.7","type":"blocks","created_at":"2026-01-12T03:38:52.924612-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.11","title":"Create skill structure: skills/pipeline-display/SKILL.md","description":"Create the Claude Code skill definition for pipeline-display.\n\n**File:** skills/pipeline-display/SKILL.md\n\n**Content structure:**\n```yaml\n---\nname: pipeline-display\ndescription: Unified visualization for pipelines - preview, edit, debug\n---\n```\n\n**Sections:**\n1. `\u003cobjective\u003e` - Explain the three modes (preview, edit, debug)\n2. `\u003cessential_principles\u003e` - READ-ONLY, no runtime overhead\n3. `\u003cusage\u003e` - Command syntax for each mode\n4. `\u003cintake\u003e` - How to determine which mode based on input\n5. `\u003crouting\u003e` - Map commands to workflows\n6. `\u003cquick_start\u003e` - Most common commands\n7. `\u003creference_index\u003e` - Point to display.sh docs\n8. `\u003cworkflows_index\u003e` - List all workflow files\n9. `\u003csuccess_criteria\u003e` - What good output looks like\n\n**Intake routing logic:**\n- No args → Interactive mode selector\n- `show {name}` → Preview mode\n- `debug {session}` → Debug mode  \n- `edit {session}` → Edit mode\n- `list stages` → Stage list\n- `list pipelines` → Pipeline list","status":"open","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2026-01-12T03:39:03.126526-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:39:03.126526-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.11","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:39:03.129194-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.12","title":"Create workflow: workflows/debug-session.md","description":"Create the debug mode workflow for the skill.\n\n**File:** skills/pipeline-display/workflows/debug-session.md\n\n**Workflow steps:**\n1. Validate session exists\n   - Check .claude/pipeline-runs/{session}/ exists\n   - Load state.json\n   \n2. Determine display type\n   - If running: show live timeline with current iteration\n   - If completed: show full timeline with completion reason\n   - If failed: show error information and recovery options\n\n3. Render timeline\n   - Call render functions from scripts/lib/display.sh\n   - Show completion reason if applicable\n\n4. Enter interactive mode (if terminal)\n   - Present command options: [i]teration [d]iff [c]ontext [s]tatus [p]rogress\n   - Handle navigation between views\n\n5. Error handling\n   - Session not found: suggest listing sessions\n   - Corrupted state: show what can be recovered","status":"open","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-12T03:39:12.266221-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:39:12.266221-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.12","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:39:12.26844-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.12","depends_on_id":"loop-agents-ak2.11","type":"blocks","created_at":"2026-01-12T03:39:12.270763-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.13","title":"Create workflow: workflows/preview-pipeline.md","description":"Create the preview mode workflow for the skill.\n\n**File:** skills/pipeline-display/workflows/preview-pipeline.md\n\n**Workflow steps:**\n1. Resolve pipeline/stage reference\n   - If name matches scripts/pipelines/{name}.yaml → pipeline preview\n   - If name matches scripts/loops/{name}/ → single stage preview\n   - Otherwise: error with suggestions\n\n2. Load definitions\n   - Parse YAML config\n   - For pipelines: load each stage's loop.yaml\n   \n3. Render preview\n   - Single stage: show stage box with full details\n   - Pipeline: show connected stage flow\n   - Include termination strategies, iteration limits\n\n4. Show usage hints\n   - How to run this pipeline/stage\n   - Example command with session name placeholder\n   \n5. Integration with pipeline-builder\n   - Can be called from pipeline-builder to show recommended architecture\n   - Output should be suitable for inclusion in Claude response","status":"open","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-12T03:39:21.1623-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:39:21.1623-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.13","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:39:21.165172-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.13","depends_on_id":"loop-agents-ak2.11","type":"blocks","created_at":"2026-01-12T03:39:21.16772-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.14","title":"Create workflow: workflows/edit-session.md","description":"Create the edit mode workflow for the skill.\n\n**File:** skills/pipeline-display/workflows/edit-session.md\n\n**Workflow steps:**\n1. Validate session exists and is editable\n   - Must be running or paused (not completed)\n   - Load state.json for current position\n\n2. Load session configuration\n   - Get pipeline type from state\n   - Load current and future stage configs\n\n3. Render session with edit affordances\n   - Show progress in each stage\n   - Mark current stage as editable\n   - Show available parameters that can be changed\n\n4. Document available edits\n   - max_iterations: how to change\n   - consensus: how to change  \n   - delay: how to change\n   - Note: actual editing is separate - this just shows what's possible\n\n5. Show session control options\n   - pause/resume commands\n   - skip stage (jump to next)\n   - kill session\n\nNOTE: This is READ-ONLY visualization. It shows what CAN be edited, not an interactive editor.","status":"open","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-12T03:39:29.118313-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:39:29.118313-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.14","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:39:29.120962-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.14","depends_on_id":"loop-agents-ak2.11","type":"blocks","created_at":"2026-01-12T03:39:29.123571-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.15","title":"Create command integration: commands/pipeline.md update","description":"Update the /pipeline command to integrate display skill.\n\n**Current state:** May not exist or may be minimal\n\n**New subcommands to add:**\n```\n/pipeline show {name}      # Preview mode - show pipeline/stage structure\n/pipeline debug {session}  # Debug mode - runtime state and iteration timeline\n/pipeline edit {session}   # Edit mode - show configuration with affordances\n/pipeline list             # List pipelines and stages\n```\n\n**Implementation:**\n1. Check if commands/pipeline.md exists\n2. If exists: add new subcommands while preserving existing\n3. If not: create new command file\n\n**Command file structure:**\n- Description of /pipeline command\n- Subcommand table with usage\n- Route each subcommand to pipeline-display skill\n- Provide examples for each mode","status":"open","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-12T03:39:37.957093-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:39:37.957093-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.15","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:39:37.959658-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.15","depends_on_id":"loop-agents-ak2.11","type":"blocks","created_at":"2026-01-12T03:39:37.962938-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.15","depends_on_id":"loop-agents-ak2.12","type":"blocks","created_at":"2026-01-12T03:39:37.965049-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.15","depends_on_id":"loop-agents-ak2.13","type":"blocks","created_at":"2026-01-12T03:39:37.967095-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.15","depends_on_id":"loop-agents-ak2.14","type":"blocks","created_at":"2026-01-12T03:39:37.969032-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.16","title":"Integration: Connect display skill to sessions skill","description":"Integrate pipeline-display with existing sessions skill.\n\n**Current sessions skill:** skills/sessions/SKILL.md\n**Relevant workflows:** check-status.md, monitor-session.md\n\n**Integration points:**\n\n1. `/sessions status {name}` should use pipeline-display\n   - Call debug mode timeline renderer\n   - Show quick status with option to dive deeper\n\n2. `/sessions list` enhancement\n   - Show pipeline structure in list output\n   - Add column for current stage/iteration\n\n3. Cross-references\n   - From sessions → \"Use /pipeline debug {name} for detailed view\"\n   - From pipeline-display → \"Use /sessions to manage lifecycle\"\n\n**Implementation:**\n1. Update sessions SKILL.md quick_start with pipeline-display references\n2. Update check-status workflow to use display functions\n3. Add see-also references between skills","status":"open","priority":2,"issue_type":"task","estimated_minutes":20,"created_at":"2026-01-12T03:39:47.102797-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:39:47.102797-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.16","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:39:47.105183-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.16","depends_on_id":"loop-agents-ak2.11","type":"blocks","created_at":"2026-01-12T03:39:47.107764-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.17","title":"Create test harness with sample session data","description":"Create test fixtures and manual test script for display functions.\n\n**Test fixtures needed:**\n\n1. `tests/fixtures/pipeline-display/completed-session/`\n   - state.json with full history (4 iterations, plateau stop)\n   - stage-00-improve-plan/iterations/001-004/\n   - Each iteration: context.json, status.json, output.md\n   - progress-test.md with accumulated content\n   - (Can copy/adapt from existing tdd-prose-research session)\n\n2. `tests/fixtures/pipeline-display/running-session/`\n   - state.json with status=\"running\", iteration=2\n   - Partial iterations directory\n\n3. `tests/fixtures/pipeline-display/failed-session/`\n   - state.json with status=\"failed\", error object\n   - Incomplete iteration that crashed\n\n**Test script:** tests/display-test.sh\n- Source lib/display.sh\n- Run each render function against fixtures\n- Visual verification (output to terminal)\n- Can be run manually to verify display looks correct\n\n**Usage:**\n```bash\n./tests/display-test.sh timeline    # Test timeline renderer\n./tests/display-test.sh boxes       # Test stage boxes\n./tests/display-test.sh pipeline    # Test full pipeline render\n./tests/display-test.sh all         # Run all tests\n```","status":"open","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-12T03:39:58.539958-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:39:58.539958-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.17","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:39:58.542545-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.18","title":"Add display.sh to engine.sh for status output","description":"Integrate display library with main engine for status output.\n\n**Current:** scripts/run.sh status {session} uses basic output\n**Goal:** Use display.sh for richer status output\n\n**Changes to scripts/run.sh:**\n1. Source lib/display.sh\n2. In status subcommand, use timeline renderer\n3. Add --json flag to get machine-readable output (bypass display)\n\n**Status output modes:**\n- Default: Pretty ASCII timeline\n- --json: Raw state.json output\n- --brief: One-line status summary\n\n**Implementation:**\n1. Source display.sh in run.sh\n2. Update status handling to call render_timeline()\n3. Add --json and --brief flags\n4. Ensure backward compatibility with existing usage","status":"open","priority":2,"issue_type":"task","estimated_minutes":20,"created_at":"2026-01-12T03:40:07.260183-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:40:07.260183-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.18","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:40:07.262514-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.18","depends_on_id":"loop-agents-ak2.1","type":"blocks","created_at":"2026-01-12T03:40:07.265057-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.18","depends_on_id":"loop-agents-ak2.2","type":"blocks","created_at":"2026-01-12T03:40:07.267169-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.2","title":"Implement debug mode: iteration timeline renderer","description":"Render iteration timeline from state.json history.\n\n**Input:** Session path or name\n**Source files:**\n- `.claude/pipeline-runs/{session}/state.json` - history array\n- `.claude/pipeline-runs/{session}/stage-*/iterations/*/status.json` - per-iteration status\n\n**Output format:**\n```\nStage: improve-plan [completed after 4 iterations]\n┌───────────────────────────────────────────────────────────────────────────┐\n│  1 ─────▶ 2 ─────▶ 3 ─────▶ 4 ✓                                          │\n│  continue  continue  stop     stop    ← plateau reached (2 consecutive)   │\n│  \"Found    \"Applied  \"Quality \"No                                        │\n│   issues\"   fixes\"    good\"   change\"                                    │\n└───────────────────────────────────────────────────────────────────────────┘\n```\n\n**Implementation:**\n1. Load state.json and parse history array\n2. For each iteration, extract decision and truncated reason/summary\n3. Mark current iteration (if running) with spinner/highlight\n4. Show completion reason if stage is done\n5. Handle multi-stage pipelines (show each stage timeline)","status":"open","priority":2,"issue_type":"task","estimated_minutes":60,"created_at":"2026-01-12T03:37:21.594721-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:37:21.594721-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.2","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:37:21.59843-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.2","depends_on_id":"loop-agents-ak2.1","type":"blocks","created_at":"2026-01-12T03:37:21.601442-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.3","title":"Implement debug mode: iteration detail viewer","description":"View detailed information about a specific iteration.\n\n**Command:** `[i]teration N` in debug mode\n\n**Source files:**\n- `iterations/NNN/context.json` - inputs, limits, paths\n- `iterations/NNN/status.json` - decision, reason, summary, work\n- `iterations/NNN/output.md` - agent's full output\n\n**Display format:**\n```\n═══════════════════════════════════════════════════════════════════════════\nIteration 3 of improve-plan\n═══════════════════════════════════════════════════════════════════════════\n\nDecision: stop\nReason: All research targets analyzed; architecture simplified.\n\nSummary:\n  Conducted architecture simplification pass identifying 6 areas of\n  overengineering. Simplified eligibility from 6 categories to binary...\n\nWork Completed:\n  • Section-by-section complexity analysis\n  • Simplified eligibility categories (Section 7.3)\n  • Marked behavior dependencies as Phase 3+ (Section 7.5)\n\nFiles Touched:\n  • tdd-prose-plan.md\n  • .claude/pipeline-runs/.../progress-tdd-prose-research.md\n\nContext:\n  Session: tdd-prose-research\n  Stage: research-plan (index 0)\n  Max iterations: 8\n  Remaining time: unlimited\n\n[v]iew output  [c]ontext json  [s]tatus json  [d]iff with N\n```\n\n**Implementation:**\n1. Parse iteration number from command\n2. Load context.json and status.json\n3. Format work.items_completed as bullet list\n4. Show navigation options at bottom","status":"open","priority":2,"issue_type":"task","estimated_minutes":60,"created_at":"2026-01-12T03:37:35.188753-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:37:35.188753-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.3","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:37:35.192797-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.3","depends_on_id":"loop-agents-ak2.1","type":"blocks","created_at":"2026-01-12T03:37:35.196437-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.4","title":"Implement debug mode: iteration diff viewer","description":"Show diff between two iterations' outputs or status.\n\n**Commands:**\n- `[d]iff N M` - Compare iterations N and M\n- `[d]iff N` - Compare iteration N with N-1\n\n**Source files:**\n- `iterations/NNN/output.md`\n- `iterations/NNN/status.json`\n\n**Display format:**\n```\n═══════════════════════════════════════════════════════════════════════════\nDiff: Iteration 2 → 3\n═══════════════════════════════════════════════════════════════════════════\n\nDecision changed: continue → stop\n\nSummary diff:\n  - Beads patterns successfully applied to plan...\n  + Conducted architecture simplification pass...\n\nWork items added:\n  + Section-by-section complexity analysis\n  + Simplified eligibility categories (Section 7.3)\n\nFiles newly touched:\n  (none)\n\n[o]utput diff  [s]tatus diff  [b]ack to timeline\n```\n\n**Implementation:**\n1. Load status.json from both iterations\n2. Compare decisions, summarize changes\n3. Diff items_completed arrays (show additions)\n4. For full output diff, use `diff` command or simple line-by-line comparison\n5. Color-code additions (green) and removals (red)","status":"open","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2026-01-12T03:37:45.617597-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:37:45.617597-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.4","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:37:45.620883-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.4","depends_on_id":"loop-agents-ak2.3","type":"blocks","created_at":"2026-01-12T03:37:45.623286-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.5","title":"Implement debug mode: progress file viewer","description":"View the accumulated progress file with iteration markers.\n\n**Command:** `[p]rogress` in debug mode\n\n**Source file:** `progress-{session}.md`\n\n**Display format:**\n```\n═══════════════════════════════════════════════════════════════════════════\nProgress File: progress-tdd-prose-research.md\n═══════════════════════════════════════════════════════════════════════════\n\n[Content of progress file with iteration markers highlighted]\n\n## Iteration 1 Findings\n...\n\n## Iteration 2 Findings  \n...\n\n───────────────────────────────────────────────────────────────────────────\nLast updated: 2026-01-12T07:40:03Z | 19232 bytes | 4 iterations\n[t]imeline  [i]teration N\n```\n\n**Implementation:**\n1. Read progress file from session directory\n2. Show with pagination if long (use $PAGER or simple more)\n3. Highlight iteration headers if present\n4. Show file stats at bottom\n5. Provide navigation back to timeline","status":"open","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-12T03:37:55.658595-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:37:55.658595-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.5","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:37:55.662533-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.5","depends_on_id":"loop-agents-ak2.1","type":"blocks","created_at":"2026-01-12T03:37:55.665158-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.6","title":"Implement debug mode: completion reason analyzer","description":"Explain WHY a stage or session stopped in plain language.\n\n**Display in timeline header when stage is completed:**\n```\nStage: improve-plan [completed after 4 iterations - plateau]\nReason: 2 consecutive agents agreed to stop\n        \"All research targets analyzed; architecture simplified.\"\n```\n\n**For different termination types:**\n\n1. **judgment (plateau)**\n   - Show consensus count achieved\n   - Show the stopping agent's reason\n   - Highlight the N consecutive 'stop' decisions\n\n2. **queue (beads empty)**\n   - Show that queue was empty\n   - Show items_completed from final iteration\n\n3. **fixed**\n   - Show that max iterations reached\n   - Show what the final agent accomplished\n\n4. **error**\n   - Show error type and message\n   - Show which iteration failed\n   - Suggest recovery actions (--resume)\n\n**Implementation:**\n1. Read state.json completion_reason\n2. Read termination config from loop.yaml\n3. Analyze history array for decision pattern\n4. Format human-readable explanation","status":"open","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2026-01-12T03:38:05.893095-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:38:05.893095-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.6","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:38:05.896705-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.6","depends_on_id":"loop-agents-ak2.2","type":"blocks","created_at":"2026-01-12T03:38:05.89934-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.7","title":"Implement preview mode: stage box renderer","description":"Render stage definition as an ASCII box for preview mode.\n\n**Input:** Stage definition from loop.yaml or pipeline config\n\n**Output format:**\n```\n┌─────────────────────┐\n│   improve-plan      │\n│ [judgment] 2-agree  │\n│ Refine plan quality │\n│ 5 iters max         │\n└─────────────────────┘\n```\n\n**Box content:**\n- Line 1: Stage name (bold/highlighted)\n- Line 2: [termination_type] strategy details\n  - judgment: \"N-agree\" where N is consensus count\n  - queue: \"until empty\"\n  - fixed: \"N iterations\"\n- Line 3: Description (truncated to box width)\n- Line 4: Iteration limit or constraint\n\n**Reading stage definitions:**\n1. Parse scripts/loops/{name}/loop.yaml using yaml.sh\n2. Extract: name, description, termination.type, termination.consensus\n3. Get iteration limit from pipeline config or loop config\n\n**Implementation:**\n1. Create `render_stage_box()` function\n2. Auto-size box to content or specified width\n3. Handle missing fields gracefully\n4. Support both standalone stages and pipeline-embedded stages","status":"open","priority":2,"issue_type":"task","estimated_minutes":60,"created_at":"2026-01-12T03:38:17.543877-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:38:17.543877-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.7","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:38:17.587608-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.7","depends_on_id":"loop-agents-ak2.1","type":"blocks","created_at":"2026-01-12T03:38:17.597335-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.8","title":"Implement preview mode: pipeline flow renderer","description":"Render full pipeline as connected stage boxes.\n\n**Input:** Pipeline YAML file path or pipeline config object\n\n**Output format:**\n```\nPipeline: full-refine\nComplete planning refinement - plan first, then beads\n\n┌─────────────────────┐     ┌─────────────────────┐\n│   improve-plan      │────▶│   refine-beads      │\n│ [judgment] 2-agree  │     │ [judgment] 2-agree  │\n│ Refine plan quality │     │ Polish bead specs   │\n│ 5 iters max         │     │ 5 iters max         │\n└─────────────────────┘     └─────────────────────┘\n                            inputs: improve-plan (latest)\n```\n\n**Features:**\n1. Show pipeline name and description header\n2. Connect stages with arrows\n3. Show input dependencies below receiving stage\n4. Handle single-stage pipelines (just one box)\n5. Wrap to multiple rows if pipeline is long (\u003e3 stages)\n\n**Reading pipeline definitions:**\n1. Parse scripts/pipelines/{name}.yaml\n2. For each stage, get loop definition from scripts/loops/{loop}/\n3. Merge pipeline-level overrides (runs, inputs)\n\n**Implementation:**\n1. Create `render_pipeline()` function\n2. Calculate total width, determine wrapping\n3. Render each row using `draw_pipeline_row()`\n4. Add dependency annotations","status":"open","priority":2,"issue_type":"task","estimated_minutes":60,"created_at":"2026-01-12T03:38:29.616312-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:38:29.616312-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.8","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:38:29.628119-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.8","depends_on_id":"loop-agents-ak2.7","type":"blocks","created_at":"2026-01-12T03:38:29.634742-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ak2.9","title":"Implement preview mode: stage list renderer","description":"List all available stages with summary info.\n\n**Command:** `/pipeline list stages` or `./scripts/run.sh` with no args\n\n**Output format:**\n```\nAvailable Stages:\n─────────────────────────────────────────────────────────────────────────────\nNAME            TYPE        TERMINATION      DESCRIPTION\n─────────────────────────────────────────────────────────────────────────────\nwork            task        fixed            Traditional Ralph loop - implement tasks\nimprove-plan    refinement  judgment/2       Iteratively improve plan document\nrefine-beads    refinement  judgment/2       Polish bead specifications\nelegance        review      judgment/2       Code elegance review\nidea-wizard     ideation    fixed            Generate improvement ideas\nresearch-plan   research    judgment/2       Deep research on plan topics\n─────────────────────────────────────────────────────────────────────────────\n```\n\n**Implementation:**\n1. Scan scripts/loops/*/ directories\n2. Parse each loop.yaml\n3. Categorize by purpose (task, refinement, review, ideation, research)\n4. Format as aligned table\n5. Sort by category or alphabetically","status":"open","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-12T03:38:40.022196-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:38:40.022196-06:00","labels":["loop/pipeline-display"],"dependencies":[{"issue_id":"loop-agents-ak2.9","depends_on_id":"loop-agents-ak2","type":"parent-child","created_at":"2026-01-12T03:38:40.027374-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ak2.9","depends_on_id":"loop-agents-ak2.1","type":"blocks","created_at":"2026-01-12T03:38:40.033505-06:00","created_by":"daemon"}]}
{"id":"loop-agents-arb","title":"Add cycle detection to prevent circular inheritance","description":"Implement cycle detection in load_inherited_context to prevent A→B→A infinite loops.\n\n**Implementation:**\n- Track visited_sessions as comma-separated string\n- Check if current session already in visited list before processing\n- Return empty JSON {} when cycle detected (non-fatal)\n\n**Acceptance criteria:**\n- [ ] Circular chain A→B→A returns {} without infinite loop\n- [ ] Warning message sent to stderr\n- [ ] Return code 0 (graceful degradation)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:47:39.68463-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:47:39.68463-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-arb","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T01:54:13.979317-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-asc","title":"Add --input CLI flag to run.sh","description":"Parse --input flags, pass to engine via PIPELINE_CLI_INPUTS env var","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T01:31:17.47102-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:34:36.029402-06:00","closed_at":"2026-01-13T01:34:36.029402-06:00","close_reason":"Added --input CLI flag to run.sh with help text","labels":["feature/initial-inputs"]}
{"id":"loop-agents-bcm","title":"Create idea-wizard prompt file","description":"Create scripts/refine/prompts/idea-wizard.md:\nGenerate 30 improvement ideas, think through each, winnow to best 5.\nNo loop integration needed - single shot execution.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T13:52:02.647448-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:02:57.13994-06:00","closed_at":"2026-01-12T22:02:57.13994-06:00","close_reason":"idea-wizard stage exists with prompt.md","labels":["loop/refine"]}
{"id":"loop-agents-bdt","title":"Add --inherit flag parsing to engine.sh","description":"Parse --inherit and --inherit=\u003csession\u003e flags in the engine.\n\n**Implementation:**\n- Parse in flag parsing section (around line 634)\n- Support both --inherit session-name and --inherit=session-name\n- Export INHERIT_FROM and INHERIT_SELECT environment variables\n\n**Acceptance criteria:**\n- [ ] --inherit session-name works\n- [ ] --inherit=session-name works\n- [ ] INHERIT_FROM and INHERIT_SELECT exported\n- [ ] Default INHERIT_SELECT is 'all'","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:50:45.000485-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:50:45.000485-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-bdt","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T01:54:34.487883-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-bdt","depends_on_id":"loop-agents-dl6","type":"blocks","created_at":"2026-01-13T02:03:10.798717-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-brf","title":"Implement atomic writes for all JSON files","description":"Ensure all JSON file writes are atomic:\n\nPattern: tmp=\"$(mktemp ...)\" ; write ; mv \"$tmp\" \"$final\"\n\nApply to:\n- plan.json\n- state.json\n- ctx.json\n- result.json (engine wrapper)\n- output.json\n- hook_ctx.json\n\nThis prevents corruption from interrupted writes.","acceptance_criteria":"- [ ] All JSON writes use temp file + mv pattern\n- [ ] No partial writes possible\n- [ ] Works correctly on all platforms\n- [ ] All existing tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:49:10.337959-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.768053995+01:00","closed_at":"2026-01-14T17:09:07.583235-06:00","labels":["phase/0-foundation","pipeline/v3-event-spine"]}
{"id":"loop-agents-bri","title":"Add session name validation to reject commas","description":"Validate session names to prevent characters that would break inheritance.\n\n**Implementation:**\n- Create validate_session_name() in scripts/lib/session.sh (or inherit.sh)\n- Reject session names containing commas (used as lineage delimiter)\n- Reject path traversal characters (/, ..)\n\n**Acceptance criteria:**\n- [ ] validate_session_name 'my-session' returns 0\n- [ ] validate_session_name 'my,session' returns 1 with error\n- [ ] validate_session_name 'my/session' returns 1 with error\n- [ ] Validation called on session creation","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:51:33.40276-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:51:33.40276-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-bri","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T01:54:50.053116-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-bsl","title":"Rename project: loop-agents → agent-pipelines","description":"Comprehensive rename of the project to agent-pipelines. Skill prefix: /agent-pipelines:*, directory: scripts/stages/","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-12T03:46:05.121397-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:46:05.121397-06:00","labels":["rename"]}
{"id":"loop-agents-c3c","title":"Integrate parallel.sh with event spine","description":"Integrate existing parallel.sh with the event spine:\n\nEvent flow for parallel blocks:\nnode_start (path: '1', kind: 'parallel')\n├── parallel_provider_start (provider: 'claude')\n│   ├── iteration_start (provider: 'claude', iteration: 1)\n│   ├── worker_complete (provider: 'claude', iteration: 1)\n│   └── ...\n├── parallel_provider_complete (provider: 'claude')\n├── parallel_provider_complete (provider: 'codex')\n└── node_complete (path: '1')\n\nExtended cursor for parallel:\n{\"node_path\": \"1\", \"node_run\": 1, \"provider\": \"claude\", \"iteration\": 5}\n\nResume within parallel block:\n1. Check which providers completed (have parallel_provider_complete)\n2. Skip completed providers\n3. For incomplete, find last iteration_complete and resume\n4. Wait for all providers before node_complete","acceptance_criteria":"- [ ] Parallel events emitted correctly\n- [ ] Provider field in cursor for parallel blocks\n- [ ] Resume skips completed providers\n- [ ] Incomplete providers resume correctly\n- [ ] node_complete waits for all providers\n- [ ] test_parallel_events.sh passes","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-14T02:48:28.984492-06:00","created_by":"harrisonwells","updated_at":"2026-01-14T02:48:28.984492-06:00","labels":["phase/4-parallel","phase/7-parallel","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-c3c","depends_on_id":"loop-agents-z17","type":"blocks","created_at":"2026-01-14T02:51:59.473796-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-c3c","depends_on_id":"loop-agents-2c4","type":"blocks","created_at":"2026-01-14T02:52:04.631561-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-c3c","depends_on_id":"loop-agents-edc","type":"blocks","created_at":"2026-01-14T21:50:25.202644-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-ceo","title":"Add viz --detailed flag for verbose output","description":"Add --detailed flag that shows expanded information:\n- Full termination config (min_iterations, consensus)\n- Prompt file path for each stage\n- Input/output dependencies in detail\n- Historical run statistics (last 5 runs: avg iterations, success rate)\n\nDefault viz shows compact view; --detailed shows everything.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:47.541879-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.78973-06:00","closed_at":"2026-01-12T03:41:03.78973-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-ceo","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:20.968248-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ceo","depends_on_id":"loop-agents-fvk","type":"blocks","created_at":"2026-01-12T03:21:36.918115-06:00","created_by":"daemon"},{"issue_id":"loop-agents-ceo","depends_on_id":"loop-agents-6dy","type":"blocks","created_at":"2026-01-12T03:24:33.943064-06:00","created_by":"daemon"}]}
{"id":"loop-agents-cim","title":"Wire event spine into engine.sh","description":"Update engine.sh to use the event spine:\n\nChanges:\n- Source events.sh, state.sh, locks.sh, compile.sh\n- Compile pipeline YAML to plan.json before execution\n- Emit events at each lifecycle point\n- Use state.json as cache, events.jsonl as truth\n- Implement resume using event spine","acceptance_criteria":"- [ ] engine.sh sources new modules\n- [ ] plan.json compiled before execution\n- [ ] Events emitted for session_start, iteration_start, worker_complete, etc.\n- [ ] Resume uses event spine correctly\n- [ ] Backward compatible with existing pipelines\n- [ ] All existing tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:44:15.48527-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.793746659+01:00","closed_at":"2026-01-14T17:06:55.477492-06:00","labels":["phase/1-event-spine","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-cim","depends_on_id":"loop-agents-z17","type":"blocks","created_at":"2026-01-14T02:49:54.879206-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-cim","depends_on_id":"loop-agents-82a","type":"blocks","created_at":"2026-01-14T02:50:00.052404-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-cim","depends_on_id":"loop-agents-iup","type":"blocks","created_at":"2026-01-14T02:50:05.235909-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-cim","depends_on_id":"loop-agents-969","type":"blocks","created_at":"2026-01-14T02:50:10.41672-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-cxe","title":"Add parent_session field to state.json","description":"Track inheritance lineage in state.json for debugging.\n\n**Implementation location:** scripts/lib/state.sh (init_state and update_state functions)\n\n**Changes needed:**\n1. init_state: Accept optional parent_session parameter\n2. Write parent_session to state.json on session creation\n3. Engine passes INHERIT_FROM when calling init_state\n\n**Example state.json with parent:**\n{\n  \"session\": \"auth-v2\",\n  \"status\": \"running\",\n  \"parent_session\": \"auth-v1\",\n  ...\n}\n\n**Acceptance criteria:**\n- [ ] state.json includes parent_session when --inherit used\n- [ ] Field is null/missing when no inheritance\n- [ ] init_state() accepts parent_session parameter\n- [ ] engine.sh passes INHERIT_FROM to state initialization\n- [ ] Can trace back through chain via parent_session fields","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:52:31.525052-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T02:02:27.389782-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-cxe","depends_on_id":"loop-agents-2q1","type":"blocks","created_at":"2026-01-13T01:55:30.469753-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-d1o","title":"Rename skill prefix from /loop-agents: to /agent-pipelines:","description":"Update all skill SKILL.md files and command references","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T03:46:05.213877-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:01:55.040526-06:00","closed_at":"2026-01-12T22:01:55.040526-06:00","close_reason":"Verified complete - rename is done in codebase","labels":["rename"]}
{"id":"loop-agents-daa","title":"Create plan-improver prompt file","description":"Create scripts/refine/prompts/plan-improver.md with:\n1. Full plan-improver prompt (iterative plan improvement)\n2. Variable substitution for SESSION_NAME and PLAN_FILE\n3. Required output format: CHANGES: N and SUMMARY: line","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:51:51.029611-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:40.055417-06:00","closed_at":"2026-01-09T14:13:40.055417-06:00","close_reason":"Completed via loop-engine refactor","labels":["loop/refine"],"dependencies":[{"issue_id":"loop-agents-daa","depends_on_id":"loop-agents-od6","type":"blocks","created_at":"2026-01-09T13:52:32.181895-06:00","created_by":"daemon"}]}
{"id":"loop-agents-di8","title":"Add confidence to pipeline-architect agent prompt","description":"Update the pipeline-architect agent definition to explicitly request and guide confidence scoring.\n\n## Changes to .claude/agents/pipeline-architect.md\n\n### Add to 'Your Task' section\n```markdown\n## Your Task\n\nWhen invoked, you receive:\n- A requirements summary (what the user wants)\n- List of existing stages (from \\`ls scripts/loops/\\`)\n\nAnalyze the requirements and design the optimal architecture.\n\n**IMPORTANT:** Include honest confidence assessments. Your confidence scores help users decide whether to accept immediately or ask clarifying questions. Be calibrated - don't default to 0.85 on everything.\n```\n\n### Update Output Format\nAdd confidence section to the YAML template (already specified in task 1).\n\n### Add Confidence Guidance Section\n```markdown\n## Confidence Scoring\n\nFor each recommendation, assess your confidence honestly:\n\n**Overall Confidence (0-1)**\nWeight of individual dimensions based on their impact:\n- Termination strategy: 30% (fundamental to how the loop works)\n- Stage count: 25% (affects complexity and cost)\n- Model selection: 20% (cost vs capability tradeoff)\n- Stage ordering: 15% (for multi-stage only)\n- Existing stage reuse: 10% (implementation detail)\n\n**When Confidence is Low (\u003c0.70)**\n- Explicitly state what information would raise it\n- Include in areas_of_uncertainty\n- Make the uncertainty visible in rationale\n```\n\n### Update Quality Checklist\nAdd:\n- [ ] Confidence scores reflect actual uncertainty\n- [ ] Low confidence areas (\u003c0.70) explained in areas_of_uncertainty\n- [ ] Overall confidence is weighted average of components\n\n## Files\n- .claude/agents/pipeline-architect.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:21:20.336592-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:21:20.336592-06:00","labels":["loop/confidence-scoring"],"dependencies":[{"issue_id":"loop-agents-di8","depends_on_id":"loop-agents-xm5","type":"blocks","created_at":"2026-01-12T03:21:24.997897-06:00","created_by":"daemon"}]}
{"id":"loop-agents-dl6","title":"Source inherit.sh in engine.sh","description":"Add source statement for inherit.sh in engine.sh library loading section.\n\n**Location:** scripts/engine.sh around line 10-20 where other libs are sourced\n\n**Change:**\nsource \"$SCRIPT_DIR/lib/inherit.sh\"\n\n**Acceptance criteria:**\n- [ ] inherit.sh sourced in engine.sh\n- [ ] Source statement follows existing pattern\n- [ ] Placed near other lib sources","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T02:02:55.821901-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T02:02:55.821901-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-dl6","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T02:03:05.618592-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-dnc","title":"Support single-loop visualization","description":"Handle ./scripts/run.sh viz work (single loop, not pipeline). Show single box with loop metadata:\n\n```\n┌─────────────────┐\n│      work       │\n│   fixed iters   │\n│   ~80k tokens   │\n└─────────────────┘\nTermination: fixed (N iterations)\n```\n\nInclude termination strategy explanation below the box.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:41.292439-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.792233-06:00","closed_at":"2026-01-12T03:41:03.792233-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-dnc","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:20.222426-06:00","created_by":"daemon"},{"issue_id":"loop-agents-dnc","depends_on_id":"loop-agents-lum","type":"blocks","created_at":"2026-01-12T03:21:36.335198-06:00","created_by":"daemon"}]}
{"id":"loop-agents-doz","title":"TDD: Phase 5b - Mock Infrastructure for Parallel Providers","description":"Complete TDD cycle for mock infrastructure supporting parallel providers.\n\n## Step 1: Write Failing Tests\nFile: scripts/tests/test_mock.sh (add to existing file)\n\n### Unit Tests to Write\n\n- test_mock_provider_specific_response\n  Setup: fixtures/claude/iteration-001.txt = 'claude response'\n         fixtures/codex/iteration-001.txt = 'codex response'\n  Expected: get_mock_response_for_provider 1 'claude' returns 'claude response'\n  Expected: get_mock_response_for_provider 1 'codex' returns 'codex response'\n\n- test_mock_provider_fallback_to_shared\n  Setup: fixtures/iteration-001.txt = 'shared response' (no per-provider files)\n  Expected: get_mock_response_for_provider 1 'claude' returns 'shared response'\n  Expected: get_mock_response_for_provider 1 'codex' returns 'shared response'\n\n- test_mock_provider_delay\n  Setup: MOCK_DELAY_CODEX=2, MOCK_DELAY=0\n  Expected: get_mock_provider_delay 'claude' returns 0\n  Expected: get_mock_provider_delay 'codex' returns 2\n\n- test_mock_provider_status\n  Setup: fixtures/claude/status-001.json with claude-specific decision\n  Expected: get_mock_status_for_provider returns provider-specific status\n\n## Step 2: Verify Tests Fail\nRun: ./scripts/tests/test_mock.sh\nAll new tests MUST fail initially.\n\n## Step 3: Implement Feature\nFile: scripts/lib/mock.sh\n\nAdd functions:\n- get_mock_response_for_provider($iteration, $provider)\n  Lookup order: $MOCK_FIXTURES_DIR/$provider/iteration-NNN.txt\n                $MOCK_FIXTURES_DIR/iteration-NNN.txt (fallback)\n                $MOCK_FIXTURES_DIR/$provider/default.txt\n                $MOCK_FIXTURES_DIR/default.txt\n\n- get_mock_status_for_provider($iteration, $provider)\n  Same lookup order for status-NNN.json\n\n- get_mock_provider_delay($provider)\n  Reads MOCK_DELAY_$PROVIDER or MOCK_DELAY (default)\n\n- write_mock_status_for_provider($iter_dir, $iteration, $provider)\n  Writes to $iter_dir/$provider/status.json\n\n## Step 4: Verify Tests Pass\nRun: ./scripts/tests/run_tests.sh\n\n## Step 5: Commit\ngit commit -m 'feat: mock infrastructure for parallel providers\n\n- Add per-provider mock response lookup\n- Add fallback to shared fixtures\n- Add per-provider delay configuration\n- Add write_mock_status_for_provider helper'\n\n## Acceptance Criteria\n- [ ] 4 new unit tests in test_mock.sh\n- [ ] Tests fail initially\n- [ ] get_mock_response_for_provider() implemented\n- [ ] get_mock_status_for_provider() implemented\n- [ ] get_mock_provider_delay() implemented\n- [ ] All existing mock tests still pass\n- [ ] Changes committed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T21:29:18.571446-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.805970296+01:00","closed_at":"2026-01-14T17:06:31.906052-06:00","labels":["pipeline/parallel-providers"],"dependencies":[{"issue_id":"loop-agents-doz","depends_on_id":"loop-agents-5mi","type":"blocks","created_at":"2026-01-12T21:30:59.774603-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-drm","title":"Add from_initial to context.sh build_inputs_json()","description":"Load initial-inputs.json if exists, add to inputs object as from_initial array","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T01:31:11.643583-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:33:33.451654-06:00","closed_at":"2026-01-13T01:33:33.451654-06:00","close_reason":"Added from_initial to build_inputs_json() in context.sh","labels":["feature/initial-inputs"],"dependencies":[{"issue_id":"loop-agents-drm","depends_on_id":"loop-agents-wy5","type":"blocks","created_at":"2026-01-13T01:31:40.48585-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-dsm","title":"Update CLAUDE.md with viz command documentation","description":"Add viz command to CLAUDE.md documentation:\n- Add to Commands section with usage examples\n- Add to Debugging section as useful for understanding pipelines\n- Include sample output showing ASCII visualization","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:21:04.312964-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.781255-06:00","closed_at":"2026-01-12T03:41:03.781255-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-dsm","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:23.011413-06:00","created_by":"daemon"},{"issue_id":"loop-agents-dsm","depends_on_id":"loop-agents-8eg","type":"blocks","created_at":"2026-01-12T03:21:38.854363-06:00","created_by":"daemon"}]}
{"id":"loop-agents-dtl","title":"Create scripts/lib/inherit.sh with load_inherited_context()","description":"Implement the core inheritance library with the load_inherited_context function as specified in the plan.\n\n**Key features:**\n- Loads learnings/patterns/warnings/decisions from source session status.json files\n- Extracts progress summary from progress*.md\n- Validates source session exists and state.json is valid\n- Warns but continues for non-complete sessions\n\n**Acceptance criteria:**\n- [ ] Function takes source_session, select_options, max_chars, visited_sessions, depth\n- [ ] Returns JSON with version, from_session, from_completed_at, learnings, patterns, warnings, decisions, progress_summary\n- [ ] Exit code 0 on success (including graceful degradation)\n- [ ] Exit code 1 for fatal errors\n- [ ] Exit code 2 for warnings\n- [ ] Handles missing/malformed status.json gracefully","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:47:14.902862-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:47:14.902862-06:00","labels":["pipeline/session-inherit"]}
{"id":"loop-agents-dzo","title":"Test fresh install on clean machine","description":"Clone repo to fresh env, install deps, verify ./scripts/run.sh work test 3 succeeds","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T03:44:30.856472-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:44:30.856472-06:00","labels":["loop/deploy"],"dependencies":[{"issue_id":"loop-agents-dzo","depends_on_id":"loop-agents-9eu","type":"blocks","created_at":"2026-01-12T03:44:36.751356-06:00","created_by":"daemon"},{"issue_id":"loop-agents-dzo","depends_on_id":"loop-agents-kyn","type":"blocks","created_at":"2026-01-12T03:44:36.773518-06:00","created_by":"daemon"},{"issue_id":"loop-agents-dzo","depends_on_id":"loop-agents-enn","type":"blocks","created_at":"2026-01-12T03:44:36.794488-06:00","created_by":"daemon"},{"issue_id":"loop-agents-dzo","depends_on_id":"loop-agents-82i","type":"blocks","created_at":"2026-01-12T03:44:36.816807-06:00","created_by":"daemon"}]}
{"id":"loop-agents-dzt","title":"Bug 24: test-planner uses incorrect --label= syntax","description":"Wrong bd CLI flag syntax. Fix: Use correct syntax.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:47:38.019617-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:25:40.594221-06:00","closed_at":"2026-01-12T23:25:40.594221-06:00","close_reason":"Fixed in bug fixing session","labels":["bugs/engine-stability"]}
{"id":"loop-agents-e1j","title":"Surface comprehension warnings in status command output","description":"Show comprehension validation warnings when checking session status.\n\n**Implementation:**\n- Check for validation.json files in iteration dirs\n- Display warnings about missing comprehension in status output\n\n**Acceptance criteria:**\n- [ ] ./scripts/run.sh status my-session shows comprehension warnings\n- [ ] Only shows if comprehension: required was set\n- [ ] Clear message about which iterations had missing acknowledgment","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:52:13.891443-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:52:13.891443-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-e1j","depends_on_id":"loop-agents-r7s","type":"blocks","created_at":"2026-01-13T01:55:20.744328-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-edc","title":"Create scripts/lib/paths.sh for deterministic artifact paths","description":"Create the paths module for deterministic artifact placement:\n\nDirectory structure:\n.claude/pipeline-runs/{session}/\n├── plan.json\n├── state.json\n├── events.jsonl\n├── artifacts/\n│   ├── node-{node_path}/\n│   │   ├── run-0001/\n│   │   │   ├── iteration-0001/\n│   │   │   │   ├── ctx.json\n│   │   │   │   ├── progress.md\n│   │   │   │   ├── result.json\n│   │   │   │   └── worker.log\n│   │   │   └── output.json\n└── locks/\n    └── session.lock\n\nFunctions:\n- get_session_dir(session)\n- get_node_dir(session, node_path)\n- get_run_dir(session, node_path, run)\n- get_iteration_dir(session, node_path, run, iteration)\n- ensure_dir(path) - Create directory if it doesn't exist\n\nAll functions should work regardless of whether directories exist (callers create as needed).","acceptance_criteria":"- [ ] paths.sh created with path helper functions\n- [ ] Node path provides stable artifact placement\n- [ ] Run index correctly formatted (0001, 0002, etc.)\n- [ ] Iteration index correctly formatted\n- [ ] All paths deterministic and reproducible\n- [ ] Functions work whether directory exists or not\n- [ ] ensure_dir() helper for directory creation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:44:53.571874-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T06:56:42.970068381+01:00","closed_at":"2026-01-15T06:56:42.970068381+01:00","close_reason":"Closed","labels":["phase/2-node-executor","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-edc","depends_on_id":"loop-agents-cim","type":"blocks","created_at":"2026-01-14T02:50:27.20034-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-efr","title":"Add confidence-based UX guidance to build.md","description":"Add logic to build.md workflow that adapts user interaction based on confidence levels.\n\n## Confidence-Adaptive Confirmation Flow\n\n### High Confidence (\u003e=90%)\nStandard confirmation:\n```json\n{\n  \"questions\": [{\n    \"question\": \"Does this architecture look right?\",\n    \"header\": \"Confirm\",\n    \"options\": [\n      {\"label\": \"Yes, build it\", \"description\": \"Proceed to create the pipeline\"},\n      {\"label\": \"No, let's adjust\", \"description\": \"I have changes to make\"}\n    ]\n  }]\n}\n```\n\n### Moderate Confidence (70-89%)\nSurface uncertainties before confirmation:\n```markdown\n**Note:** I'm {X}% confident in this architecture. \n\nKey uncertainties:\n- {uncertainty 1}\n- {uncertainty 2}\n\nWould you like to discuss these before proceeding?\n```\n\n### Low Confidence (\u003c70%)\nProactive discussion:\n```markdown\n**Important:** I'm only {X}% confident in this architecture.\n\nThe main uncertainties are:\n- {uncertainty 1} (confidence: {score}%)\n- {uncertainty 2} (confidence: {score}%)\n\nI recommend we discuss these areas before proceeding. What are your thoughts on [lowest confidence dimension]?\n```\n\n## Implementation\n1. Add confidence threshold constants\n2. Add branching logic after architect output\n3. Add targeted questions for low-confidence dimensions\n4. Update Success Criteria with confidence handling\n\n## Files\n- skills/pipeline-designer/workflows/build.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:30.865023-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:30.865023-06:00","labels":["loop/confidence-scoring"],"dependencies":[{"issue_id":"loop-agents-efr","depends_on_id":"loop-agents-9r8","type":"blocks","created_at":"2026-01-12T03:20:35.218929-06:00","created_by":"daemon"}]}
{"id":"loop-agents-egi","title":"Create viz.sh library with pipeline YAML parser","description":"Create scripts/lib/viz.sh that parses pipeline YAML files and extracts: stage names, loop references, iteration counts (runs field), and input dependencies (inputs.from). Uses existing yaml.sh for YAML-to-JSON conversion.\n\nOutput: Array of stage objects with {name, loop, runs, inputs_from} for each stage.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:07.158745-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.803201-06:00","closed_at":"2026-01-12T03:41:03.803201-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-egi","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:15.9032-06:00","created_by":"daemon"},{"issue_id":"loop-agents-egi","depends_on_id":"loop-agents-gqe","type":"blocks","created_at":"2026-01-12T03:21:32.955326-06:00","created_by":"daemon"}]}
{"id":"loop-agents-eju","title":"Stage Catalog with Live Preview","description":"Build a stage catalog accessible via /pipeline catalog with interactive listing, rich metadata, example outputs, and recommendation tags for both humans and agent architecture selection.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-12T03:19:51.351067-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:19:51.351067-06:00","labels":["loop/stage-catalog"]}
{"id":"loop-agents-eju.1","title":"Design stage metadata schema with catalog fields","description":"Define the extended loop.yaml schema that includes:\n- description (existing)\n- use_case: when to use this stage\n- tags: recommendation tags (good-for-planning, high-quality, fast, etc)\n- model: recommended model (opus/sonnet/haiku)\n- example_output_path: path to example iteration output\n- typical_iterations: expected range\n\nCreate schema docs in skills/pipeline-designer/references/stage-schema.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:19:59.133667-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:19:59.133667-06:00","labels":["loop/stage-catalog"],"dependencies":[{"issue_id":"loop-agents-eju.1","depends_on_id":"loop-agents-eju","type":"parent-child","created_at":"2026-01-12T03:19:59.13662-06:00","created_by":"daemon"}]}
{"id":"loop-agents-eju.2","title":"Add catalog metadata to existing stage loop.yaml files","description":"Update all existing stages in scripts/loops/ with the new catalog fields:\n- work/loop.yaml\n- improve-plan/loop.yaml\n- refine-beads/loop.yaml\n- elegance/loop.yaml\n- idea-wizard/loop.yaml\n- research-plan/loop.yaml\n\nAdd appropriate use_case, tags, model recommendation, and typical_iterations to each.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:06.027664-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:06.027664-06:00","labels":["loop/stage-catalog"],"dependencies":[{"issue_id":"loop-agents-eju.2","depends_on_id":"loop-agents-eju","type":"parent-child","created_at":"2026-01-12T03:20:06.030279-06:00","created_by":"daemon"},{"issue_id":"loop-agents-eju.2","depends_on_id":"loop-agents-eju.1","type":"blocks","created_at":"2026-01-12T03:20:06.036124-06:00","created_by":"daemon"}]}
{"id":"loop-agents-eju.3","title":"Create scripts/lib/catalog.sh for stage discovery and metadata parsing","description":"Implement shell library functions:\n- list_stages(): discover all stages in scripts/loops/\n- parse_stage_metadata(stage): extract metadata from loop.yaml\n- get_stage_by_tag(tag): filter stages by recommendation tag\n- get_stage_by_termination(type): filter by termination type\n- format_stage_summary(stage): render human-readable summary\n\nUse yaml.sh for YAML parsing. Output JSON for agent consumption.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:11.857948-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:11.857948-06:00","labels":["loop/stage-catalog"],"dependencies":[{"issue_id":"loop-agents-eju.3","depends_on_id":"loop-agents-eju","type":"parent-child","created_at":"2026-01-12T03:20:11.860514-06:00","created_by":"daemon"},{"issue_id":"loop-agents-eju.3","depends_on_id":"loop-agents-eju.1","type":"blocks","created_at":"2026-01-12T03:20:11.861795-06:00","created_by":"daemon"}]}
{"id":"loop-agents-eju.4","title":"Capture and store example iteration outputs for each stage","description":"Create scripts/loops/{stage}/examples/ directory for each stage containing:\n- example-output.md: A representative iteration output\n- example-status.json: The status.json written by that iteration\n\nUse real outputs from pipeline-runs/ where available, or create synthetic examples that demonstrate typical agent behavior for that stage type.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:17.310567-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:17.310567-06:00","labels":["loop/stage-catalog"],"dependencies":[{"issue_id":"loop-agents-eju.4","depends_on_id":"loop-agents-eju","type":"parent-child","created_at":"2026-01-12T03:20:17.311466-06:00","created_by":"daemon"},{"issue_id":"loop-agents-eju.4","depends_on_id":"loop-agents-eju.3","type":"blocks","created_at":"2026-01-12T03:20:17.315663-06:00","created_by":"daemon"}]}
{"id":"loop-agents-eju.5","title":"Add 'catalog' subcommand to /pipeline command routing","description":"Update commands/pipeline.md to add catalog routing:\n- /pipeline catalog → show all stages\n- /pipeline catalog --tag=X → filter by tag\n- /pipeline catalog --termination=X → filter by termination type\n- /pipeline catalog [stage-name] → show detailed stage info with example\n\nAdd to routing table and update examples in the command doc.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:23.596576-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:23.596576-06:00","labels":["loop/stage-catalog"],"dependencies":[{"issue_id":"loop-agents-eju.5","depends_on_id":"loop-agents-eju","type":"parent-child","created_at":"2026-01-12T03:20:23.599286-06:00","created_by":"daemon"},{"issue_id":"loop-agents-eju.5","depends_on_id":"loop-agents-eju.3","type":"blocks","created_at":"2026-01-12T03:20:23.600698-06:00","created_by":"daemon"}]}
{"id":"loop-agents-eju.6","title":"Create catalog skill workflow for interactive stage browsing","description":"Create skills/pipeline-designer/workflows/catalog.md with:\n- Interactive AskUserQuestion for browsing stages\n- Rich rendering with headers, tables, descriptions\n- Tag filtering via multiSelect\n- Termination type filtering\n- Drill-down to show example output\n- Natural language queries ('Show me stages that use judgment termination')\n\nIntegrate with pipeline-designer skill routing.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:29.749929-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:29.749929-06:00","labels":["loop/stage-catalog"],"dependencies":[{"issue_id":"loop-agents-eju.6","depends_on_id":"loop-agents-eju","type":"parent-child","created_at":"2026-01-12T03:20:29.752817-06:00","created_by":"daemon"},{"issue_id":"loop-agents-eju.6","depends_on_id":"loop-agents-eju.5","type":"blocks","created_at":"2026-01-12T03:20:29.754482-06:00","created_by":"daemon"}]}
{"id":"loop-agents-eju.7","title":"Create machine-readable catalog reference for architecture agent","description":"Create .claude/agents/catalog.json auto-generated file that:\n- Lists all stages with full metadata\n- Includes recommendation tags\n- Maps use cases to stage names\n- Contains example input/output snippets\n\nUsed by pipeline-architect subagent for intelligent stage selection.\nAdd generation script to scripts/lib/catalog.sh.\nDocument in skills/pipeline-designer/references/catalog-for-agents.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:35.770733-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:35.770733-06:00","labels":["loop/stage-catalog"],"dependencies":[{"issue_id":"loop-agents-eju.7","depends_on_id":"loop-agents-eju","type":"parent-child","created_at":"2026-01-12T03:20:35.771331-06:00","created_by":"daemon"},{"issue_id":"loop-agents-eju.7","depends_on_id":"loop-agents-eju.6","type":"blocks","created_at":"2026-01-12T03:20:35.772489-06:00","created_by":"daemon"}]}
{"id":"loop-agents-eju.8","title":"Update CLAUDE.md with stage catalog documentation","description":"Add to CLAUDE.md:\n- New /pipeline catalog command in commands table\n- Stage metadata schema in 'Creating a New Stage' section\n- Reference to catalog.json for architecture agents\n- Example workflow: 'Show me stages good for planning'","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:40.85423-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:40.85423-06:00","labels":["loop/stage-catalog"],"dependencies":[{"issue_id":"loop-agents-eju.8","depends_on_id":"loop-agents-eju","type":"parent-child","created_at":"2026-01-12T03:20:40.85632-06:00","created_by":"daemon"},{"issue_id":"loop-agents-eju.8","depends_on_id":"loop-agents-eju.7","type":"blocks","created_at":"2026-01-12T03:20:40.857733-06:00","created_by":"daemon"}]}
{"id":"loop-agents-eju.9","title":"Add catalog field validation to scripts/lib/validate.sh","description":"Extend validate.sh to check catalog fields in loop.yaml:\n- tags must be from allowed set\n- model must be opus/sonnet/haiku if specified\n- use_case should be non-empty string\n- example_output_path must exist if specified\n- typical_iterations should be valid range format\n\nAdd to lint command: ./scripts/run.sh lint loop {name}","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:46.634497-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:46.634497-06:00","labels":["loop/stage-catalog"],"dependencies":[{"issue_id":"loop-agents-eju.9","depends_on_id":"loop-agents-eju","type":"parent-child","created_at":"2026-01-12T03:20:46.63813-06:00","created_by":"daemon"},{"issue_id":"loop-agents-eju.9","depends_on_id":"loop-agents-eju.3","type":"blocks","created_at":"2026-01-12T03:20:46.639932-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ek2","title":"TDD: Phase 4 - Context.json Extension for Parallel","description":"Complete TDD cycle for context.json extension with parallel provider support.\n\n## Step 1: Write Failing Tests\nFile: scripts/tests/test_context.sh (add to existing file)\n\n### Unit Tests to Write\n\n4.1 Parallel Provider Inputs:\n- test_context_providers_in_inputs\n  After parallel iteration, read context.json for next iteration\n  Expected: inputs.providers object exists\n\n- test_context_providers_has_output_paths\n  Expected: inputs.providers.claude.output = '/path/to/claude/output.md'\n  Expected: inputs.providers.codex.output = '/path/to/codex/output.md'\n\n- test_context_providers_has_status_paths\n  Expected: inputs.providers.claude.status = '/path/to/claude/status.json'\n  Expected: inputs.providers.codex.status = '/path/to/codex/status.json'\n\n4.2 Tracks Inputs:\n- test_context_tracks_in_inputs\n  After tracks stage completes, context for next stage\n  Expected: inputs.tracks object exists\n\n- test_context_tracks_has_final_output\n  Expected: inputs.tracks.claude.output = path to final iteration output\n\n- test_context_tracks_has_iteration_count\n  Expected: inputs.tracks.claude.iterations_completed = 3\n\n- test_context_tracks_has_termination_reason\n  Expected: inputs.tracks.claude.termination_reason = 'plateau' or 'max_iterations'\n\n4.3 Provider Visibility (Additional):\n- test_context_iteration_2_sees_iteration_1_all_providers\n  After iteration 1 completes with [claude, codex]\n  Expected: Iteration 2 context has paths to BOTH outputs from iter 1\n\n## Step 2: Verify Tests Fail\nRun: ./scripts/tests/test_context.sh\nAll new tests MUST fail initially.\n\n## Step 3: Implement Feature\nFile: scripts/lib/context.sh\n\n- Add generate_parallel_inputs() function\n- Add inputs.providers to context.json with output/status paths\n- Add generate_tracks_inputs() function\n- Add inputs.tracks with final output, iteration count, termination reason\n- Update generate_context() to call appropriate function based on config\n\n## Step 4: Verify Tests Pass\nRun: ./scripts/tests/run_tests.sh\n\n## Step 5: Commit\ngit commit -m 'feat: extend context.json for parallel providers\n\n- Add inputs.providers with output/status paths per provider\n- Add inputs.tracks with final output and metadata\n- Include iteration counts and termination reasons for tracks'\n\n## Acceptance Criteria\n- [ ] 8 new unit tests in test_context.sh\n- [ ] Tests fail initially\n- [ ] generate_parallel_inputs() implemented\n- [ ] generate_tracks_inputs() implemented\n- [ ] All existing context tests still pass\n- [ ] Changes committed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T21:28:09.1048-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.830452015+01:00","closed_at":"2026-01-14T17:06:31.897169-06:00","labels":["pipeline/parallel-providers"],"dependencies":[{"issue_id":"loop-agents-ek2","depends_on_id":"loop-agents-gw3","type":"blocks","created_at":"2026-01-12T21:30:54.609919-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-enn","title":"Add .pluginignore to exclude tests and docs from distribution","description":"Exclude scripts/tests/, docs/ideas*.md, docs/plans/, tdd-prose-plan.md","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T03:44:30.797478-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:44:30.797478-06:00","labels":["loop/deploy"]}
{"id":"loop-agents-f1v","title":"Create scripts/review directory structure","description":"Create directory structure:\nscripts/review/\n├── review-loop.sh\n├── review-once.sh\n├── aggregate-findings.sh\n├── prompts/ (7 prompt files)\n├── findings/\n└── README.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:52:13.36954-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:40.052296-06:00","closed_at":"2026-01-09T14:13:40.052296-06:00","close_reason":"Completed via loop-engine refactor","labels":["loop/review"]}
{"id":"loop-agents-frt","title":"Bug 12: idea-wizard missing iterations field","description":"Fixed termination type but no iterations field. Fix: Add field.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-12T22:48:29.933079-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:29:01.300614-06:00","closed_at":"2026-01-12T23:29:01.300614-06:00","close_reason":"Fixed: Added iterations: 3 field to idea-wizard stage.yaml","labels":["bugs/engine-stability"]}
{"id":"loop-agents-fvk","title":"Implement horizontal flow layout with arrows","description":"Create render_pipeline_flow() that arranges stage boxes horizontally with connecting arrows:\n\n```\n┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n│  improve-plan   │────▶│  refine-beads   │────▶│    elegance     │\n│  5 iters, opus  │     │  5 iters, opus  │     │  3 iters, opus  │\n└─────────────────┘     └─────────────────┘     └─────────────────┘\n```\n\nArrows should be ────▶ between boxes. Handle terminal width gracefully - consider wrapping for very long pipelines.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:27.712937-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.794961-06:00","closed_at":"2026-01-12T03:41:03.794961-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-fvk","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:18.093013-06:00","created_by":"daemon"},{"issue_id":"loop-agents-fvk","depends_on_id":"loop-agents-lum","type":"blocks","created_at":"2026-01-12T03:21:34.812485-06:00","created_by":"daemon"}]}
{"id":"loop-agents-gqe","title":"Add viz command skeleton to run.sh","description":"Add 'viz' case to run.sh that accepts a pipeline name or loop name as argument. Should validate the target exists and call a new viz.sh library function. Handle both pipeline YAML files and single-stage loop directories.\n\nAcceptance: ./scripts/run.sh viz full-refine shows 'Not implemented' message without error","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:01.450692-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.805483-06:00","closed_at":"2026-01-12T03:41:03.805483-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-gqe","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:15.181977-06:00","created_by":"daemon"}]}
{"id":"loop-agents-gw3","title":"TDD: Phase 3 - Parallel Provider Directory Structure","description":"Complete TDD cycle for parallel provider directory structure.\n\n## Step 1: Write Failing Tests\nFile: scripts/tests/test_context.sh (add to existing file)\n\n### Unit Tests to Write\n\n3.1 Parallel Provider Directories:\n- test_parallel_creates_provider_subdirs\n  Run parallel iteration with providers: [claude, codex]\n  Expected: iterations/001/claude/, iterations/001/codex/ exist\n\n- test_parallel_provider_dirs_contain_output\n  Expected: iterations/001/claude/output.md, iterations/001/codex/output.md exist\n\n- test_parallel_provider_dirs_contain_status\n  Expected: iterations/001/claude/status.json, iterations/001/codex/status.json exist\n\n3.2 Tracks Directory Structure:\n- test_tracks_creates_tracks_directory\n  Expected: stage-*/tracks/ directory exists\n\n- test_tracks_creates_provider_subdirs\n  Expected: tracks/claude/, tracks/codex/ directories exist\n\n- test_tracks_each_has_own_state\n  Expected: tracks/claude/state.json, tracks/codex/state.json exist\n\n- test_tracks_each_has_own_iterations\n  Expected: tracks/claude/iterations/001/, tracks/codex/iterations/001/ exist\n\n## Step 2: Verify Tests Fail\nRun: ./scripts/tests/test_context.sh\nAll new tests MUST fail initially.\n\n## Step 3: Implement Feature\nFile: scripts/engine.sh\n\n- Modify run_stage() to detect providers array\n- Create provider subdirectories in iteration dirs\n- Create tracks directory structure when tracks config detected\n- Each track gets own state.json and iterations directory\n\n## Step 4: Verify Tests Pass\nRun: ./scripts/tests/run_tests.sh\n\n## Step 5: Commit\ngit commit -m 'feat: parallel provider directory structure\n\n- Create provider subdirs in iterations (iterations/001/claude/)\n- Create tracks directory structure (tracks/provider/iterations/)\n- Each track has isolated state and iteration dirs'\n\n## Acceptance Criteria\n- [ ] 7 new unit tests in test_context.sh\n- [ ] Tests fail initially\n- [ ] Provider subdirectory creation implemented\n- [ ] Tracks directory structure implemented\n- [ ] All existing tests still pass\n- [ ] Changes committed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T21:27:46.328228-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.842630458+01:00","closed_at":"2026-01-14T17:06:31.89196-06:00","labels":["pipeline/parallel-providers"],"dependencies":[{"issue_id":"loop-agents-gw3","depends_on_id":"loop-agents-5mi","type":"blocks","created_at":"2026-01-12T21:30:49.451938-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-hks","title":"Implement refine-once.sh single iteration runner","description":"Create refine-once.sh that:\n1. Takes MODE (beads/plan), SESSION_NAME, PLAN_FILE args\n2. Selects appropriate prompt file\n3. Substitutes variables into prompt\n4. Pipes to claude --model opus --dangerously-skip-permissions\n5. Outputs include CHANGES: N for parsing","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:51:50.468288-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:45.481117-06:00","closed_at":"2026-01-09T14:13:45.481117-06:00","close_reason":"Not needed - loop-engine handles iteration","labels":["loop/refine"],"dependencies":[{"issue_id":"loop-agents-hks","depends_on_id":"loop-agents-od6","type":"blocks","created_at":"2026-01-09T13:52:32.132627-06:00","created_by":"daemon"}]}
{"id":"loop-agents-hsv","title":"Work prompt bloat - refactor to original ralph loop simplicity","description":"The work stage prompt (scripts/stages/work/prompt.md) has become too long and polluted from the original ralph loop design. Needs cleanup and refactoring.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T22:09:02.383815-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:09:02.383815-06:00","labels":["bugs/engine"]}
{"id":"loop-agents-i6f","title":"Eliminate subshell pipeline bugs in core modules","description":"Eliminate patterns that cause subshell variable loss:\n\nBAD: ... | while read ...; do ...; done\nGOOD: while read ...; do ...; done \u003c \u003c(command)\n\n**Files to audit:**\n- scripts/lib/hooks.sh\n- scripts/lib/yaml.sh (stage discovery)\n- scripts/lib/resolve.sh\n- scripts/lib/compile.sh\n- scripts/lib/library.sh (when created)\n- scripts/engine.sh\n\nThis is a shell reliability fix required before building the event engine.","acceptance_criteria":"- [ ] Audit complete for all listed files\n- [ ] No 'cmd | while read' patterns in core modules\n- [ ] All converted to process substitution\n- [ ] Variables not lost in loops\n- [ ] All existing tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:48:57.153271-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T09:58:48.82534863+01:00","closed_at":"2026-01-15T09:58:48.82534863+01:00","close_reason":"Closed","labels":["phase/0-foundation","phase/1-foundation","pipeline/v3","pipeline/v3-event-spine"]}
{"id":"loop-agents-ijp","title":"Add lineage command to trace inheritance chain","description":"Add command to view the full inheritance chain for a session.\n\n**Usage:**\n./scripts/run.sh lineage my-session\n\n**Output:**\nmy-session (current)\n  ← auth-v2 (2026-01-12)\n    ← auth-v1 (2026-01-10)\n\n**Acceptance criteria:**\n- [ ] Command shows full chain from current to oldest ancestor\n- [ ] Shows completion dates for each ancestor\n- [ ] Handles sessions without inheritance (shows 'no parent')","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:52:43.893394-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:52:43.893394-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-ijp","depends_on_id":"loop-agents-cxe","type":"blocks","created_at":"2026-01-13T01:55:45.889994-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-ipa","title":"Implement spawn action that reuses node executor","description":"Implement the spawn action type that reuses the unified node executor:\n\nSpawn is a thin wrapper over run_node() for launching child pipelines:\n\n- type: spawn\n  pipeline: code-review\n  await: true\n  when: '.cursor.iteration % 10 == 0 and .node.id == \"fix\"'\n\nChild artifact placement:\nartifacts/node-{parent_path}/run-{N}/spawned/{action_id}/\n└── (child session files using standard paths.sh layout)\n\nParent cursor isolation:\n- spawn() saves parent cursor before invoking child\n- child runs with its own cursor namespace (prefixed with 'spawn-{action_id}')\n- spawn() restores parent cursor after child completes/fails\n- No shared state between parent and child except events.jsonl\n\nThe spawn action uses the same executor primitive as the main runtime.","acceptance_criteria":"- [ ] Spawn action implemented in hooks.sh\n- [ ] Uses run_node() from runtime.sh\n- [ ] await: true blocks until child completes\n- [ ] await: false runs child in background (via nohup)\n- [ ] Child artifacts placed in spawned/{action_id}/ directory\n- [ ] Parent cursor saved before spawn, restored after\n- [ ] Child events prefixed with spawn scope\n- [ ] spawn_start and spawn_complete events emitted","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-14T02:47:04.475334-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.866605964+01:00","labels":["phase/4-hooks","phase/7-hooks","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-ipa","depends_on_id":"loop-agents-p4i","type":"blocks","created_at":"2026-01-14T02:51:21.238143-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-ipa","depends_on_id":"loop-agents-2c4","type":"blocks","created_at":"2026-01-14T02:51:26.411654-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-iup","title":"Create scripts/lib/compile.sh for plan.json compilation","description":"Create the plan compilation module that transforms pipeline YAML into deterministic executable JSON:\n\nInputs:\n- Pipeline YAML (entrypoint)\n- Stage YAMLs referenced by pipeline\n- Global config (hooks, template roots)\n\nOutput: plan.json with:\n- version field\n- session metadata\n- dependencies block\n- hooks configuration\n- nodes array with path, id, kind, ref, termination, provider, inputs\n\nMust be idempotent: same inputs always produce identical output.\n\nHandle compilation errors with actionable messages.","acceptance_criteria":"- [ ] compile.sh created with compile_pipeline() function\n- [ ] Single-stage pipeline compiles correctly\n- [ ] Multi-stage pipeline compiles correctly\n- [ ] Nested pipeline references resolved\n- [ ] Stage defaults merged with node overrides\n- [ ] Compilation errors provide actionable messages\n- [ ] Idempotent: same input → identical output\n- [ ] test_compile.sh passes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:43:18.294349-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.879126565+01:00","closed_at":"2026-01-14T17:06:55.480748-06:00","labels":["phase/1-event-spine","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-iup","depends_on_id":"loop-agents-8od","type":"blocks","created_at":"2026-01-14T02:49:44.555618-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-jcl","title":"Add depth limit (max 3 levels) for recursive inheritance","description":"Limit recursive inheritance to prevent unbounded context growth.\n\n**Implementation:**\n- Track depth parameter (5th arg, default 0)\n- Stop recursion at max_depth=3\n- Return empty JSON {} when depth exceeded (non-fatal)\n\n**Acceptance criteria:**\n- [ ] A→B→C→D chain stops at C (3 levels)\n- [ ] Warning message to stderr when limit reached\n- [ ] Return code 0 (graceful degradation)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:49:09.535938-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:49:09.535938-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-jcl","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T01:54:19.111595-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-k93","title":"Add session lockfiles to prevent concurrent session conflicts","description":"## Problem\nStarting a loop with the same session name while one is already running leads to corrupted state files, race conditions, and unpredictable behavior. There's no guard against this.\n\n## Solution\nAdd lockfile management to engine.sh:\n- Create `.claude/locks/{session}.lock` on session start\n- Check for existing lock before starting\n- Store PID and timestamp in lock file\n- Detect stale locks (PID no longer running) and clean up\n- `--force` flag to override (with warning)\n\n## Implementation Notes\nThis is a ~20 line addition that prevents a class of catastrophic bugs. Should be added to `scripts/lib/` as a new module (e.g., `lock.sh`).\n\nKey functions:\n- `acquire_lock(session)` - Create lock, fail if exists and PID alive\n- `release_lock(session)` - Remove lock file\n- `is_locked(session)` - Check if session is locked\n- `cleanup_stale_locks()` - Remove locks for dead PIDs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T18:22:47.484616-06:00","created_by":"harrisonwells","updated_at":"2026-01-10T18:32:31.358112-06:00","closed_at":"2026-01-10T18:32:31.358112-06:00","close_reason":"Implemented session lockfiles with acquire_lock, release_lock, is_locked, and cleanup_stale_locks functions in scripts/lib/lock.sh. Integrated into engine.sh with --force flag support and automatic cleanup on exit via trap."}
{"id":"loop-agents-kfv","title":"Implement aggregate-findings.sh and aggregator prompt","description":"Create aggregation system:\n1. aggregate-findings.sh - orchestrates aggregation\n2. prompts/aggregator.md - dedup/prioritize prompt\n3. Reads all findings, deduplicates, prioritizes\n4. Outputs summary.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T13:52:24.771095-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T13:52:24.771095-06:00","labels":["loop/review"]}
{"id":"loop-agents-ky3","title":"TDD: Phase 5a - Parallel Provider Execution","description":"Complete TDD cycle for parallel provider execution.\n\n## Step 1: Write Failing Tests\nFile: scripts/tests/integration/test_parallel.sh (NEW FILE)\n\n### Create Test Infrastructure First\n- Create scripts/tests/fixtures/integration/parallel-2/ fixture directory\n- Add stage.yaml with providers: [claude, codex], termination: fixed 2\n- Add per-provider mock responses (claude/iteration-001.txt, codex/iteration-001.txt)\n\n### Unit Tests to Write\n\n5.1 Parallel Provider Execution:\n- test_parallel_spawns_all_providers\n  Run engine with providers: [claude, codex]\n  Expected: Both execute_agent calls made\n\n- test_parallel_waits_for_all\n  One provider fast, one slow (use MOCK_DELAY per provider)\n  Expected: Engine waits for both to complete\n\n- test_parallel_all_must_succeed\n  Configure one provider to fail (exit code 1)\n  Expected: Overall iteration fails\n\n- test_parallel_creates_all_outputs\n  Expected: Both provider output files exist with content\n\n5.2 Parallel Iteration Progression:\n- test_parallel_runs_n_iterations\n  Config: providers: [claude, codex], termination: {type: fixed, iterations: 3}\n  Expected: 3 iterations run, each with both provider outputs\n\n- test_parallel_state_tracks_iterations\n  Expected: state.json iteration_completed = 3\n\n5.3 Edge Cases:\n- test_parallel_single_provider_array\n  Config: providers: ['claude'] (array with one element)\n  Expected: Treated same as provider: 'claude' (no parallel overhead)\n\n- test_parallel_empty_providers_fails\n  Config: providers: []\n  Expected: Validation error 'no providers specified'\n\n- test_parallel_timing_independence\n  Configure MOCK_DELAY: claude=0s, codex=2s\n  Expected: Both outputs exist, engine waits for slower provider\n\n- test_parallel_invalid_status_from_one\n  Provider claude writes valid status.json, codex writes invalid JSON\n  Expected: Overall iteration fails with specific error\n\n## Step 2: Verify Tests Fail\nRun: ./scripts/tests/integration/test_parallel.sh\nAll tests MUST fail initially.\n\n## Step 3: Implement Feature\nFile: scripts/engine.sh\n\n- Add execute_parallel_providers() function\n- Spawn background job per provider\n- Wait for all providers (wait $pid)\n- Collect exit codes - ALL must succeed\n- Write per-provider outputs to isolated directories\n\n## Step 4: Verify Tests Pass\nRun: ./scripts/tests/run_tests.sh\n\n## Step 5: Commit\ngit commit -m 'feat: parallel provider execution\n\n- Add execute_parallel_providers() in engine.sh\n- Spawn background jobs per provider\n- Wait for all, fail if any fails\n- Write outputs to isolated provider directories'\n\n## Acceptance Criteria\n- [ ] New test file: integration/test_parallel.sh created\n- [ ] New fixtures: parallel-2/ with provider-specific responses\n- [ ] 10 integration tests written\n- [ ] Tests fail initially\n- [ ] execute_parallel_providers() implemented\n- [ ] All existing tests still pass\n- [ ] Changes committed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T21:28:45.352036-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.89013+01:00","closed_at":"2026-01-14T17:06:31.902308-06:00","labels":["pipeline/parallel-providers"],"dependencies":[{"issue_id":"loop-agents-ky3","depends_on_id":"loop-agents-ek2","type":"blocks","created_at":"2026-01-12T21:31:04.930632-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-ky3","depends_on_id":"loop-agents-doz","type":"blocks","created_at":"2026-01-12T21:31:10.090996-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-kyn","title":"Fix README: wrong brew tap for beads","description":"README says steveyegge/tap/bd but should be steveyegge/beads/bd","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T03:44:30.767486-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:44:30.767486-06:00","labels":["loop/deploy"]}
{"id":"loop-agents-kz0","title":"Bug 10: Wrong tmux prefix in sessions SKILL.md","description":"Uses ^loop- instead of ^pipeline-. Fix: Update documentation.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-12T22:48:19.691068-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:28:49.345018-06:00","closed_at":"2026-01-12T23:28:49.345018-06:00","close_reason":"Fixed: Updated grep pattern from ^loop- to ^pipeline- in sessions SKILL.md","labels":["bugs/engine-stability"]}
{"id":"loop-agents-lum","title":"Implement ASCII box rendering for stages","description":"Create render_stage_box() function that draws a single stage as ASCII box:\n\n```\n┌─────────────────┐\n│  improve-plan   │\n│  5 iters, opus  │\n│  ~50k tokens    │\n└─────────────────┘\n```\n\nHandle variable-width boxes based on content length. Use Unicode box-drawing characters. Support optional token estimate line (can be omitted if no data).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:20.413981-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.798283-06:00","closed_at":"2026-01-12T03:41:03.798283-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-lum","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:17.331792-06:00","created_by":"daemon"},{"issue_id":"loop-agents-lum","depends_on_id":"loop-agents-3os","type":"blocks","created_at":"2026-01-12T03:21:34.160568-06:00","created_by":"daemon"}]}
{"id":"loop-agents-max","title":"Pipeline Visualization Command (viz)","description":"Add ./scripts/run.sh viz {pipeline} command that generates ASCII art showing stage sequence, data flow, iteration counts, models, and estimated token usage. Bridges the gap between YAML configuration and human understanding of multi-stage pipelines.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-12T03:19:54.768179-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.808123-06:00","closed_at":"2026-01-12T03:41:03.808123-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"]}
{"id":"loop-agents-meg","title":"Create /refine command","description":"Create command that:\n- /refine - Auto-detect beads vs plan, run until plateau\n- /refine 10 - Run exactly 10 iterations\n- /refine beads - Force bead refinement mode\n- /refine plan.md - Refine specific plan file\nOffer foreground vs background mode.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T13:52:02.781547-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:02:11.893469-06:00","closed_at":"2026-01-12T22:02:11.893469-06:00","close_reason":"Commands exist in commands/ directory","labels":["loop/refine"]}
{"id":"loop-agents-mj4","title":"Add filter_secrets() function to strip sensitive data","description":"Implement filter_secrets() in inherit.sh to remove potential secrets from inherited content.\n\n**Pattern matching:**\n- Lines with secret-like keys (api_key, secret, token, password, etc.) followed by 20+ char alphanumeric values\n- Common prefixes: sk-, pk-, ghp_, gho_, xoxb-, xoxa-, AKIA\n\n**Acceptance criteria:**\n- [ ] Function reads stdin and outputs filtered content\n- [ ] Handles empty input gracefully (returns nothing, no error)\n- [ ] Uses 'grep -v' with '|| true' to handle no-match case\n- [ ] Preserves legitimate content that isn't secret-like\n- [ ] Documented design notes and known limitations","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:47:29.096577-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:47:29.096577-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-mj4","depends_on_id":"loop-agents-dtl","type":"blocks","created_at":"2026-01-13T01:54:08.851531-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-mpn","title":"Verify all references updated: grep for loop-agents, loop/, CLAUDE_LOOP","description":"Final verification that no stale references remain","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T03:46:05.36325-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:01:55.044807-06:00","closed_at":"2026-01-12T22:01:55.044807-06:00","close_reason":"Verified complete - rename is done in codebase","labels":["rename"]}
{"id":"loop-agents-n9q","title":"Add 'library' CLI command","description":"Add the 'library' command to run.sh:\n\nCommands (strictly local, no remote):\n- library list - list all templates from all sources\n- library info \u003cname\u003e - show template details\n- library fork \u003cname\u003e \u003cnew_name\u003e - copy to user config\n\nFork semantics:\n1. Copy all files to ~/.config/agent-pipelines/stages/\u003cnew_name\u003e/\n2. Update 'name' field in stage.yaml\n3. Add forked_from metadata\n4. If custom prompt path, copy and update\n5. Run lint after fork to validate\n\nNo remote import, create-from-prompt, or contribute flow.","acceptance_criteria":"- [ ] library list works\n- [ ] library info works\n- [ ] library fork creates valid copy\n- [ ] forked_from metadata added\n- [ ] lint runs after fork\n- [ ] Help text accurate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-14T02:47:42.362018-06:00","created_by":"harrisonwells","updated_at":"2026-01-14T02:47:42.362018-06:00","labels":["phase/5-library","phase/8-library","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-n9q","depends_on_id":"loop-agents-630","type":"blocks","created_at":"2026-01-14T02:51:43.953468-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-njc","title":"Bug 11: readme-sync comment contradicts configuration","description":"Comment says 2-3 iterations, config says 1. Fix: Align.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-12T22:48:24.844317-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:28:55.533343-06:00","closed_at":"2026-01-12T23:28:55.533343-06:00","close_reason":"Fixed: Updated comment to match iterations: 1 config in readme-sync stage.yaml","labels":["bugs/engine-stability"]}
{"id":"loop-agents-nsj","title":"Implement refine-loop.sh with plateau detection","description":"Create refine-loop.sh that:\n1. Takes MODE, MAX_ITERATIONS, SESSION_NAME, PLAN_FILE args\n2. Loops calling refine-once.sh\n3. Parses CHANGES output from each iteration\n4. Implements plateau detection (2+ rounds with ≤1 change)\n5. Records completion status\n6. Desktop notifications on completion\nBased on existing loop.sh pattern.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:51:51.29954-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:45.484079-06:00","closed_at":"2026-01-09T14:13:45.484079-06:00","close_reason":"Not needed - loop-engine handles iteration","labels":["loop/refine"],"dependencies":[{"issue_id":"loop-agents-nsj","depends_on_id":"loop-agents-hks","type":"blocks","created_at":"2026-01-09T13:52:32.201874-06:00","created_by":"daemon"},{"issue_id":"loop-agents-nsj","depends_on_id":"loop-agents-4vx","type":"blocks","created_at":"2026-01-09T13:52:32.227893-06:00","created_by":"daemon"}]}
{"id":"loop-agents-o5t","title":"Bug 7: iteration_exists() checks wrong directory path","description":"Checks $run_dir/iterations/ but engine uses stage-NN-name/iterations/.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:46:34.792801-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:25:40.580056-06:00","closed_at":"2026-01-12T23:25:40.580056-06:00","close_reason":"Fixed in bug fixing session","labels":["bugs/engine-stability"]}
{"id":"loop-agents-o62","title":"Create /review command","description":"Create command:\n- /review - Full review of git diff\n- /review full - All 6 reviewers\n- /review quick - Security + Logic + Performance\n- /review {perspective} - Single reviewer","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T13:52:24.830541-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T13:52:24.830541-06:00","labels":["loop/review"]}
{"id":"loop-agents-o82","title":"Create scripts/lib/deciders.sh for engine-owned termination","description":"Create the deciders module for engine-owned termination decisions:\n\nDeciders return continue|stop. Workers produce results, engine decides.\n\nDecider types:\n- fixed: stop when iteration == max\n- queue: stop when queue command returns empty\n- judgment: uses judge invocation with consecutive-stop rule\n\nKey change: worker 'decision' field is now ignored for control flow. Workers write result.json, engine reads and decides.","acceptance_criteria":"- [ ] deciders.sh created with fixed, queue, judgment deciders\n- [ ] Fixed decider terminates exactly at max\n- [ ] Queue decider checks command output and handles non-zero exit\n- [ ] Judgment decider calls judge.sh and tracks consecutive stops\n- [ ] Worker decision field ignored for control plane\n- [ ] Decider results logged to events.jsonl (decision event)\n- [ ] test_deciders.sh passes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:45:22.263248-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T08:37:26.472803164+01:00","closed_at":"2026-01-15T08:37:26.472803164+01:00","close_reason":"Closed","labels":["phase/3-termination","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-o82","depends_on_id":"loop-agents-2c4","type":"blocks","created_at":"2026-01-14T02:50:37.550898-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-obf","title":"Phase 2: Parallel block directory structure","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T14:38:33.330275-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T14:46:29.427942-06:00","closed_at":"2026-01-13T14:46:29.427942-06:00","close_reason":"Already implemented - all functions exist in state.sh and all 28 tests pass","labels":["pipeline/parallel-blocks"]}
{"id":"loop-agents-od6","title":"Create scripts/refine directory structure","description":"Create the directory structure:\nscripts/refine/\n├── refine-loop.sh\n├── refine-once.sh\n├── prompts/\n│   └── (7 prompt files)\n└── README.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:51:37.513089-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:40.04544-06:00","closed_at":"2026-01-09T14:13:40.04544-06:00","close_reason":"Completed via loop-engine refactor","labels":["loop/refine"]}
{"id":"loop-agents-olt","title":"Update pipeline YAML schema to use 'nodes:' syntax","description":"Update pipeline YAML schema to use 'nodes:' instead of 'stages:':\n\nNew schema:\nnodes:\n  - id: discover\n    stage: bug-discovery\n    runs: 3\n  \n  - id: design\n    stage: elegance\n    runs: 2\n  \n  - id: fix\n    stage: ralph\n    runs:\n      type: queue\n      command: 'bd ready --label=bugs'\n\nNested pipeline nodes:\nnodes:\n  - id: harden\n    pipeline: bug-hunt\n    runs: 5\n\nUpdate all existing pipeline YAML files to use new schema.","acceptance_criteria":"- [ ] Pipeline YAML supports 'nodes:' syntax\n- [ ] Nested pipeline references work via 'pipeline:' field\n- [ ] Backward compatible with 'stages:' (emit deprecation warning to stderr)\n- [ ] Invalid schema produces clear error message with line number\n- [ ] All existing pipelines updated to new schema\n- [ ] Compilation handles new schema correctly\n- [ ] scripts/run.sh help output updated\n- [ ] Documentation in CLAUDE.md updated","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:45:07.510453-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T07:50:45.162528103+01:00","closed_at":"2026-01-15T07:50:45.162528103+01:00","close_reason":"Closed","labels":["phase/2-node-executor","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-olt","depends_on_id":"loop-agents-iup","type":"blocks","created_at":"2026-01-14T02:50:32.370153-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-otc","title":"Bug 2: Engine doesn't validate pipelines before execution","description":"run_pipeline() executes without calling validate_pipeline(). Fix: Add validation check at start.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-12T22:45:56.499664-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:58:03.204987-06:00","closed_at":"2026-01-12T22:58:03.204987-06:00","close_reason":"Fixed in this session: added validate_pipeline() call, updated dry_run_pipeline() for .stage keyword, standardized error handling to return 0 (stop) on error","labels":["bugs/engine-stability"]}
{"id":"loop-agents-otd","title":"Epic: Confidence Scoring for Architecture Recommendations","description":"Add confidence scoring to pipeline-architect agent output so users can see how certain the agent is about each recommendation component.\n\n## Outcome\nDisplay: 'I'm 85% confident in this architecture. Key uncertainty: stage ordering.'\n\n## Why\nThe spec positions the architecture agent as mandatory before confirmation. Confidence scoring helps users decide whether to accept immediately or probe further. Transparent AI decision-making builds trust.\n\n## Implementation Summary\n1. Update pipeline-architect.md with confidence scoring schema\n2. Modify build.md workflow to parse and display confidence\n3. Add confidence visualization in presentation template\n4. Create prompting guidance for generating calibrated confidence scores","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-12T03:19:42.017915-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:22:01.974411-06:00","closed_at":"2026-01-12T03:22:01.974411-06:00","close_reason":"Epic created with sub-tasks. Sub-tasks now ready for work.","labels":["loop/confidence-scoring"]}
{"id":"loop-agents-p4i","title":"Update scripts/lib/hooks.sh with event-based idempotency","description":"Rewrite hooks.sh to use event spine for idempotency:\n\nHook points (v1):\n- on_session_start\n- on_iteration_complete\n- on_node_complete\n- on_session_complete\n- on_error\n\nConditions use jq expressions over hook_ctx.json:\nwhen: '.cursor.iteration % 10 == 0 and .node.id == \"fix\"'\n\nIdempotency rule:\nAction uniquely identified by (hook_point, action_id, cursor)\nBefore running, check events.jsonl for hook_complete event\nIf found, skip. If not, execute and emit hook_start/hook_complete.\n\nAction ordering:\n- Sequential by default\n- parallel: true for concurrent execution","acceptance_criteria":"- [ ] hooks.sh updated with execute_hooks(hook_point, hook_ctx_path)\n- [ ] jq-based condition evaluation\n- [ ] Idempotency via event log lookup\n- [ ] Hooks don't re-fire on resume\n- [ ] Sequential and parallel action ordering\n- [ ] test_hooks.sh passes","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-14T02:46:36.182018-06:00","created_by":"harrisonwells","updated_at":"2026-01-14T02:46:36.182018-06:00","labels":["phase/4-hooks","phase/7-hooks","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-p4i","depends_on_id":"loop-agents-z17","type":"blocks","created_at":"2026-01-14T02:51:05.712321-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-p4i","depends_on_id":"loop-agents-yq1","type":"blocks","created_at":"2026-01-14T02:51:10.891963-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-p5u","title":"Update README.md for agent-pipelines","description":"Full pass on README with new naming throughout","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T03:46:05.335513-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:01:55.042717-06:00","closed_at":"2026-01-12T22:01:55.042717-06:00","close_reason":"Verified complete - rename is done in codebase","labels":["rename"]}
{"id":"loop-agents-qba","title":"Session Inheritance - warm start from previous session learnings","description":"## Context\nFrom CASS research - the 80/20 solution to cold start problem.\n\n## What It Does\nWhen starting a new pipeline, inherit context from a completed session:\n- Copy learnings/patterns discovered\n- Agent echoes understanding of inherited context + new task\n- Builds on previous work without re-learning\n\n## Difference from --resume\n- **Resume**: Continue a crashed/stopped session from where it left off (same session)\n- **Inherit**: Start a NEW session but with warm context from a DIFFERENT completed session\n\n## Implementation Phases\n- **Phase 1**: Status.json schema extension (learnings/patterns arrays)\n- **Phase 2**: Core inheritance (inherit.sh, context.sh, engine.sh)\n- **Phase 3**: Comprehension checkpoint (prompt template, validation)\n- **Phase 4**: Lineage tracking (parent_session, recursive inheritance)\n\n## Related\n- loop-agents-xhs (Comprehension Checkpoints)\n- Cold start problem from Loom ideation\n- See docs/plans/session-inheritance.md for full design","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-13T01:32:36.30519-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:56:27.759423-06:00","labels":["pipeline/session-inherit"]}
{"id":"loop-agents-qnx","title":"Bug 3: Missing STAGE_COMPLETION fallback for inline stages","description":"Inline prompt stages can't use early termination. Fix: Default to fixed-n.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T22:46:29.634604-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T23:25:40.576098-06:00","closed_at":"2026-01-12T23:25:40.576098-06:00","close_reason":"Fixed in bug fixing session","labels":["bugs/engine-stability"]}
{"id":"loop-agents-r5x","title":"Bug 22: Inconsistent error handling in completion strategies","description":"fixed-n.sh returns 0 on error, beads-empty.sh returns 1. Inconsistent.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-12T22:46:11.984383-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:58:03.210628-06:00","closed_at":"2026-01-12T22:58:03.210628-06:00","close_reason":"Fixed in this session: added validate_pipeline() call, updated dry_run_pipeline() for .stage keyword, standardized error handling to return 0 (stop) on error","labels":["bugs/engine-stability"]}
{"id":"loop-agents-r7s","title":"Add comprehension: required config option","description":"Support optional comprehension requirement in stage/pipeline config.\n\n**Config:**\ninherit:\n  from: previous-session\n  comprehension: required  # or 'optional' (default)\n\n**Behavior:**\n- If required + comprehension present → proceed normally\n- If required + comprehension missing → log to validation.json, emit desktop notification, continue\n- If optional/unset → no validation\n\n**Acceptance criteria:**\n- [ ] Config option parsed from YAML\n- [ ] Validation check implemented in engine\n- [ ] validation.json created in iteration dir when missing","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:52:02.584068-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:52:02.584068-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-r7s","depends_on_id":"loop-agents-2q1","type":"blocks","created_at":"2026-01-13T01:55:15.446017-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-rup","title":"Update agent designer/builder skills to document commands passthrough","description":"The stage.yaml now supports a 'commands' object that passes through to context.json for agents to use.\n\n## What Changed\n- stage.yaml can define: commands: {test: ..., format: ..., types: ...}\n- context.sh passes commands to context.json\n- Agent reads via: jq '.commands.test' ${CTX}\n- Prompt defines semantics (required vs optional)\n\n## Skills to Update\n1. pipeline-designer skill - document commands field in stage schema\n2. stage-creator skill - include commands in stage.yaml template\n3. Any skill that creates/edits stages\n\n## Pattern to Document\n- Config says WHAT (commands available)\n- Prompt says WHY/WHEN (required vs optional, action on failure)\n- Status.json records validation results\n\n## Files to Reference\n- scripts/lib/context.sh (lines ~108-140)\n- scripts/stages/work/stage.yaml\n- scripts/stages/work/prompt.md (validation section)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T21:53:41.665353-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T21:53:41.665353-06:00"}
{"id":"loop-agents-rur","title":"Define confidence scoring schema in pipeline-architect.md","description":"Update .claude/agents/pipeline-architect.md with the confidence scoring output format.\n\n## Schema Design\n\nAdd to the recommendation YAML output:\n\n```yaml\nrecommendation:\n  # ... existing fields ...\n  \n  confidence: 0.85  # 0-1 scale, overall confidence\n  confidence_breakdown:\n    termination_strategy: 0.95  # How certain about termination type\n    stage_count: 0.70           # How certain about number of stages\n    model_selection: 0.90       # How certain about opus/sonnet/haiku\n    stage_ordering: 0.80        # For multi-stage: ordering certainty\n    existing_stage_reuse: 0.85  # Confidence in reuse decisions\n  \n  areas_of_uncertainty:\n    - 'Unclear if refine-beads should run before or after elegance'\n    - \"User's tolerance for cost vs quality tradeoff unknown\"\n```\n\n## Implementation\n1. Add confidence section to Output Format in pipeline-architect.md\n2. Add guidance on how to calculate each confidence dimension\n3. Add to Quality Checklist: confidence breakdown included\n4. Ensure rationale explains LOW confidence areas\n\n## Calibration Guidance\n- 0.95+: Extremely clear from requirements\n- 0.80-0.95: Strong inference, minor ambiguity\n- 0.60-0.80: Reasonable guess, would benefit from clarification\n- 0.40-0.60: Coin flip, user should definitely weigh in\n- \u003c0.40: Guessing, flag prominently\n\n## Files\n- .claude/agents/pipeline-architect.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:00.271214-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:00.271214-06:00","labels":["loop/confidence-scoring"],"dependencies":[{"issue_id":"loop-agents-rur","depends_on_id":"loop-agents-otd","type":"blocks","created_at":"2026-01-12T03:20:04.438594-06:00","created_by":"daemon"}]}
{"id":"loop-agents-sam","title":"Bug 9: dry_run_pipeline() ignores .stage keyword","description":"Dry-run uses legacy .loop keyword, missing pipelines using .stage.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-12T22:46:06.811142-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:58:03.2085-06:00","closed_at":"2026-01-12T22:58:03.2085-06:00","close_reason":"Fixed in this session: added validate_pipeline() call, updated dry_run_pipeline() for .stage keyword, standardized error handling to return 0 (stop) on error","labels":["bugs/engine-stability"]}
{"id":"loop-agents-sro","title":"Add 'status' and 'tail' commands with event-based output","description":"Add event-based observability commands:\n\nstatus \u003csession\u003e - Show session status from events:\nSession: bug-hunt\nStatus: running\nNode: 1.0 (fix/ralph)\nRun: 2/3\nIteration: 7\nLast event: worker_complete (2m ago)\nHealth: ok\nErrors: 0\nDuration: 45m\n\ntail \u003csession\u003e - Stream events.jsonl with human-readable formatting:\n[10:45:01] iteration_start node=1.0 run=2 iter=7\n[10:47:23] worker_complete exit=0 files=3\n[10:47:24] hook_start point=on_iteration_complete action=tests\n\nHealth calculation:\nhealth = 1.0 - (0.1 * consecutive_errors) - (0.05 * iterations_without_progress)\nHealth \u003c 0.3 triggers warning.","acceptance_criteria":"- [ ] status command shows session info from events\n- [ ] tail command streams events in human-readable format\n- [ ] Health score calculated correctly\n- [ ] Warning shown when health \u003c 0.3\n- [ ] Duration calculated from session_start event","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-14T02:48:13.103566-06:00","created_by":"harrisonwells","updated_at":"2026-01-14T02:48:13.103566-06:00","labels":["phase/5-observability","phase/6-observability","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-sro","depends_on_id":"loop-agents-z17","type":"blocks","created_at":"2026-01-14T02:51:54.292513-06:00","created_by":"harrisonwells"},{"issue_id":"loop-agents-sro","depends_on_id":"loop-agents-edc","type":"blocks","created_at":"2026-01-14T21:38:13.403534-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-t13","title":"State transition bug: iteration_completed not reset on stage transition","description":"iteration_completed is not being reset when transitioning between stages in a multi-stage pipeline. Documented in docs/bug-investigation-2026-01-12-state-transition.md","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-12T22:08:44.838394-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:17:10.776149-06:00","closed_at":"2026-01-12T22:17:10.776149-06:00","close_reason":"Fixed: Added reset_iteration_counters() and call in engine.sh after update_stage. See test_stage_transition_reset.sh","labels":["bugs/engine"]}
{"id":"loop-agents-t4y","title":"Create performance.md review prompt","description":"Performance Oracle prompt:\n- Algorithmic complexity (O(n²))\n- N+1 queries, memory leaks\n- Blocking operations, missing caching\n- Output format with FINDINGS_COUNT","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T13:52:13.5438-06:00","created_by":"harrisonwells","updated_at":"2026-01-09T14:13:40.062518-06:00","closed_at":"2026-01-09T14:13:40.062518-06:00","close_reason":"Completed via loop-engine refactor","labels":["loop/review"],"dependencies":[{"issue_id":"loop-agents-t4y","depends_on_id":"loop-agents-f1v","type":"blocks","created_at":"2026-01-09T13:52:32.386689-06:00","created_by":"daemon"}]}
{"id":"loop-agents-ugc","title":"TDD: Phase 1 - Parallel Provider Validation Rules","description":"Complete TDD cycle for parallel provider validation rules.\n\n## Step 1: Write Failing Tests\nFile: scripts/tests/test_validation.sh (add to existing file)\n\n### Unit Tests to Write\n\n1.1 Mutual Exclusion Tests:\n- test_validation_provider_and_providers_exclusive\n- test_validation_provider_and_tracks_exclusive\n- test_validation_providers_and_tracks_exclusive\n\n1.2 Termination Restriction Tests:\n- test_validation_providers_rejects_judgment\n- test_validation_providers_rejects_plateau\n- test_validation_providers_accepts_fixed\n\n1.3 Tracks Schema Tests:\n- test_validation_track_requires_provider\n- test_validation_track_requires_loop\n- test_validation_track_validates_loop_exists\n\n1.4 Provider Preflight Tests:\n- test_validation_providers_preflight_checks_all\n\n## Step 2: Verify Tests Fail\nRun: ./scripts/tests/test_validation.sh\nAll new tests MUST fail initially.\n\n## Step 3: Implement Feature\nFile: scripts/lib/validate.sh\n\n- Add validate_parallel_config() function\n- Check mutual exclusivity of provider/providers/tracks\n- Check termination type restrictions for parallel providers\n- Add validate_tracks_config() function\n- Add validate_providers_preflight() for CLI checks\n\n## Step 4: Verify Tests Pass\nRun: ./scripts/tests/run_tests.sh\n\n## Step 5: Commit\ngit commit -m 'feat: add validation for parallel provider config'\n\n## Acceptance Criteria\n- [ ] 10 new unit tests in test_validation.sh\n- [ ] Tests fail initially\n- [ ] Validation functions implemented\n- [ ] All existing tests still pass\n- [ ] Changes committed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T21:26:58.824827-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.940876819+01:00","closed_at":"2026-01-14T17:06:31.883306-06:00","labels":["phase/7-parallel","pipeline/parallel-providers","pipeline/v3-event-spine"]}
{"id":"loop-agents-v9g","title":"Add viz --json flag for machine-readable output","description":"Add --json flag that outputs pipeline structure as JSON instead of ASCII. Useful for tooling integration and testing.\n\nJSON should include all parsed data: stages array, termination configs, token estimates, dependencies.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:52.985897-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:41:03.786864-06:00","closed_at":"2026-01-12T03:41:03.786864-06:00","close_reason":"Superseded by unified Pipeline Display Skill (loop-agents-ak2)","labels":["loop/pipeline-viz"],"dependencies":[{"issue_id":"loop-agents-v9g","depends_on_id":"loop-agents-max","type":"parent-child","created_at":"2026-01-12T03:21:21.66152-06:00","created_by":"daemon"},{"issue_id":"loop-agents-v9g","depends_on_id":"loop-agents-3os","type":"blocks","created_at":"2026-01-12T03:21:37.507003-06:00","created_by":"daemon"}]}
{"id":"loop-agents-vfj","title":"Create /ideate command","description":"Create command that runs idea-wizard:\n- /ideate - Run on current project\n- /ideate path/to/plan.md - Run on specific plan\nSingle shot, not iterative.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T13:52:02.811553-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:02:11.889883-06:00","closed_at":"2026-01-12T22:02:11.889883-06:00","close_reason":"Commands exist in commands/ directory","labels":["loop/refine"]}
{"id":"loop-agents-wbm","title":"Pass --inherit flag through run.sh to engine","description":"Update run.sh to pass the --inherit flag through to the engine in both loop) and pipeline) cases.\n\n**Acceptance criteria:**\n- [ ] ./scripts/run.sh ralph auth 25 --inherit auth-v1 works\n- [ ] ./scripts/run.sh pipeline refine.yaml my-session --inherit previous works\n- [ ] Flag passed through unchanged to engine.sh","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:50:56.736597-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:50:56.736597-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-wbm","depends_on_id":"loop-agents-bdt","type":"blocks","created_at":"2026-01-13T01:54:44.91677-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-wia","title":"Add unit tests for initial inputs","description":"Add tests: single file, glob, directory, CLI override, empty default","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T01:31:23.496772-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:35:53.380001-06:00","closed_at":"2026-01-13T01:35:53.380001-06:00","close_reason":"Added 5 unit tests for initial inputs, all passing","labels":["feature/initial-inputs"]}
{"id":"loop-agents-wy5","title":"Parse pipeline-level inputs in run_pipeline()","description":"Extract inputs array from pipeline YAML, call resolve_initial_inputs(), store in run_dir","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T01:31:05.598759-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:32:52.515644-06:00","closed_at":"2026-01-13T01:32:52.515644-06:00","close_reason":"Added pipeline inputs parsing in run_pipeline()","labels":["feature/initial-inputs"],"dependencies":[{"issue_id":"loop-agents-wy5","depends_on_id":"loop-agents-88s","type":"blocks","created_at":"2026-01-13T01:31:35.361838-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-x64","title":"Expand status.json schema with learnings and patterns arrays","description":"Add 'learnings' and 'patterns' arrays to the status.json schema that agents write at the end of each iteration. These arrays capture insights and code patterns discovered during the iteration that should be available for inheritance.\n\n**Acceptance criteria:**\n- [ ] status.json schema in CLAUDE.md includes learnings[] and patterns[] arrays\n- [ ] Both arrays accept string items\n- [ ] Arrays are optional (existing prompts without them still work)\n- [ ] Example format documented","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T01:46:39.327382-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T01:46:39.327382-06:00","labels":["pipeline/session-inherit"]}
{"id":"loop-agents-xhs","title":"Explore Comprehension Checkpoints for pipeline stages","description":"## Context\nFrom Loom ideation session - idea ranked #1 across iterations.\n\n## Concept\nAdd standardized comprehension checkpoints to stage prompts. Before agents do work, they summarize:\n1. Their understanding of the goal (one sentence)\n2. Key constraints they're operating under\n3. Files/areas they expect to touch\n\nEngine validates this against ground truth or intent. Catches misunderstandings BEFORE work happens, not after.\n\n## Why This Matters (Loom Principle)\n- **Specs as anchors**: The checkpoint becomes a lightweight spec that prevents drift\n- **Cheap to validate**: Reading comprehension is cheaper than fixing bad implementation\n- **Trackable**: Creates audit trail of what agent understood at each iteration\n- **Testable**: Can measure comprehension accuracy over time, improve prompts\n\n## Implementation Sketch\n1. Add `## Step 0: Verify Understanding` template to stage prompts\n2. Agent writes comprehension summary to status.json or dedicated field\n3. Engine can optionally validate against expected patterns\n4. Track comprehension accuracy as a metric\n\n## Open Questions\n- How to define \"ground truth\" for validation?\n- Should comprehension be blocking or advisory?\n- How to handle multi-stage pipelines where understanding evolves?\n\n## Reference\ndocs/ideas-loom.md - full writeup from ideation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T00:44:28.601515-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T00:44:28.601515-06:00"}
{"id":"loop-agents-xm5","title":"Create confidence calibration reference document","description":"Create a reference document with guidance for generating well-calibrated confidence scores.\n\n## New File: skills/pipeline-designer/references/confidence-calibration.md\n\n### Purpose\nEnsure the pipeline-architect agent produces meaningful, calibrated confidence scores rather than arbitrary numbers.\n\n### Content Structure\n\n1. **What Makes a Good Confidence Score**\n   - Should reflect actual uncertainty\n   - Should be useful for decision-making\n   - Should be consistent across invocations\n\n2. **Calibration Anchors**\n   Each dimension should have concrete anchors:\n   \n   **Termination Strategy (0-1)**\n   - 0.95: User explicitly said 'until queue is empty' or 'until quality plateaus'\n   - 0.80: Strong inference from task type (e.g., 'implement these features' implies queue)\n   - 0.60: Could reasonably be multiple strategies\n   - 0.40: Genuinely unclear, need to ask\n   \n   **Stage Count**\n   - 0.95: User specified 'single stage' or 'three stages'\n   - 0.80: Task naturally maps to N stages\n   - 0.60: Could be N or N+1 stages\n   - 0.40: Very unclear scope\n   \n   **Model Selection**\n   - 0.95: User specified or task obviously requires opus (deep reasoning)\n   - 0.80: Clear complexity indicators\n   - 0.60: Medium complexity, could go either way\n   - 0.40: No clear signals\n\n3. **Common Uncertainty Patterns**\n   - 'Stage ordering unclear' - when A could run before or after B\n   - 'Cost vs quality tradeoff unknown' - opus vs sonnet decision\n   - 'Scope ambiguity' - how much to include\n   - 'Termination timing' - min_iterations, consensus count\n\n4. **Anti-patterns**\n   - Always outputting 0.85 (lazy middle ground)\n   - Confidence not matching rationale\n   - Missing areas_of_uncertainty when confidence \u003c 0.80\n\n## Files\n- skills/pipeline-designer/references/confidence-calibration.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:20:48.525492-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:20:48.525492-06:00","labels":["loop/confidence-scoring"],"dependencies":[{"issue_id":"loop-agents-xm5","depends_on_id":"loop-agents-rur","type":"blocks","created_at":"2026-01-12T03:20:54.015952-06:00","created_by":"daemon"}]}
{"id":"loop-agents-xri","title":"Create scripts/lib/deps.sh for dependency checking","description":"Create a dependency checking module that verifies required tools:\n- jq (1.6+)\n- yq (v4+, Go-based - NOT Python v3)\n- tmux (if tmux mode used)\n- bd (if queue termination used)\n\nCross-platform lock handling:\n- Linux: flock (util-linux)\n- macOS: flock via Homebrew or fallback to shlock\n- CI/CD: --no-lock flag for single-process runs","acceptance_criteria":"- [ ] deps.sh created with version checking\n- [ ] jq version validation works\n- [ ] yq v4+ detection with helpful error if wrong version\n- [ ] tmux/bd detection based on usage\n- [ ] Cross-platform lock mechanism detection\n- [ ] Clear error messages with install instructions","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:43:02.235359-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.951365956+01:00","closed_at":"2026-01-14T16:18:58.47323-06:00","labels":["phase/1-event-spine","pipeline/v3-event-spine"]}
{"id":"loop-agents-ygj","title":"Add inherit: config support in stage/pipeline YAML","description":"Support inherit configuration in YAML files as alternative to CLI flag.\n\n**YAML format:**\ninherit:\n  from: previous-session-name\n  select:\n    - learnings\n    - patterns\n\n**Implementation location:** scripts/lib/yaml.sh (add parse_inherit_config function)\n\n**Select parsing:**\n- If omitted: default to 'all'\n- If array: join with comma for INHERIT_SELECT\n- Example: ['learnings', 'patterns'] → 'learnings,patterns'\n\n**Acceptance criteria:**\n- [ ] Pipeline can specify inherit.from in pipeline.yaml\n- [ ] Stage can specify inherit.from in stage.yaml\n- [ ] select defaults to 'all' if omitted\n- [ ] select array joined to comma-separated string\n- [ ] CLI flag --inherit overrides YAML config\n- [ ] parse_inherit_config() added to yaml.sh","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:51:08.492814-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T02:01:59.774135-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-ygj","depends_on_id":"loop-agents-bdt","type":"blocks","created_at":"2026-01-13T01:54:55.177627-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-yj0","title":"Test confidence scoring with example architecture requests","description":"Validate the confidence scoring implementation with diverse test scenarios.\n\n## Test Scenarios\n\n### Scenario 1: Clear Requirements (Expected: High Confidence)\nInput: 'I want to implement all the beads tagged with loop/auth until they are done'\nExpected:\n- termination_strategy: 0.95 (queue - explicit 'until done')\n- stage_count: 0.95 (single stage - just work)\n- model_selection: 0.80 (sonnet typical for work)\n- Overall: ~0.90\n\n### Scenario 2: Ambiguous Requirements (Expected: Medium Confidence)\nInput: 'I want to improve my code quality'\nExpected:\n- termination_strategy: 0.70 (judgment implied, but could be fixed)\n- stage_count: 0.60 (elegance alone? or elegance + refine?)\n- model_selection: 0.75 (opus for quality work, but...)\n- Overall: ~0.68\n\n### Scenario 3: Contradictory/Unclear (Expected: Low Confidence)\nInput: 'Make a pipeline that does some stuff iteratively'\nExpected:\n- termination_strategy: 0.40 (no clue)\n- stage_count: 0.40 (no clue)\n- model_selection: 0.50 (default guess)\n- Overall: ~0.43\n- areas_of_uncertainty should be populated\n\n## Validation Steps\n1. Invoke pipeline-designer skill with each scenario\n2. Verify confidence scores are in expected ranges\n3. Verify low-confidence scenarios trigger discussion before confirmation\n4. Verify areas_of_uncertainty populated appropriately\n5. Verify presentation template renders correctly\n\n## Success Criteria\n- High-confidence scenarios proceed to confirmation quickly\n- Medium-confidence scenarios surface uncertainties\n- Low-confidence scenarios force discussion\n- Confidence breakdown is visually clear","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T03:21:36.352265-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T03:21:36.352265-06:00","labels":["loop/confidence-scoring"],"dependencies":[{"issue_id":"loop-agents-yj0","depends_on_id":"loop-agents-9r1","type":"blocks","created_at":"2026-01-12T03:21:40.572454-06:00","created_by":"daemon"},{"issue_id":"loop-agents-yj0","depends_on_id":"loop-agents-di8","type":"blocks","created_at":"2026-01-12T03:21:40.593263-06:00","created_by":"daemon"}]}
{"id":"loop-agents-yp3","title":"Rename tmux session prefix: loop- → pipeline-","description":"Update engine.sh, status commands, documentation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T03:46:05.274674-06:00","created_by":"harrisonwells","updated_at":"2026-01-12T22:01:55.038115-06:00","closed_at":"2026-01-12T22:01:55.038115-06:00","close_reason":"Verified complete - rename is done in codebase","labels":["rename"]}
{"id":"loop-agents-yq1","title":"Create scripts/lib/hook_ctx.sh for hook context generation","description":"Create the hook context module that builds hook_ctx.json:\n\nhook_ctx.json schema:\n{\n  \"session\": { \"name\": \"...\", \"started_at\": \"...\" },\n  \"cursor\": { \"node_path\": \"...\", \"node_run\": N, \"iteration\": N },\n  \"node\": { \"id\": \"...\", \"kind\": \"stage|pipeline\", \"ref\": \"...\" },\n  \"paths\": { \"session_dir\": \"...\", \"node_dir\": \"...\", \"iteration_dir\": \"...\", \"result\": \"...\", \"progress\": \"...\" },\n  \"result\": { \"summary\": \"...\", \"work\": {} },\n  \"previous_hooks\": { \"tests\": { \"status\": \"success\" } },\n  \"plan\": { \"name\": \"...\", \"total_nodes\": N }\n}\n\nReplace env-var explosion with single HOOK_CTX path.","acceptance_criteria":"- [ ] hook_ctx.sh created with build_hook_ctx()\n- [ ] All required fields populated\n- [ ] Previous hooks status included\n- [ ] HOOK_CTX environment variable set for hooks\n- [ ] test_hook_ctx.sh passes","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-14T02:46:19.431525-06:00","created_by":"harrisonwells","updated_at":"2026-01-14T02:46:19.431525-06:00","labels":["phase/4-hooks","phase/7-hooks","pipeline/v3","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-yq1","depends_on_id":"loop-agents-edc","type":"blocks","created_at":"2026-01-14T02:51:00.531882-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-z17","title":"Create scripts/lib/events.sh for event spine","description":"Create the event spine module - the single source of truth for execution:\n\nFunctions:\n- append_event() - atomically append to events.jsonl\n- read_events() - read all events\n- last_event() - get most recent event\n- render_status() - human-readable status from events\n\nEvent types:\n- session_start, plan_compiled\n- node_start, node_run_start, iteration_start\n- worker_complete, iteration_complete\n- hook_start, hook_complete\n- node_complete, session_complete\n- error\n\nRequired fields: ts, type, session, cursor\n\nCursor object: {node_path, node_run, iteration}","acceptance_criteria":"- [ ] events.sh created with append_event(), read_events(), last_event()\n- [ ] Events atomically written (temp file + rename)\n- [ ] Truncated final line handled gracefully\n- [ ] Cursor object validated\n- [ ] All core event types supported\n- [ ] render_status() provides human-readable output\n- [ ] test_events.sh passes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T02:43:33.844213-06:00","created_by":"harrisonwells","updated_at":"2026-01-15T05:40:39.961798877+01:00","closed_at":"2026-01-14T17:06:55.484018-06:00","labels":["phase/1-event-spine","pipeline/v3-event-spine"],"dependencies":[{"issue_id":"loop-agents-z17","depends_on_id":"loop-agents-8od","type":"blocks","created_at":"2026-01-14T02:49:39.382066-06:00","created_by":"harrisonwells"}]}
{"id":"loop-agents-zl4","title":"Add sessions list --completed discovery command","description":"Add command to discover sessions that can be inherited from.\n\n**Usage:**\n./scripts/run.sh sessions list --completed\n\n**Implementation location:** scripts/run.sh in the sessions) case handler\n\n**Output format:**\nNAME              STATUS     COMPLETED_AT          LEARNINGS\nauth-v1           complete   2026-01-12T15:30:00Z  12\nrefine-payments   complete   2026-01-11T10:00:00Z  8\n\n**Logic:**\n1. Iterate .claude/pipeline-runs/*/state.json\n2. Filter where status=\"complete\" or status=\"completed\"\n3. Count learnings from */iterations/*/status.json files (jq \"[.learnings // []] | length\")\n4. Sort by completed_at descending\n\n**Note:** This command does NOT require inherit.sh - it reads state.json and status.json directly to display available sessions.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:51:20.814432-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T02:10:10.843411-06:00","labels":["pipeline/session-inherit"]}
{"id":"loop-agents-zvj","title":"Update stage prompt template with inheritance acknowledgment section","description":"Add a standard section to stage prompts for acknowledging inherited context.\n\n**Template addition (Step 0: Verify Understanding):**\n- Check for inherited context with jq \".inherited // empty\" ${CTX}\n- If present, agent summarizes what was learned in previous session\n- States current task in one sentence\n- Lists applicable constraints from inherited context\n\n**Files to update:**\n- scripts/stages/ralph/prompt.md (highest priority)\n- scripts/stages/improve-plan/prompt.md\n- scripts/stages/refine-tasks/prompt.md\n- Template documented in CLAUDE.md as recommended pattern\n\n**Note:** This does NOT require inherit.sh - it just updates prompt templates to instruct agents how to process the inherited block in context.json when present.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T01:51:50.555388-06:00","created_by":"harrisonwells","updated_at":"2026-01-13T02:10:25.091866-06:00","labels":["pipeline/session-inherit"],"dependencies":[{"issue_id":"loop-agents-zvj","depends_on_id":"loop-agents-x64","type":"blocks","created_at":"2026-01-13T02:09:46.372379-06:00","created_by":"harrisonwells"}]}
